<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANN â€” Personal Assistant</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;600;700;800&family=Playfair+Display:wght@400;600;700&display=swap');

:root {
  --bg: #d4d6d9;
  --bg2: #c8cacd;
  --surface: #dcdee1;
  --surface2: #d6d8db;
  --border: #b8babe;
  --border2: #acacb0;
  --ink: #0d1117;
  --ink2: #1e2a3a;
  --ink3: #3d4a5c;
  --accent: #000000;
  --accent2: #1a1a2e;
  --accent-light: #dce3ed;
  --blue: #1a3260;
  --blue-light: #d0ddf5;
  --green: #166534;
  --green-light: #dcfce7;
  --amber: #92400e;
  --amber-light: #fef3c7;
  --red: #991b1b;
  --red-light: #fee2e2;
  --purple: #4c1d95;
  --purple-light: #ede9fe;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--ink);
  font-family: 'Raleway', sans-serif;
  height: 100vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

h1, h2, h3, .heading-font, .brand-name, .card-title, .topbar-title {
  font-family: 'Playfair Display', serif;
}

body::after {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 9999;
  opacity: 0.4;
}

.titlebar {
  background: #1e3560;
  height: 36px;
  display: flex;
  align-items: center;
  padding: 0 16px;
  gap: 8px;
  flex-shrink: 0;
  user-select: none;
}

.titlebar-dots { display: flex; gap: 6px; }

.dot {
  width: 12px; height: 12px;
  border-radius: 50%;
  cursor: pointer;
  transition: opacity 0.15s;
}
.dot:hover { opacity: 0.8; }
.dot-red { background: #ff5f57; }
.dot-yellow { background: #febc2e; }
.dot-green { background: #28c840; }

.titlebar-title {
  flex: 1; text-align: center;
  font-family: 'DM Mono', monospace;
  font-size: 11px; color: rgba(255,255,255,0.4); letter-spacing: 2px;
}

.titlebar-time {
  font-family: 'DM Mono', monospace;
  font-size: 11px; color: rgba(255,255,255,0.3);
}

.app { display: flex; flex: 1; overflow: hidden; }

.sidebar {
  width: 220px; background: #2c4a7c;
  display: flex; flex-direction: column;
  flex-shrink: 0; padding: 20px 0;
}

.sidebar-brand {
  padding: 0 20px 24px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.brand-name {
  font-family: 'Playfair Display', serif;
  font-weight: 700; font-size: 20px;
  color: white; letter-spacing: -0.5px;
}

.brand-sub {
  font-family: 'DM Mono', monospace;
  font-size: 9px; color: rgba(255,255,255,0.3);
  letter-spacing: 2px; text-transform: uppercase; margin-top: 2px;
}

.sidebar-nav {
  padding: 16px 12px; flex: 1;
  display: flex; flex-direction: column; gap: 2px;
}

.nav-section-label {
  font-family: 'DM Mono', monospace;
  font-size: 9px; letter-spacing: 2px; text-transform: uppercase;
  color: rgba(255,255,255,0.2); padding: 8px 8px 4px; margin-top: 8px;
}

.nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 9px 10px; border-radius: 8px; cursor: pointer;
  transition: all 0.15s ease; color: rgba(255,255,255,0.5);
  font-size: 13px; font-weight: 500; position: relative;
}
.nav-item:hover { background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.8); }
.nav-item.active { background: #000000; color: white; }

.nav-icon { font-size: 16px; width: 20px; text-align: center; flex-shrink: 0; }

.nav-badge {
  margin-left: auto; background: #2c4a7c; color: white;
  font-size: 9px; font-family: 'DM Mono', monospace;
  padding: 2px 6px; border-radius: 10px; min-width: 18px; text-align: center;
}
.nav-item.active .nav-badge { background: rgba(255,255,255,0.25); }

.sidebar-profile {
  padding: 16px 20px; border-top: 1px solid rgba(255,255,255,0.08);
  display: flex; align-items: center; gap: 10px; cursor: pointer;
}

.profile-avatar {
  width: 32px; height: 32px; border-radius: 50%;
  background: #2c4a7c; display: flex; align-items: center;
  justify-content: center; font-weight: 700; font-size: 13px;
  color: white; flex-shrink: 0;
}

.profile-name { font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.8); }
.profile-role { font-size: 10px; font-family: 'DM Mono', monospace; color: rgba(255,255,255,0.3); }

.main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

.topbar {
  background: var(--surface); border-bottom: 1px solid var(--border);
  padding: 0 28px; height: 56px; display: flex; align-items: center;
  gap: 16px; flex-shrink: 0;
}

.topbar-title { font-weight: 700; font-size: 16px; color: var(--ink); }
.topbar-sub { font-size: 12px; font-family: 'DM Mono', monospace; color: var(--ink3); }
.topbar-actions { margin-left: auto; display: flex; align-items: center; gap: 10px; }

.btn {
  padding: 8px 16px; border-radius: 8px; font-size: 12px;
  font-weight: 600; font-family: 'Raleway', sans-serif;
  cursor: pointer; border: none; transition: all 0.15s ease;
}
.btn-primary { background: #000000; color: white; }
.btn-primary:hover { background: #1a1a2e; }
.btn-ghost { background: transparent; color: var(--ink2); border: 1px solid var(--border); }
.btn-ghost:hover { background: var(--bg2); }

.notif-bell {
  width: 36px; height: 36px; border-radius: 8px;
  border: 1px solid var(--border); display: flex; align-items: center;
  justify-content: center; cursor: pointer; position: relative;
  background: var(--surface); transition: all 0.15s;
}
.notif-bell:hover { background: var(--bg2); }

.notif-dot {
  position: absolute; top: 6px; right: 6px;
  width: 7px; height: 7px; border-radius: 50%;
  background: #2c4a7c; border: 1px solid var(--surface);
}

.content { flex: 1; overflow-y: auto; padding: 24px 28px; display: none; }
.content.active { display: block; }

.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 16px;
}

.card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }

.card-header {
  padding: 16px 18px 12px; display: flex; align-items: center;
  gap: 10px; border-bottom: 1px solid var(--border);
}

.card-icon {
  width: 28px; height: 28px; border-radius: 7px;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; flex-shrink: 0;
}

.card-title { font-weight: 700; font-size: 13px; color: var(--ink); }
.card-sub { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 1px; }
.card-body { padding: 14px 18px; }

.whats-new { grid-column: 1 / -1; background: #2c4a7c; border-color: transparent; }
.whats-new .card-header { border-bottom-color: rgba(255,255,255,0.08); }
.whats-new .card-title { color: white; }
.whats-new .card-sub { color: rgba(255,255,255,0.35); }

.whats-new-body { padding: 16px 18px; display: flex; gap: 12px; align-items: flex-start; }

.profile-tags { display: flex; flex-wrap: wrap; gap: 6px; flex: 1; }

.profile-tag {
  padding: 5px 12px; border-radius: 20px;
  font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.15s;
}
.tag-active { background: #2c4a7c; color: white; }
.tag-inactive { background: var(--bg2); color: var(--ink2); border: 1px solid var(--border); }
.tag-inactive:hover { background: var(--border); color: var(--ink); }
.tag-add { background: transparent; color: var(--ink3); border: 1px dashed var(--border2); }
.tag-add:hover { border-color: var(--ink3); color: var(--ink2); }

/* â”€â”€ PROFILE TAB â”€â”€ */
.profile-subtabs { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
.profile-tab-panel { display: none; }
.profile-tab-panel.active { display: block; }
.profile-section-label {
  font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3);
  text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 10px;
}
.food-pref-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 10px; margin-bottom: 16px;
}
.food-pref-item {
  display: flex; align-items: center; gap: 8px; padding: 10px 12px;
  border: 1.5px solid var(--border); border-radius: 10px;
  background: var(--surface2); cursor: pointer; transition: all 0.15s;
}
.food-pref-item.selected { border-color: #2c4a7c; background: var(--blue-light); }
.food-pref-item:hover:not(.selected) { border-color: var(--border2); background: var(--bg2); }
.food-pref-icon { font-size: 18px; flex-shrink: 0; }
.food-pref-name { font-size: 12px; font-weight: 600; color: var(--ink); }
.food-pref-sub { font-size: 9px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 1px; }
.hobby-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 10px;
}
.hobby-item {
  display: flex; align-items: center; gap: 10px; padding: 12px 14px;
  border: 1.5px solid var(--border); border-radius: 10px;
  background: var(--surface2); cursor: pointer; transition: all 0.15s;
}
.hobby-item.active { border-color: #2c4a7c; background: var(--blue-light); }
.hobby-item:hover:not(.active) { border-color: var(--border2); }
.hobby-icon { font-size: 22px; flex-shrink: 0; }
.hobby-name { font-size: 12px; font-weight: 700; color: var(--ink); }
.hobby-freq { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 2px; }

.task-item {
  display: flex; align-items: flex-start; gap: 10px;
  padding: 10px 0; border-bottom: 1px solid var(--border);
  cursor: pointer; transition: all 0.15s;
}
.task-item:last-child { border-bottom: none; }
.task-item:hover { opacity: 0.8; }

.task-check {
  width: 16px; height: 16px; border-radius: 4px;
  border: 1.5px solid var(--border2); flex-shrink: 0; margin-top: 1px;
  cursor: pointer; transition: all 0.15s;
  display: flex; align-items: center; justify-content: center;
}
.task-check.done { background: var(--green); border-color: var(--green); color: white; font-size: 10px; }

.task-text { flex: 1; font-size: 12px; color: var(--ink2); line-height: 1.4; }
.task-text.done { text-decoration: line-through; color: var(--ink3); }

.task-source {
  font-size: 9px; font-family: 'DM Mono', monospace;
  color: var(--ink3); background: var(--bg2);
  padding: 2px 6px; border-radius: 4px; white-space: nowrap;
}

.email-item {
  display: flex; gap: 10px; padding: 10px 0;
  border-bottom: 1px solid var(--border); cursor: pointer; transition: opacity 0.15s;
}
.email-item:last-child { border-bottom: none; }
.email-item:hover { opacity: 0.75; }

.email-avatar {
  width: 28px; height: 28px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 700; color: white; flex-shrink: 0;
}
.email-content { flex: 1; min-width: 0; }
.email-from { font-size: 11px; font-weight: 700; color: var(--ink); }
.email-subject { font-size: 11px; color: var(--ink2); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.email-summary { font-size: 10px; color: var(--ink3); font-family: 'DM Mono', monospace; margin-top: 2px; }
.email-time { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); flex-shrink: 0; }

.budget-chart-wrap { display: flex; gap: 16px; align-items: center; }

.pie-wrap { position: relative; width: 90px; height: 90px; flex-shrink: 0; }
.pie-wrap svg { transform: rotate(-90deg); }

.pie-center {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%, -50%); text-align: center;
}
.pie-total { font-size: 13px; font-weight: 800; color: var(--ink); line-height: 1; }
.pie-label { font-size: 8px; font-family: 'DM Mono', monospace; color: var(--ink3); text-transform: uppercase; }

.budget-legend { flex: 1; display: flex; flex-direction: column; gap: 6px; }

.budget-item { display: flex; align-items: center; gap: 8px; }
.budget-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.budget-cat { font-size: 11px; color: var(--ink2); flex: 1; }
.budget-amt { font-size: 11px; font-family: 'DM Mono', monospace; color: var(--ink); font-weight: 500; }
.budget-pct { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); width: 30px; text-align: right; }

.inventory-item { display: flex; align-items: center; gap: 10px; padding: 7px 0; border-bottom: 1px solid var(--border); }
.inventory-item:last-child { border-bottom: none; }
.inv-emoji { font-size: 16px; width: 24px; text-align: center; }
.inv-name { font-size: 12px; font-weight: 600; color: var(--ink); flex: 1; }
.inv-qty { font-size: 11px; font-family: 'DM Mono', monospace; color: var(--ink2); }
.stock-bar { width: 50px; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
.stock-fill { height: 100%; border-radius: 2px; transition: width 0.5s ease; }

.parcel-item { display: flex; align-items: center; gap: 10px; padding: 9px 0; border-bottom: 1px solid var(--border); }
.parcel-item:last-child { border-bottom: none; }
.parcel-icon { width: 28px; height: 28px; border-radius: 7px; background: var(--bg2); display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
.parcel-info { flex: 1; }
.parcel-name { font-size: 12px; font-weight: 600; color: var(--ink); }
.parcel-courier { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); }

.status-pill { font-size: 9px; font-family: 'DM Mono', monospace; font-weight: 500; padding: 3px 8px; border-radius: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
.status-transit { background: var(--amber-light); color: var(--amber); }
.status-delivered { background: var(--green-light); color: var(--green); }
.status-processing { background: var(--blue-light); color: var(--blue); }
.status-alert { background: var(--red-light); color: var(--red); }

.notif-panel {
  position: fixed; top: 92px; right: 28px; width: 320px;
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.12);
  z-index: 100; display: none; overflow: hidden;
}
.notif-panel.open { display: block; animation: slideDown 0.2s ease; }

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}

.notif-header { padding: 14px 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
.notif-title { font-size: 13px; font-weight: 700; }
.notif-clear { font-size: 11px; color: #2c4a7c; cursor: pointer; font-family: 'DM Mono', monospace; }
.notif-list { max-height: 320px; overflow-y: auto; }
.notif-item { padding: 12px 16px; border-bottom: 1px solid var(--border); display: flex; gap: 10px; cursor: pointer; transition: background 0.15s; }
.notif-item:last-child { border-bottom: none; }
.notif-item:hover { background: var(--bg2); }
.notif-ico { font-size: 18px; flex-shrink: 0; }
.notif-body { flex: 1; }
.notif-msg { font-size: 12px; color: var(--ink); line-height: 1.4; }
.notif-time { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 2px; }

.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
.cal-day-label { text-align: center; font-size: 9px; font-family: 'DM Mono', monospace; color: var(--ink3); text-transform: uppercase; letter-spacing: 1px; padding: 4px 0; }
.cal-day { aspect-ratio: 1; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 500; color: var(--ink2); cursor: pointer; transition: all 0.15s; position: relative; }
.cal-day:hover { background: var(--bg2); }
.cal-day.today { background: #000000; color: white; font-weight: 700; }
.cal-day.has-event::after { content: ''; position: absolute; bottom: 3px; left: 50%; transform: translateX(-50%); width: 4px; height: 4px; border-radius: 50%; background: #2c4a7c; }
.cal-day.today.has-event::after { background: white; }
.cal-day.other-month { color: var(--border2); }

.event-item { display: flex; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--border); align-items: flex-start; }
.event-item:last-child { border-bottom: none; }
.event-time-col { width: 50px; flex-shrink: 0; }
.event-time { font-size: 11px; font-family: 'DM Mono', monospace; color: var(--ink3); }
.event-bar { width: 3px; border-radius: 2px; margin-top: 4px; height: 30px; }
.event-info { flex: 1; }
.event-name { font-size: 12px; font-weight: 600; color: var(--ink); }
.event-detail { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 2px; }

.bill-item { display: flex; align-items: center; gap: 10px; padding: 9px 0; border-bottom: 1px solid var(--border); }
.bill-item:last-child { border-bottom: none; }
.bill-icon { width: 28px; height: 28px; border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
.bill-info { flex: 1; }
.bill-name { font-size: 12px; font-weight: 600; color: var(--ink); }
.bill-freq { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); }
.bill-amount { font-size: 13px; font-family: 'DM Mono', monospace; font-weight: 500; color: var(--ink); }
.price-change { font-size: 9px; color: var(--red); display: flex; align-items: center; gap: 2px; }

.stat-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px; }
.stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 14px 16px; }
.stat-value { font-size: 22px; font-weight: 800; color: var(--ink); line-height: 1; }
.stat-label { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }
.stat-change { font-size: 10px; font-family: 'DM Mono', monospace; margin-top: 6px; }
.change-up { color: var(--green); }
.change-down { color: var(--red); }

.wallet-card { background: linear-gradient(135deg, #1a1714 0%, #2d2520 100%); border-radius: 12px; padding: 20px; margin-bottom: 12px; position: relative; overflow: hidden; cursor: pointer; transition: transform 0.2s ease; }
.wallet-card:hover { transform: translateY(-2px); }
.wallet-card::before { content: ''; position: absolute; top: -30px; right: -30px; width: 120px; height: 120px; border-radius: 50%; background: rgba(200, 82, 26, 0.15); }
.wallet-type { font-size: 9px; font-family: 'DM Mono', monospace; letter-spacing: 2px; text-transform: uppercase; color: rgba(255,255,255,0.4); margin-bottom: 12px; }
.wallet-event { font-size: 16px; font-weight: 700; color: white; margin-bottom: 4px; }
.wallet-detail { font-size: 11px; font-family: 'DM Mono', monospace; color: rgba(255,255,255,0.4); }
.wallet-barcode { margin-top: 14px; height: 36px; background: repeating-linear-gradient(90deg, rgba(255,255,255,0.8) 0px, rgba(255,255,255,0.8) 2px, transparent 2px, transparent 5px); border-radius: 3px; opacity: 0.6; }

.trip-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; overflow: hidden; margin-bottom: 10px; cursor: pointer; transition: all 0.2s ease; }
.trip-card:hover { border-color: #2c4a7c; box-shadow: 0 4px 16px rgba(44,74,124,0.15); }
.trip-img { height: 80px; background: linear-gradient(135deg, var(--bg2) 0%, var(--border) 100%); display: flex; align-items: center; justify-content: center; font-size: 32px; }
.trip-info { padding: 10px 12px; }
.trip-name { font-size: 13px; font-weight: 700; color: var(--ink); }
.trip-dates { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 2px; }

.meal-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-bottom: 8px; display: flex; gap: 10px; align-items: center; }
.meal-emoji { font-size: 24px; }
.meal-info { flex: 1; }
.meal-name { font-size: 12px; font-weight: 700; color: var(--ink); }
.meal-macros { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 2px; }
.meal-day { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); }

.call-item { display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--border); }
.call-item:last-child { border-bottom: none; }
.call-avatar { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; color: white; flex-shrink: 0; }
.call-info { flex: 1; }
.call-name { font-size: 12px; font-weight: 600; color: var(--ink); }
.call-summary { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 2px; line-height: 1.4; }
.call-meta { text-align: right; }
.call-time { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); }
.call-duration { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); }

::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}
.content.active { animation: fadeIn 0.25s ease both; }

.toast {
  position: fixed; bottom: 24px; right: 24px;
  background: #1e3560; color: white; padding: 12px 18px;
  border-radius: 10px; font-size: 12px; font-family: 'DM Mono', monospace;
  display: flex; align-items: center; gap: 8px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.2); z-index: 1000;
  transform: translateY(80px); opacity: 0;
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.toast.show { transform: translateY(0); opacity: 1; }

.add-task-row { display: flex; gap: 8px; margin-bottom: 12px; }

.task-input {
  flex: 1; padding: 8px 12px; border: 1px solid var(--border);
  border-radius: 7px; font-size: 12px; font-family: 'Raleway', sans-serif;
  background: var(--surface); color: var(--ink); outline: none; transition: border-color 0.15s;
}
.task-input:focus { border-color: #2c4a7c; }
.task-input::placeholder { color: var(--ink3); }

/* â”€â”€ TRANSACTIONS â”€â”€ */
.tx-item {
  display: flex; align-items: center; gap: 12px;
  padding: 11px 0; border-bottom: 1px solid var(--border);
  cursor: pointer; transition: background 0.15s;
  border-radius: 4px;
}
.tx-item:last-child { border-bottom: none; }
.tx-item:hover { background: var(--bg2); margin: 0 -6px; padding: 11px 6px; }

.tx-logo {
  width: 32px; height: 32px; border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; font-weight: 800; flex-shrink: 0;
  letter-spacing: -0.5px;
}

.tx-info { flex: 1; min-width: 0; }

.tx-merchant {
  font-size: 12px; font-weight: 700; color: var(--ink);
  display: flex; align-items: center; gap: 6px;
}

.tx-meta { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 2px; }

.tx-right { text-align: right; flex-shrink: 0; }

.tx-amount {
  font-size: 13px; font-family: 'DM Mono', monospace;
  font-weight: 600; color: var(--ink);
}
.tx-amount.credit { color: var(--green); }
.tx-amount.debit { color: var(--ink); }

.tx-date { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 2px; }

/* Receipt badge on transaction */
.receipt-badge {
  display: inline-flex; align-items: center; gap: 3px;
  font-size: 9px; font-family: 'DM Mono', monospace;
  background: #dcfce7; color: #166534;
  border: 1px solid rgba(22,101,52,0.2);
  padding: 2px 7px; border-radius: 4px;
  letter-spacing: 0.5px; text-transform: uppercase;
  cursor: pointer; transition: all 0.15s;
}
.receipt-badge:hover { background: #bbf7d0; }

.cat-pill {
  font-size: 9px; font-family: 'DM Mono', monospace;
  padding: 2px 7px; border-radius: 4px;
  text-transform: uppercase; letter-spacing: 0.5px;
}
.cat-food { background: #fef3c7; color: #92400e; }
.cat-transport { background: var(--blue-light); color: var(--blue); }
.cat-shopping { background: var(--purple-light); color: var(--purple); }
.cat-subs { background: #fdf4ff; color: #7e22ce; }
.cat-housing { background: #f0f9ff; color: #0369a1; }

/* Receipt modal overlay */
.modal-overlay {
  position: fixed; inset: 0; background: rgba(26,23,20,0.6);
  z-index: 200; display: none; align-items: center; justify-content: center;
  backdrop-filter: blur(4px);
}
.modal-overlay.open { display: flex; animation: fadeIn 0.2s ease; }

.receipt-modal {
  background: var(--surface); border-radius: 14px;
  width: 340px; max-height: 80vh; overflow-y: auto;
  box-shadow: 0 32px 80px rgba(0,0,0,0.25);
  border: 1px solid var(--border);
}

.receipt-modal-header {
  padding: 18px 20px 14px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 12px;
}

.receipt-modal-close {
  margin-left: auto; width: 24px; height: 24px;
  border-radius: 50%; background: var(--bg2);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 12px; color: var(--ink3);
  transition: all 0.15s; border: none;
}
.receipt-modal-close:hover { background: var(--border); color: var(--ink); }

.receipt-body { padding: 16px 20px; }

/* Tesco-style receipt */
.receipt-paper {
  background: #fffef9;
  border: 1px solid #e8e4dc;
  border-radius: 6px;
  padding: 16px;
  font-family: 'DM Mono', monospace;
  font-size: 11px;
  color: #2a2420;
}

.receipt-paper-header {
  text-align: center;
  border-bottom: 1px dashed #ccc;
  padding-bottom: 10px;
  margin-bottom: 10px;
}

.receipt-store-name {
  font-size: 16px;
  font-weight: 700;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: #00539f;
}

.receipt-store-sub {
  font-size: 9px;
  color: #888;
  margin-top: 2px;
  letter-spacing: 1px;
}

.receipt-line {
  display: flex;
  justify-content: space-between;
  padding: 3px 0;
  border-bottom: 1px solid #f0ede8;
  gap: 8px;
}
.receipt-line:last-child { border-bottom: none; }

.receipt-line-name { flex: 1; }
.receipt-line-qty { color: #888; width: 24px; text-align: center; flex-shrink: 0; }
.receipt-line-price { font-weight: 600; flex-shrink: 0; text-align: right; }

.receipt-divider {
  border: none;
  border-top: 1px dashed #ccc;
  margin: 8px 0;
}

.receipt-total-row {
  display: flex;
  justify-content: space-between;
  padding: 4px 0;
  font-size: 12px;
}

.receipt-total-row.grand {
  font-size: 14px;
  font-weight: 700;
  border-top: 2px solid #2a2420;
  margin-top: 4px;
  padding-top: 6px;
}

.receipt-footer {
  text-align: center;
  margin-top: 10px;
  padding-top: 8px;
  border-top: 1px dashed #ccc;
  font-size: 9px;
  color: #aaa;
  line-height: 1.6;
}

.receipt-barcode-img {
  margin: 8px auto 0;
  height: 28px;
  background: repeating-linear-gradient(
    90deg,
    #333 0px, #333 1.5px,
    transparent 1.5px, transparent 4px
  );
  border-radius: 2px;
  opacity: 0.6;
  width: 160px;
}

/* Tesco logo colours */
.tesco-logo {
  background: #00539f;
  color: white;
  font-family: 'Raleway', sans-serif;
  font-size: 11px;
  font-weight: 800;
  letter-spacing: 1px;
}

.tesco-logo {
  background: #00539f;
  color: white;
  font-family: 'Raleway', sans-serif;
  font-size: 11px;
  font-weight: 800;
  letter-spacing: 1px;
}

/* â”€â”€ TRIP PLANNER MODAL â”€â”€ */
.trip-modal-overlay {
  position: fixed; inset: 0;
  background: rgba(13,17,23,0.7);
  z-index: 250;
  display: none;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(6px);
}
.trip-modal-overlay.open { display: flex; animation: fadeIn 0.2s ease; }

.trip-modal {
  background: var(--surface);
  border-radius: 16px;
  width: min(780px, calc(100vw - 24px));
  max-height: 88vh;
  overflow-y: auto;
  box-shadow: 0 40px 100px rgba(0,0,0,0.3);
  border: 1px solid var(--border);
  display: flex;
  flex-direction: column;
}

.trip-modal-hero {
  height: 140px;
  background: linear-gradient(135deg, #1e3560 0%, #2c4a7c 50%, #3a6099 100%);
  position: relative;
  overflow: hidden;
  flex-shrink: 0;
  border-radius: 16px 16px 0 0;
  display: flex;
  align-items: flex-end;
  padding: 20px 24px;
}

.trip-modal-hero::before {
  content: 'ðŸ—½';
  position: absolute;
  top: -10px; right: 20px;
  font-size: 100px;
  opacity: 0.18;
  transform: rotate(-5deg);
}

.trip-modal-hero-text { position: relative; z-index: 1; }

.trip-modal-hero h2 {
  font-size: 22px;
  font-weight: 800;
  color: white;
  letter-spacing: -0.5px;
  line-height: 1.1;
}

.trip-modal-hero p {
  font-size: 11px;
  font-family: 'DM Mono', monospace;
  color: rgba(255,255,255,0.5);
  margin-top: 4px;
  letter-spacing: 1px;
}

.trip-modal-close-btn {
  position: absolute;
  top: 14px; right: 16px;
  width: 28px; height: 28px;
  border-radius: 50%;
  background: rgba(255,255,255,0.15);
  border: none;
  color: white;
  font-size: 13px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  z-index: 2;
  transition: background 0.15s;
}
.trip-modal-close-btn:hover { background: rgba(255,255,255,0.25); }

/* Step indicator */
.trip-steps {
  display: flex;
  align-items: center;
  padding: 16px 24px;
  border-bottom: 1px solid var(--border);
  gap: 0;
  flex-shrink: 0;
}

.trip-step {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
}

.trip-step-dot {
  width: 24px; height: 24px;
  border-radius: 50%;
  background: var(--border);
  display: flex; align-items: center; justify-content: center;
  font-size: 10px;
  font-family: 'DM Mono', monospace;
  font-weight: 700;
  color: var(--ink3);
  flex-shrink: 0;
  transition: all 0.25s;
}

.trip-step-dot.active {
  background: #2c4a7c;
  color: white;
}

.trip-step-dot.done {
  background: #166534;
  color: white;
}

.trip-step-label {
  font-size: 10px;
  font-family: 'DM Mono', monospace;
  color: var(--ink3);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  transition: color 0.25s;
}

.trip-step-label.active { color: #2c4a7c; font-weight: 700; }
.trip-step-label.done { color: #166534; }

.trip-step-line {
  flex: 1;
  height: 1px;
  background: var(--border);
  margin: 0 8px;
}

.trip-step-line.done { background: #166534; }

/* Step panels */
.trip-panel { display: none; padding: 20px 24px; flex: 1; }
.trip-panel.active { display: block; }

/* Date grid */
.date-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 16px;
}

.date-field label {
  display: block;
  font-size: 10px;
  font-family: 'DM Mono', monospace;
  color: var(--ink3);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 6px;
}

.date-field input,
.date-field select {
  width: 100%;
  padding: 9px 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 13px;
  font-family: 'Raleway', sans-serif;
  background: var(--surface);
  color: var(--ink);
  outline: none;
  transition: border-color 0.15s;
}

.date-field input:focus,
.date-field select:focus { border-color: #2c4a7c; }

/* Preference chips */
.pref-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 16px;
}

.pref-chip {
  padding: 7px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  border: 1.5px solid var(--border);
  background: var(--surface);
  color: var(--ink2);
  transition: all 0.15s;
  user-select: none;
}

.pref-chip.selected {
  background: #2c4a7c;
  border-color: #2c4a7c;
  color: white;
}

/* Flight cards */
.flight-option {
  border: 1.5px solid var(--border);
  border-radius: 10px;
  padding: 14px 16px;
  margin-bottom: 10px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 16px;
}
.flight-option:hover { border-color: #2c4a7c; background: var(--surface2); }
.flight-option.selected { border-color: #2c4a7c; background: var(--blue-light); }

.flight-airline {
  font-size: 10px;
  font-family: 'DM Mono', monospace;
  color: var(--ink3);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.flight-times {
  display: flex;
  align-items: center;
  gap: 10px;
  flex: 1;
}

.flight-time {
  font-size: 18px;
  font-weight: 800;
  color: var(--ink);
  font-family: 'DM Mono', monospace;
}

.flight-route-line {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}

.flight-duration {
  font-size: 9px;
  font-family: 'DM Mono', monospace;
  color: var(--ink3);
}

.flight-line {
  width: 100%;
  height: 1px;
  background: var(--border2);
  position: relative;
}

.flight-line::after {
  content: 'âœˆ';
  position: absolute;
  right: -4px;
  top: -7px;
  font-size: 12px;
}

.flight-price {
  font-size: 16px;
  font-weight: 800;
  font-family: 'DM Mono', monospace;
  color: var(--ink);
  text-align: right;
}

.flight-price-sub {
  font-size: 9px;
  font-family: 'DM Mono', monospace;
  color: var(--ink3);
  text-align: right;
}

/* Hotel cards */
.hotel-option {
  border: 1.5px solid var(--border);
  border-radius: 10px;
  padding: 14px 16px;
  margin-bottom: 10px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  gap: 14px;
  align-items: flex-start;
}
.hotel-option:hover { border-color: #2c4a7c; background: var(--surface2); }
.hotel-option.selected { border-color: #2c4a7c; background: var(--blue-light); }

.hotel-img {
  width: 56px; height: 56px;
  border-radius: 8px;
  background: linear-gradient(135deg, var(--bg2), var(--border));
  display: flex; align-items: center; justify-content: center;
  font-size: 26px;
  flex-shrink: 0;
}

.hotel-info { flex: 1; }
.hotel-name { font-size: 13px; font-weight: 700; color: var(--ink); }
.hotel-location { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 2px; }
.hotel-stars { font-size: 11px; color: #f59e0b; margin-top: 3px; }
.hotel-price { font-size: 14px; font-weight: 800; font-family: 'DM Mono', monospace; color: var(--ink); text-align: right; }
.hotel-price-sub { font-size: 9px; font-family: 'DM Mono', monospace; color: var(--ink3); text-align: right; }

/* Itinerary day */
.itin-day {
  margin-bottom: 18px;
}

.itin-day-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.itin-day-num {
  width: 28px; height: 28px;
  border-radius: 50%;
  background: #2c4a7c;
  color: white;
  font-size: 11px;
  font-family: 'DM Mono', monospace;
  font-weight: 700;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}

.itin-day-title { font-size: 13px; font-weight: 700; color: var(--ink); }
.itin-day-sub { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); }

.itin-item {
  display: flex;
  gap: 12px;
  padding: 8px 0;
  border-bottom: 1px solid var(--border);
  align-items: flex-start;
}
.itin-item:last-child { border-bottom: none; }

.itin-time {
  width: 48px;
  font-size: 10px;
  font-family: 'DM Mono', monospace;
  color: var(--ink3);
  flex-shrink: 0;
  padding-top: 2px;
}

.itin-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
  margin-top: 4px;
}

.itin-info { flex: 1; }
.itin-name { font-size: 12px; font-weight: 600; color: var(--ink); }
.itin-detail { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 1px; }
.itin-tag {
  font-size: 9px; font-family: 'DM Mono', monospace;
  padding: 1px 6px; border-radius: 3px;
  text-transform: uppercase; display: inline-block; margin-top: 3px;
}
.itin-tag-food { background: #fef3c7; color: #92400e; }
.itin-tag-culture { background: var(--purple-light); color: #4c1d95; }
.itin-tag-transit { background: var(--blue-light); color: #1a3260; }
.itin-tag-hotel { background: var(--green-light); color: #166534; }

/* Summary box */
.trip-summary-box {
  background: #1e3560;
  border-radius: 10px;
  padding: 16px 18px;
  margin-bottom: 16px;
  color: white;
}

.trip-summary-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  gap: 12px;
  margin-top: 10px;
}

.trip-summary-item { }
.trip-summary-label { font-size: 9px; font-family: 'DM Mono', monospace; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 1px; }
.trip-summary-val { font-size: 14px; font-weight: 700; color: white; margin-top: 3px; }

/* Modal footer */
.trip-modal-footer {
  padding: 14px 24px;
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-shrink: 0;
  background: var(--surface2);
  border-radius: 0 0 16px 16px;
}

/* AI thinking animation */
.ai-thinking {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 20px;
  justify-content: center;
  flex-direction: column;
}

.ai-dots {
  display: flex; gap: 6px;
}

.ai-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: #2c4a7c;
  animation: aiPulse 1.2s infinite ease-in-out;
}

.ai-dot:nth-child(2) { animation-delay: 0.2s; }
.ai-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes aiPulse {
  0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
  40% { transform: scale(1); opacity: 1; }
}

@media (max-width: 768px) {
  .trip-modal-hero { height: 110px; }
  .trip-modal-hero h2 { font-size: 18px; }
  .trip-steps { padding: 12px 14px; gap: 0; }
  .trip-step-label { display: none; }
  .trip-panel { padding: 14px 16px; }
  .date-grid { grid-template-columns: 1fr; }
  .flight-time { font-size: 15px; }
  .trip-summary-grid { grid-template-columns: 1fr 1fr; }
  .trip-modal-footer { padding: 10px 16px; }
}

/* â”€â”€ ASK ANN â”€â”€ */
.ann-ask-box {
  background: var(--surface);
  border-radius: 12px;
  border: 1px solid var(--border);
  overflow: hidden;
}
.ann-ask-header {
  display: flex; align-items: center; gap: 10px;
  padding: 16px 18px 12px;
  border-bottom: 1px solid var(--border);
}
.ann-ask-icon {
  width: 28px; height: 28px; border-radius: 7px;
  background: #2c4a7c;
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; color: white; flex-shrink: 0;
}
.ann-ask-body {
  padding: 14px 18px;
}
.ann-ask-suggestions {
  display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px;
}
.ann-suggestion {
  font-size: 11px; font-family: 'DM Mono', monospace;
  background: var(--bg2); color: var(--ink2);
  border: 1px solid var(--border);
  padding: 5px 12px; border-radius: 16px; cursor: pointer;
  transition: all 0.15s;
}
.ann-suggestion:hover { background: var(--border); color: var(--ink); }
.ann-ask-input-row {
  display: flex; gap: 8px; align-items: center;
}
.ann-ask-input {
  flex: 1; padding: 10px 14px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px; color: var(--ink);
  font-size: 12px; font-family: 'Raleway', sans-serif;
  outline: none; transition: border-color 0.15s;
}
.ann-ask-input::placeholder { color: var(--ink3); }
.ann-ask-input:focus { border-color: #2c4a7c; }
.ann-ask-send {
  width: 36px; height: 36px; border-radius: 10px;
  background: #2c4a7c; color: white;
  border: none; font-size: 14px; font-weight: 700;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  flex-shrink: 0; transition: background 0.15s;
}
.ann-ask-send:hover { background: #1e3560; }
.ann-response {
  margin-top: 12px; padding: 12px 14px;
  background: var(--blue-light);
  border: 1px solid rgba(44,74,124,0.2);
  border-radius: 10px;
  font-size: 12px; color: var(--ink2);
  line-height: 1.6; font-family: 'Raleway', sans-serif;
}
.ann-thinking {
  display: flex; gap: 4px; align-items: center;
}
.ann-thinking span {
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--ink3);
  animation: aiPulse 1.2s infinite ease-in-out;
}
.ann-thinking span:nth-child(2) { animation-delay: 0.2s; }
.ann-thinking span:nth-child(3) { animation-delay: 0.4s; }

/* â”€â”€ MEETINGS â”€â”€ */
.meeting-item {
  display: flex; align-items: center; gap: 10px;
  padding: 12px 0; border-bottom: 1px solid var(--border);
  cursor: pointer; border-radius: 6px; transition: background 0.15s;
}
.meeting-item:last-child { border-bottom: none; }
.meeting-item:hover { background: var(--bg2); margin: 0 -6px; padding: 12px 6px; }
.meeting-item.active-meeting { background: var(--blue-light); margin: 0 -6px; padding: 12px 6px; border-color: transparent; }

.meeting-time-col { width: 44px; flex-shrink: 0; }
.meeting-time { font-size: 11px; font-family: 'DM Mono', monospace; font-weight: 700; color: var(--ink); }
.meeting-duration { font-size: 9px; font-family: 'DM Mono', monospace; color: var(--ink3); }
.meeting-bar { width: 3px; height: 36px; border-radius: 2px; flex-shrink: 0; }
.meeting-info { flex: 1; }
.meeting-name { font-size: 12px; font-weight: 700; color: var(--ink); }
.meeting-who { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 2px; }
.meeting-status-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.meeting-status-dot.live { background: #ef4444; animation: pulse 1.5s infinite; }

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(0.85); }
}

.meet-toggle { font-size: 11px; transition: all 0.15s; }
.meet-toggle.active { background: #2c4a7c; color: white; border-color: #2c4a7c; }

/* â”€â”€ MEETING VIEW SIZING â”€â”€ */
#view-meetings { height: 100%; }
#view-meetings > div {
  display: grid;
  grid-template-columns: minmax(0, 1fr) minmax(0, 1.5fr);
  gap: 16px;
  align-items: start;
}
#view-meetings .card { min-height: 0; }

/* Briefing list */
.briefing-item {
  display: flex; gap: 10px; padding: 8px 0;
  border-bottom: 1px solid var(--border); font-size: 12px;
}
.briefing-item:last-child { border-bottom: none; }
.briefing-dot { width: 6px; height: 6px; border-radius: 50%; margin-top: 5px; flex-shrink: 0; }
.briefing-label { font-size: 9px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 2px; }

/* â”€â”€ VIDEO CALL â”€â”€ */
.video-tile {
  border-radius: 10px; overflow: hidden;
  background: #1e293b;
}
.video-person-bg {
  width: 100%; height: 100%;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  min-height: 160px; position: relative;
  padding-bottom: 24px;
}
.video-avatar-big {
  width: 60px; height: 60px; border-radius: 50%;
  background: rgba(255,255,255,0.15);
  display: flex; align-items: center; justify-content: center;
  font-size: 26px; font-weight: 800; color: white;
  font-family: 'Raleway', sans-serif;
}
.video-name-tag {
  position: absolute; bottom: 8px; left: 10px;
  font-size: 11px; font-family: 'DM Mono', monospace;
  color: white; background: rgba(0,0,0,0.5);
  padding: 2px 8px; border-radius: 4px;
}
.video-cam-off-icon {
  font-size: 24px; opacity: 0.4; position: absolute;
  top: 50%; left: 50%; transform: translate(-50%,-50%);
}

.call-ctrl-btn {
  width: 44px; height: 44px; border-radius: 50%;
  background: rgba(255,255,255,0.1); border: none;
  font-size: 18px; cursor: pointer;
  transition: all 0.15s; display: flex;
  align-items: center; justify-content: center;
}
.call-ctrl-btn:hover { background: rgba(255,255,255,0.18); }
.call-ctrl-btn.muted { background: rgba(239,68,68,0.25); }
.call-ctrl-btn.active { background: rgba(255,255,255,0.15); }

.chat-msg { display: flex; flex-direction: column; gap: 1px; }
.chat-who { font-size: 9px; font-family: 'DM Mono', monospace; color: rgba(255,255,255,0.35); }
.chat-text { font-size: 11px; color: rgba(255,255,255,0.8); font-family: 'Raleway', sans-serif; }

@media (max-width: 768px) {
  #view-meetings > div { grid-template-columns: 1fr !important; }
  .video-avatar-big { width: 44px; height: 44px; font-size: 20px; }
  #call-window { border-radius: 0 !important; height: 100vh !important; width: 100vw !important; }
  #video-grid { grid-template-columns: 1fr 1fr !important; grid-template-rows: 1fr 1fr !important; }
  #video-grid > div:first-child { grid-column: 1 !important; grid-row: 1 !important; }
  .ann-ask-suggestions { display: none; }
}

/* â”€â”€ MEAL PLANNER â”€â”€ */
.meal-tab {
  padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: 700;
  font-family: 'Raleway', sans-serif; cursor: pointer; border: 1.5px solid var(--border);
  background: var(--surface); color: var(--ink2); transition: all 0.15s;
}
.meal-tab.active { background: #2c4a7c; border-color: #2c4a7c; color: white; }
.meal-tab:hover:not(.active) { border-color: #2c4a7c; color: #2c4a7c; }

.day-block {
  border-bottom: 1px solid var(--border);
}
.day-block:last-child { border-bottom: none; }

.day-header {
  display: flex; align-items: center; gap: 10px;
  padding: 12px 16px 8px;
  cursor: pointer; user-select: none;
}
.day-label {
  font-size: 11px; font-weight: 800; font-family: 'DM Mono', monospace;
  text-transform: uppercase; letter-spacing: 1.5px; color: #2c4a7c; width: 32px;
}
.day-date {
  font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3);
}
.day-kcal-total {
  margin-left: auto; font-size: 10px; font-family: 'DM Mono', monospace;
  color: var(--ink3); background: var(--bg2); padding: 2px 8px; border-radius: 10px;
}
.day-meals-grid {
  display: grid; grid-template-columns: 1fr 1fr 1fr 0.7fr;
  gap: 8px; padding: 0 12px 12px;
}
.meal-slot {
  border: 1.5px dashed var(--border); border-radius: 10px; padding: 10px;
  cursor: pointer; transition: all 0.18s; min-height: 80px;
  display: flex; flex-direction: column; gap: 4px; position: relative;
}
.meal-slot:hover { border-color: #2c4a7c; background: var(--blue-light); }
.meal-slot.filled { border-style: solid; border-color: var(--border2); background: var(--surface2); }
.meal-slot.filled:hover { border-color: #2c4a7c; background: var(--blue-light); }

.slot-label {
  font-size: 9px; font-family: 'DM Mono', monospace; text-transform: uppercase;
  letter-spacing: 1px; color: var(--ink3); font-weight: 700;
}
.slot-emoji { font-size: 20px; line-height: 1; }
.slot-name { font-size: 11px; font-weight: 700; color: var(--ink); line-height: 1.2; }
.slot-kcal { font-size: 9px; font-family: 'DM Mono', monospace; color: var(--ink3); }
.slot-empty-hint {
  font-size: 10px; color: var(--ink3); font-family: 'DM Mono', monospace;
  margin: auto; text-align: center; line-height: 1.5;
}
.slot-clear-btn {
  position: absolute; top: 5px; right: 6px; font-size: 10px; color: var(--ink3);
  background: none; border: none; cursor: pointer; padding: 0; line-height: 1;
  display: none;
}
.meal-slot.filled:hover .slot-clear-btn { display: block; }

.snack-slot { background: var(--bg); }
.snack-slot .slot-label { color: var(--amber); }

/* Recipe list item */
.recipe-list-item {
  display: flex; align-items: center; gap: 10px; padding: 9px 10px;
  border-radius: 8px; cursor: pointer; transition: background 0.15s;
  border: 1px solid transparent;
}
.recipe-list-item:hover { background: var(--bg2); }
.recipe-list-item.active { background: var(--blue-light); border-color: #2c4a7c; }
.recipe-item-emoji { font-size: 22px; flex-shrink: 0; }
.recipe-item-name { font-size: 12px; font-weight: 700; color: var(--ink); }
.recipe-item-meta { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--ink3); margin-top: 1px; }

/* Slot recipe picker item */
.slot-recipe-item {
  display: flex; align-items: center; gap: 10px; padding: 8px 10px;
  border-radius: 8px; cursor: pointer; transition: background 0.15s;
  border: 1.5px solid var(--border); background: var(--surface2);
}
.slot-recipe-item:hover { border-color: #2c4a7c; background: var(--blue-light); }

@media (max-width: 768px) {
  .day-meals-grid { grid-template-columns: 1fr 1fr; }
  .meal-slot { min-height: 70px; }
  .slot-emoji { font-size: 16px; }
  .slot-name { font-size: 10px; }
}
@media (max-width: 480px) {
  .day-meals-grid { grid-template-columns: 1fr 1fr; }
}

/* â”€â”€ MOBILE BOTTOM NAV â”€â”€ */
.mobile-nav {
  display: none;
  position: fixed;
  bottom: 0; left: 0; right: 0;
  background: #2c4a7c;
  height: 60px;
  z-index: 300;
  border-top: 1px solid rgba(255,255,255,0.1);
  padding: 0 4px;
}

.mobile-nav-inner {
  display: flex;
  height: 100%;
  align-items: center;
  width: 100%;
}

.mobile-nav-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 3px;
  padding: 6px 4px;
  border-radius: 10px;
  cursor: pointer;
  color: rgba(255,255,255,0.5);
  font-size: 9px;
  font-family: 'DM Mono', monospace;
  letter-spacing: 0.5px;
  transition: all 0.15s;
  flex: 1;
  position: relative;
}

.mobile-nav-btn.active {
  color: white;
  background: rgba(255,255,255,0.12);
}

.mobile-nav-icon { font-size: 18px; line-height: 1; }

.mobile-nav-badge {
  position: absolute;
  top: 2px; right: 6px;
  background: #ef4444;
  color: white;
  font-size: 8px;
  font-family: 'DM Mono', monospace;
  width: 14px; height: 14px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
}

/* Mobile drawer for full nav */
.mobile-drawer-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 400;
  backdrop-filter: blur(4px);
}

.mobile-drawer-overlay.open { display: block; }

.mobile-drawer {
  position: fixed;
  top: 0; left: 0; bottom: 0;
  width: 260px;
  background: #2c4a7c;
  z-index: 500;
  transform: translateX(-100%);
  transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  flex-direction: column;
  padding: 20px 0;
  overflow-y: auto;
}

.mobile-drawer.open {
  transform: translateX(0);
}

.mobile-drawer .sidebar-brand {
  padding: 0 20px 20px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  margin-bottom: 8px;
}

.mobile-drawer .sidebar-nav {
  padding: 8px 12px;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.mobile-drawer .nav-item { font-size: 14px; padding: 11px 12px; }

.mobile-drawer .sidebar-profile {
  padding: 14px 20px;
  border-top: 1px solid rgba(255,255,255,0.1);
}

/* â”€â”€ RESPONSIVE BREAKPOINTS â”€â”€ */
@media (max-width: 768px) {

  body { overflow: hidden; }

  /* Hide desktop sidebar and titlebar dots */
  .sidebar { display: none; }
  .titlebar-dots { display: none; }

  /* Titlebar becomes mobile header */
  .titlebar {
    height: 48px;
    padding: 0 16px;
    justify-content: space-between;
  }

  .titlebar-title {
    font-size: 13px;
    letter-spacing: 1.5px;
    color: rgba(255,255,255,0.7);
    flex: unset;
    text-align: left;
  }

  .titlebar-time {
    font-size: 12px;
    color: rgba(255,255,255,0.5);
  }

  /* Show hamburger menu button */
  .mobile-menu-btn {
    display: flex !important;
    align-items: center;
    justify-content: center;
    width: 32px; height: 32px;
    border-radius: 8px;
    background: rgba(255,255,255,0.1);
    color: white;
    font-size: 16px;
    cursor: pointer;
    border: none;
  }

  /* Main area fills screen */
  .main { width: 100%; }

  /* Topbar compact */
  .topbar {
    height: 50px;
    padding: 0 16px;
    gap: 8px;
  }

  .topbar-title { font-size: 14px; }
  .topbar-sub { display: none; }

  .topbar-actions { gap: 6px; }

  /* Hide Sync button on mobile */
  .topbar-actions .btn-ghost:first-child { display: none; }

  .btn { padding: 7px 12px; font-size: 11px; }

  /* Content padding */
  .content { padding: 14px 12px 80px; }

  /* Dashboard grid â†’ single column */
  .dashboard-grid {
    grid-template-columns: 1fr !important;
    gap: 12px;
  }

  /* Stat row â†’ 2 columns */
  .stat-row {
    grid-template-columns: 1fr 1fr !important;
    gap: 8px;
    margin-bottom: 12px;
  }

  .stat-card { padding: 10px 12px; }
  .stat-value { font-size: 18px; }
  .stat-label { font-size: 9px; }
  .stat-change { font-size: 9px; }

  /* Cards */
  .card { border-radius: 10px; }
  .card-header { padding: 12px 14px 10px; gap: 8px; }
  .card-title { font-size: 12px; }
  .card-sub { font-size: 9px; }
  .card-body { padding: 10px 14px; }

  /* Whats new card */
  .whats-new-body { padding: 10px 14px; }
  .profile-tag { font-size: 10px; padding: 4px 10px; }

  /* Budget chart wraps vertically on small screens */
  .budget-chart-wrap { flex-direction: column; align-items: flex-start; gap: 12px; }
  .pie-wrap { margin: 0 auto; }

  /* Task items */
  .task-text { font-size: 11px; }
  .task-source { font-size: 8px; }

  /* Email items */
  .email-from { font-size: 11px; }
  .email-subject { font-size: 10px; }
  .email-summary { font-size: 9px; }

  /* Inventory */
  .inv-name { font-size: 11px; }
  .inv-qty { font-size: 10px; }

  /* Bill items */
  .bill-name { font-size: 11px; }
  .bill-freq { font-size: 9px; }
  .bill-amount { font-size: 12px; }

  /* Parcel items */
  .parcel-name { font-size: 11px; }
  .parcel-courier { font-size: 9px; }
  .status-pill { font-size: 8px; padding: 2px 6px; }

  /* Transaction items */
  .tx-merchant { font-size: 11px; }
  .tx-meta { font-size: 9px; }
  .tx-amount { font-size: 12px; }
  .cat-pill { font-size: 8px; padding: 1px 5px; }

  /* Wallet cards */
  .wallet-card { padding: 16px; }
  .wallet-event { font-size: 14px; }

  /* Trip cards grid â†’ 1 col */
  .dashboard-grid > .card,
  [style*="grid-template-columns:1fr 1fr 1fr"] {
    grid-template-columns: 1fr !important;
  }

  /* Multi-col layouts â†’ single col */
  [style*="grid-template-columns:1fr 1.6fr"],
  [style*="grid-template-columns:1fr 1.4fr"],
  [style*="grid-template-columns:1.2fr 1fr"],
  [style*="grid-template-columns:1.3fr 1fr"],
  [style*="grid-template-columns:1fr 1fr"] {
    grid-template-columns: 1fr !important;
  }

  /* Notification panel */
  .notif-panel {
    top: 98px;
    right: 12px;
    left: 12px;
    width: auto;
  }

  /* Receipt modal full width on mobile */
  .receipt-modal { width: calc(100vw - 32px); max-height: 85vh; }

  /* Mobile nav visible */
  .mobile-nav { display: flex; }

  /* Calendar grid text */
  .cal-day { font-size: 11px; }
  .cal-day-label { font-size: 8px; }

  /* Event items */
  .event-name { font-size: 11px; }
  .event-detail { font-size: 9px; }

  /* Call items */
  .call-name { font-size: 11px; }
  .call-summary { font-size: 9px; }

  /* Meal cards */
  .meal-name { font-size: 11px; }
  .meal-macros { font-size: 9px; }

  /* VAT/Tax tables */
  table { font-size: 11px !important; }

  /* Buttons in headers */
  .card-header .btn { font-size: 10px; padding: 5px 10px; }

  /* Add task row */
  .add-task-row { gap: 6px; }
  .task-input { font-size: 11px; padding: 7px 10px; }

  /* Hide topbar sub text */
  #topbar-sub { display: none; }
}

@media (max-width: 400px) {
  .stat-row { grid-template-columns: 1fr 1fr !important; }
  .stat-value { font-size: 16px; }
  .content { padding: 10px 10px 80px; }
  .card-header { padding: 10px 12px 8px; }
  .card-body { padding: 8px 12px; }
  .topbar { height: 46px; padding: 0 12px; }
  .topbar-title { font-size: 13px; }
  .profile-tag { font-size: 9px; padding: 3px 8px; }
  .mobile-nav-btn { min-width: 0; font-size: 8px; flex: 1; }
  .mobile-nav-icon { font-size: 16px; }
}

@media (min-width: 769px) and (max-width: 1200px) {
  .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
}

/* â”€â”€ Chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#view-chat { padding: 0 !important; display: none; height: 100%; }
#view-chat.active { display: flex; flex-direction: column; }
.chat-layout {
  display: grid;
  grid-template-columns: 300px minmax(0, 1fr);
  height: 100%;
  overflow: hidden;
}
.chat-sidebar {
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: var(--surface);
}
.chat-sidebar-header {
  padding: 16px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.chat-search {
  width: 100%;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 13px;
  color: var(--ink);
  font-family: inherit;
  outline: none;
}
.chat-search::placeholder { color: var(--ink3); }
.chat-tabs {
  display: flex;
  gap: 6px;
  margin-top: 10px;
}
.chat-tab-btn {
  flex: 1;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 7px;
  padding: 5px 0;
  font-size: 11px;
  font-weight: 600;
  color: var(--ink2);
  cursor: pointer;
  font-family: inherit;
  transition: all .15s;
}
.chat-tab-btn.active {
  background: #2c4a7c;
  color: #fff;
  border-color: #2c4a7c;
}
.conv-list {
  flex: 1;
  overflow-y: auto;
  padding: 6px 0;
}
.conv-item {
  display: flex;
  align-items: center;
  gap: 11px;
  padding: 11px 16px;
  cursor: pointer;
  transition: background .12s;
  border-radius: 0;
  position: relative;
}
.conv-item:hover { background: var(--bg); }
.conv-item.active { background: #eef2f9; }
.conv-avatar {
  width: 40px; height: 40px;
  border-radius: 50%;
  background: var(--blue-light);
  display: flex; align-items: center; justify-content: center;
  font-size: 16px; flex-shrink: 0;
  font-weight: 700; color: #2c4a7c;
}
.conv-avatar.group {
  border-radius: 12px;
  font-size: 14px;
}
.conv-meta { flex: 1; min-width: 0; }
.conv-name {
  font-size: 13px; font-weight: 600;
  color: var(--ink); white-space: nowrap;
  overflow: hidden; text-overflow: ellipsis;
}
.conv-preview {
  font-size: 11.5px; color: var(--ink3);
  white-space: nowrap; overflow: hidden;
  text-overflow: ellipsis; margin-top: 2px;
}
.conv-time { font-size: 10.5px; color: var(--ink3); flex-shrink: 0; }
.conv-badge {
  background: #2c4a7c; color: #fff;
  border-radius: 10px; font-size: 10px;
  padding: 2px 6px; font-weight: 700;
  position: absolute; right: 14px; top: 11px;
}
/* Main chat panel */
.chat-main {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
  background: var(--bg);
}
.chat-header {
  padding: 14px 18px;
  border-bottom: 1px solid var(--border);
  background: var(--surface);
  display: flex; align-items: center; gap: 12px;
  flex-shrink: 0;
}
.chat-header-avatar {
  width: 36px; height: 36px;
  border-radius: 50%;
  background: var(--blue-light);
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; color: #2c4a7c; font-weight: 700;
  flex-shrink: 0;
}
.chat-header-avatar.group { border-radius: 10px; }
.chat-header-info { flex: 1; }
.chat-header-name { font-size: 14px; font-weight: 700; color: var(--ink); }
.chat-header-sub { font-size: 11.5px; color: var(--ink3); }
.chat-header-actions { display: flex; gap: 8px; }
.chat-hdr-btn {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  width: 32px; height: 32px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 14px; color: var(--ink2);
  transition: background .12s;
}
.chat-hdr-btn:hover { background: var(--border); }
.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 16px 18px;
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.chat-date-sep {
  text-align: center;
  font-size: 11px; color: var(--ink3);
  margin: 10px 0;
  position: relative;
}
.chat-date-sep::before, .chat-date-sep::after {
  content: '';
  position: absolute;
  top: 50%;
  width: 30%;
  height: 1px;
  background: var(--border);
}
.chat-date-sep::before { left: 0; }
.chat-date-sep::after { right: 0; }
.chat-bubble-row {
  display: flex;
  align-items: flex-end;
  gap: 8px;
  margin-bottom: 2px;
}
.chat-bubble-row.own { flex-direction: row-reverse; }
.msg-avatar {
  width: 26px; height: 26px;
  border-radius: 50%;
  background: var(--blue-light);
  display: flex; align-items: center; justify-content: center;
  font-size: 10px; font-weight: 700; color: #2c4a7c;
  flex-shrink: 0; margin-bottom: 2px;
}
.chat-bubble {
  max-width: 62%;
  padding: 9px 13px;
  border-radius: 16px;
  font-size: 13px;
  line-height: 1.5;
  position: relative;
}
.chat-bubble.other {
  background: var(--surface);
  border: 1px solid var(--border);
  border-bottom-left-radius: 4px;
  color: var(--ink);
}
.chat-bubble.own {
  background: #2c4a7c;
  color: #fff;
  border-bottom-right-radius: 4px;
}
.bubble-sender {
  font-size: 10.5px; font-weight: 700;
  color: #2c4a7c; margin-bottom: 3px;
}
.bubble-time {
  font-size: 10px;
  opacity: .55;
  margin-top: 3px;
  text-align: right;
}
/* ANN summary / calendar card */
.chat-ann-card {
  margin: 8px 0;
  background: #f0f4ff;
  border: 1px solid #c5d3ef;
  border-radius: 12px;
  padding: 12px 14px;
  display: flex;
  gap: 12px;
  align-items: flex-start;
}
.chat-ann-icon {
  width: 30px; height: 30px;
  border-radius: 8px;
  background: #2c4a7c;
  display: flex; align-items: center; justify-content: center;
  color: #fff; font-size: 14px; flex-shrink: 0;
}
.chat-ann-body { flex: 1; }
.chat-ann-label {
  font-size: 10.5px; font-weight: 700;
  color: #2c4a7c; text-transform: uppercase;
  letter-spacing: .5px; margin-bottom: 4px;
}
.chat-ann-text { font-size: 12.5px; color: var(--ink); line-height: 1.5; }
.chat-ann-actions { display: flex; gap: 8px; margin-top: 9px; flex-wrap: wrap; }
.chat-ann-btn {
  background: #2c4a7c; color: #fff;
  border: none; border-radius: 7px;
  padding: 6px 13px; font-size: 12px;
  cursor: pointer; font-family: inherit;
  font-weight: 600; display: flex; align-items: center; gap: 5px;
  transition: opacity .15s;
}
.chat-ann-btn:hover { opacity: .85; }
.chat-ann-btn.added {
  background: #1a7a4a;
  cursor: default;
}
.chat-ann-dismiss {
  background: transparent; color: var(--ink3);
  border: 1px solid var(--border); border-radius: 7px;
  padding: 6px 13px; font-size: 12px;
  cursor: pointer; font-family: inherit;
}
/* Input bar */
.chat-input-bar {
  padding: 12px 16px;
  border-top: 1px solid var(--border);
  background: var(--surface);
  display: flex; align-items: center; gap: 8px;
  flex-shrink: 0;
}
.chat-input {
  flex: 1;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 9px 16px;
  font-size: 13px;
  color: var(--ink);
  font-family: inherit;
  outline: none;
  resize: none;
}
.chat-input::placeholder { color: var(--ink3); }
.chat-send-btn {
  width: 36px; height: 36px;
  border-radius: 50%;
  background: #2c4a7c;
  color: #fff;
  border: none;
  display: flex; align-items: center; justify-content: center;
  font-size: 15px; cursor: pointer; flex-shrink: 0;
  transition: opacity .15s;
}
.chat-send-btn:hover { opacity: .85; }
/* Mobile: stack chat panels */
@media (max-width: 768px) {
  .chat-layout { grid-template-columns: 1fr; }
  .chat-sidebar { display: none; }
  .chat-layout.conv-open .chat-sidebar { display: none; }
}

/* â”€â”€ Daily Briefing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.briefing-section { display:flex; align-items:flex-start; gap:12px; padding:12px 0; border-bottom:1px solid var(--border); }
.briefing-section:last-child { border-bottom:none; padding-bottom:0; }
.briefing-icon { width:28px; height:28px; border-radius:7px; display:flex; align-items:center; justify-content:center; font-size:13px; flex-shrink:0; }
.briefing-label { font-size:10px; font-family:'DM Mono',monospace; color:var(--ink3); text-transform:uppercase; letter-spacing:.5px; margin-bottom:4px; }
.briefing-items { display:flex; flex-direction:column; gap:5px; flex:1; }
.briefing-item { font-size:12.5px; color:var(--ink); line-height:1.4; }
.briefing-item strong { font-weight:700; }
.briefing-item .btime { font-size:10.5px; font-family:'DM Mono',monospace; color:var(--ink3); margin-left:6px; }

/* â”€â”€ Stock Strip (dashboard) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stock-strip { display:flex; gap:10px; overflow-x:auto; padding:4px 0 2px; scrollbar-width:none; }
.stock-strip::-webkit-scrollbar { display:none; }
.stock-chip { flex-shrink:0; background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:9px 14px; display:flex; align-items:center; gap:10px; cursor:pointer; transition:border-color .15s; }
.stock-chip:hover { border-color:#2c4a7c; }
.stock-chip-ticker { font-size:11px; font-weight:800; font-family:'DM Mono',monospace; color:var(--ink); min-width:36px; }
.stock-chip-price { font-size:12px; font-weight:700; color:var(--ink); }
.stock-chip-chg { font-size:10.5px; font-weight:700; padding:2px 7px; border-radius:5px; }
.stock-chip-chg.up { background:var(--green-light); color:var(--green); }
.stock-chip-chg.dn { background:var(--red-light); color:var(--red); }
.stock-sparkline { width:52px; height:24px; }

/* â”€â”€ Shopping List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.shop-item { display:flex; align-items:center; gap:10px; padding:8px 0; border-bottom:1px solid var(--border); }
.shop-item:last-child { border-bottom:none; }
.shop-check { width:18px; height:18px; border-radius:4px; border:2px solid var(--border); flex-shrink:0; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:11px; transition:all .15s; }
.shop-check.checked { background:#2c4a7c; border-color:#2c4a7c; color:#fff; }
.shop-name { flex:1; font-size:12.5px; color:var(--ink); font-weight:600; }
.shop-name.done { text-decoration:line-through; color:var(--ink3); }
.shop-qty { font-size:11px; font-family:'DM Mono',monospace; color:var(--ink2); }
.shop-source { font-size:9.5px; font-weight:700; padding:2px 6px; border-radius:4px; }
.shop-source.auto { background:var(--blue-light); color:#2c4a7c; }
.shop-source.added { background:var(--amber-light); color:var(--amber); }
.shop-add-row { display:flex; gap:8px; margin-top:12px; }
.shop-add-input { flex:1; background:var(--bg); border:1px solid var(--border); border-radius:8px; padding:8px 12px; font-size:12px; color:var(--ink); font-family:inherit; outline:none; }

/* â”€â”€ Habit Tracker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.habit-stats-row { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-bottom:16px; }
.habit-stat { background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:12px 14px; text-align:center; }
.habit-stat-val { font-size:22px; font-weight:800; color:var(--ink); line-height:1; }
.habit-stat-lbl { font-size:10px; font-family:'DM Mono',monospace; color:var(--ink3); margin-top:3px; text-transform:uppercase; }
.habit-chart-wrap { position:relative; margin-bottom:16px; }
.gym-week-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-bottom:16px; }
.gym-day { text-align:center; }
.gym-day-label { font-size:10px; font-family:'DM Mono',monospace; color:var(--ink3); margin-bottom:5px; }
.gym-day-dot { width:34px; height:34px; border-radius:50%; border:2px solid var(--border); display:flex; align-items:center; justify-content:center; margin:0 auto; cursor:pointer; font-size:14px; transition:all .15s; }
.gym-day-dot.done { background:#2c4a7c; border-color:#2c4a7c; color:#fff; }
.gym-day-dot.rest { background:var(--bg); color:var(--ink3); }
.screen-bar-row { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
.screen-bar-label { font-size:12px; font-weight:600; color:var(--ink); width:110px; flex-shrink:0; }
.screen-bar-track { flex:1; height:8px; background:var(--bg); border-radius:4px; overflow:hidden; }
.screen-bar-fill { height:100%; border-radius:4px; }
.screen-bar-time { font-size:11px; font-family:'DM Mono',monospace; color:var(--ink2); width:52px; text-align:right; flex-shrink:0; }

/* â”€â”€ Stocks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#view-stocks { padding:0 !important; display:none; height:100%; }
#view-stocks.active { display:grid; grid-template-columns:280px minmax(0,1fr); }
.stock-sidebar { border-right:1px solid var(--border); background:var(--surface); display:flex; flex-direction:column; overflow:hidden; }
.stock-sidebar-hdr { padding:14px 16px; border-bottom:1px solid var(--border); font-size:11px; font-family:'DM Mono',monospace; color:var(--ink3); text-transform:uppercase; letter-spacing:.5px; }
.stock-list { flex:1; overflow-y:auto; }
.stock-row { display:flex; align-items:center; gap:10px; padding:12px 16px; cursor:pointer; border-bottom:1px solid var(--border); transition:background .12s; }
.stock-row:hover { background:var(--bg); }
.stock-row.active { background:#eef2f9; }
.stock-ticker-badge { background:#2c4a7c; color:#fff; border-radius:6px; padding:3px 8px; font-size:10px; font-weight:800; font-family:'DM Mono',monospace; flex-shrink:0; }
.stock-row-name { font-size:12px; font-weight:600; color:var(--ink); flex:1; }
.stock-row-price { font-size:12px; font-family:'DM Mono',monospace; color:var(--ink); font-weight:700; }
.stock-row-chg { font-size:10px; font-weight:700; padding:2px 6px; border-radius:4px; margin-left:4px; }
.stock-detail { display:flex; flex-direction:column; overflow-y:auto; background:var(--bg); padding:20px; gap:16px; }
.stock-hero { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:18px 20px; }
.stock-hero-name { font-size:18px; font-weight:700; color:var(--ink); }
.stock-hero-meta { font-size:11px; font-family:'DM Mono',monospace; color:var(--ink3); margin-top:2px; }
.stock-hero-price { font-size:32px; font-weight:800; color:var(--ink); margin:10px 0 4px; line-height:1; }
.stock-hero-chg { font-size:14px; font-weight:700; padding:3px 10px; border-radius:6px; display:inline-block; }
.stock-sparkline-lg { width:100%; height:80px; display:block; margin-top:12px; }
.stock-stats-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; }
.stock-stat-box { background:var(--surface); border:1px solid var(--border); border-radius:9px; padding:10px 12px; }
.stock-stat-lbl { font-size:9.5px; font-family:'DM Mono',monospace; color:var(--ink3); text-transform:uppercase; margin-bottom:3px; }
.stock-stat-val { font-size:13px; font-weight:700; color:var(--ink); }
.stock-news { display:flex; flex-direction:column; gap:10px; }
.stock-news-item { background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:12px 14px; }
.stock-news-source { font-size:9.5px; font-family:'DM Mono',monospace; color:var(--ink3); text-transform:uppercase; margin-bottom:4px; }
.stock-news-headline { font-size:13px; font-weight:600; color:var(--ink); line-height:1.4; }
.stock-news-time { font-size:10.5px; color:var(--ink3); margin-top:4px; }
@media (max-width:768px) { #view-stocks.active { grid-template-columns:1fr; } .stock-sidebar { display:none; } }

/* â”€â”€ Invoice Generator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.invoice-layout { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
@media (max-width:900px) { .invoice-layout { grid-template-columns:1fr; } }
.invoice-form-section label { display:block; font-size:11px; font-family:'DM Mono',monospace; color:var(--ink3); margin-bottom:4px; text-transform:uppercase; letter-spacing:.4px; }
.invoice-form-section .inv-input { width:100%; background:var(--bg); border:1px solid var(--border); border-radius:7px; padding:8px 11px; font-size:12.5px; color:var(--ink); font-family:inherit; outline:none; box-sizing:border-box; }
.inv-line-table { width:100%; border-collapse:collapse; margin:8px 0; }
.inv-line-table th { font-size:10px; font-family:'DM Mono',monospace; color:var(--ink3); text-align:left; padding:6px 8px; border-bottom:1px solid var(--border); text-transform:uppercase; }
.inv-line-table td { padding:6px 4px; }
.inv-line-table td input { width:100%; background:var(--bg); border:1px solid var(--border); border-radius:5px; padding:5px 7px; font-size:12px; color:var(--ink); font-family:inherit; outline:none; }
.inv-line-table td:last-child { font-size:12px; font-family:'DM Mono',monospace; color:var(--ink); padding-left:8px; white-space:nowrap; }
.inv-preview { background:#fff; border:1px solid var(--border); border-radius:12px; padding:24px; font-family:'Raleway',sans-serif; }
.inv-preview-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:20px; padding-bottom:16px; border-bottom:2px solid #2c4a7c; }
.inv-preview-title { font-size:24px; font-weight:800; color:#2c4a7c; }
.inv-preview-from { font-size:11px; color:#666; line-height:1.6; }
.inv-preview-meta { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:16px; font-size:12px; color:#333; }
.inv-preview-to-label { font-size:10px; font-family:'DM Mono',monospace; color:#888; text-transform:uppercase; margin-bottom:3px; }
.inv-preview-table { width:100%; border-collapse:collapse; font-size:12px; }
.inv-preview-table th { background:#f5f5f5; padding:8px 10px; text-align:left; font-size:10px; text-transform:uppercase; color:#666; }
.inv-preview-table td { padding:8px 10px; border-bottom:1px solid #eee; color:#333; }
.inv-preview-totals { margin-top:12px; text-align:right; font-size:12px; color:#333; }
.inv-preview-total-line { display:flex; justify-content:flex-end; gap:24px; padding:4px 0; }
.inv-preview-grand { font-size:16px; font-weight:800; color:#2c4a7c; border-top:2px solid #2c4a7c; padding-top:8px; margin-top:4px; }

/* â”€â”€ Cash Flow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cashflow-chart-wrap { overflow-x:auto; }
.cf-bar-chart { display:flex; align-items:flex-end; gap:16px; height:140px; padding:0 4px; }
.cf-month-group { display:flex; gap:4px; align-items:flex-end; flex:1; min-width:52px; }
.cf-bar { border-radius:4px 4px 0 0; width:18px; transition:opacity .15s; cursor:default; }
.cf-bar.income { background:#2c4a7c; }
.cf-bar.expense { background:#ef4444; }
.cf-month-label { text-align:center; font-size:10px; font-family:'DM Mono',monospace; color:var(--ink3); margin-top:5px; }
.cf-table { width:100%; border-collapse:collapse; font-size:12px; }
.cf-table th { font-size:10px; font-family:'DM Mono',monospace; color:var(--ink3); text-align:left; padding:7px 10px; border-bottom:1px solid var(--border); text-transform:uppercase; background:var(--surface2); }
.cf-table td { padding:8px 10px; border-bottom:1px solid var(--border); color:var(--ink); }
.cf-table tr:last-child td { border-bottom:none; font-weight:700; }
.cf-table td.income-col { color:var(--green); font-family:'DM Mono',monospace; }
.cf-table td.expense-col { color:var(--red); font-family:'DM Mono',monospace; }
.cf-table td.net-col { font-family:'DM Mono',monospace; font-weight:700; }
.cf-ann-insight { background:#f0f4ff; border:1px solid #c5d3ef; border-radius:10px; padding:12px 14px; display:flex; gap:10px; align-items:flex-start; }

/* â”€â”€ Payslips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.payslip-layout { display:grid; grid-template-columns:300px minmax(0,1fr); gap:16px; }
@media (max-width:768px) { .payslip-layout { grid-template-columns:1fr; } }
.payslip-item { display:flex; align-items:center; gap:10px; padding:11px 14px; cursor:pointer; border-bottom:1px solid var(--border); border-radius:0; transition:background .12s; }
.payslip-item:hover { background:var(--bg); }
.payslip-item.active { background:#eef2f9; }
.payslip-logo { width:36px; height:36px; border-radius:9px; background:#2c4a7c; color:#fff; display:flex; align-items:center; justify-content:center; font-size:14px; font-weight:800; flex-shrink:0; }
.payslip-meta { flex:1; }
.payslip-employer { font-size:12.5px; font-weight:700; color:var(--ink); }
.payslip-date { font-size:10.5px; font-family:'DM Mono',monospace; color:var(--ink3); }
.payslip-gross { font-size:12px; font-family:'DM Mono',monospace; color:var(--ink); font-weight:700; }
.payslip-badge { font-size:9px; font-weight:700; padding:2px 6px; border-radius:4px; }
.payslip-badge.synced { background:var(--green-light); color:var(--green); }
.payslip-badge.uploaded { background:var(--amber-light); color:var(--amber); }
.payslip-detail-row { display:flex; justify-content:space-between; align-items:center; padding:9px 0; border-bottom:1px solid var(--border); font-size:13px; }
.payslip-detail-row:last-child { border-bottom:none; }
.payslip-detail-row.total { font-weight:800; font-size:14px; color:#2c4a7c; }
.payslip-detail-lbl { color:var(--ink2); }
.payslip-detail-val { font-family:'DM Mono',monospace; color:var(--ink); font-weight:600; }
.payslip-detail-val.deduction { color:var(--red); }
</style>
</head>
<body>

<div class="titlebar">
  <button class="mobile-menu-btn" style="display:none;" onclick="toggleDrawer()" id="mobile-menu-btn"><i class="bi bi-list"></i></button>
  <div class="titlebar-dots">
    <div class="dot dot-red"></div>
    <div class="dot dot-yellow"></div>
    <div class="dot dot-green"></div>
  </div>
  <div class="titlebar-title">ANN â€” Personal Assistant</div>
  <div class="titlebar-time" id="clock">--:--</div>
</div>

<div class="app">
  <div class="sidebar">
    <div class="sidebar-brand">
      <div class="brand-name">ANN</div>
      <div class="brand-sub">Personal Assistant</div>
    </div>
    <div class="sidebar-nav">
      <div class="nav-section-label">Overview</div>
      <div class="nav-item active" onclick="navigate('dashboard', this)"><span class="nav-icon"><i class="bi bi-grid-fill"></i></span> Dashboard</div>
      <div class="nav-item" onclick="navigate('calendar', this)"><span class="nav-icon"><i class="bi bi-calendar3"></i></span> Calendar<span class="nav-badge">3</span></div>
      <div class="nav-item" onclick="navigate('tasks', this)"><span class="nav-icon"><i class="bi bi-check2-square"></i></span> Tasks<span class="nav-badge">5</span></div>
      <div class="nav-item" onclick="navigate('meetings', this)"><span class="nav-icon"><i class="bi bi-camera-video-fill"></i></span> Meetings<span class="nav-badge">2</span></div>
      <div class="nav-section-label">Communications</div>
      <div class="nav-item" onclick="navigate('emails', this)"><span class="nav-icon"><i class="bi bi-envelope-fill"></i></span> Emails<span class="nav-badge">4</span></div>
      <div class="nav-item" onclick="navigate('chat', this)"><span class="nav-icon"><i class="bi bi-chat-dots-fill"></i></span> Chat<span class="nav-badge">3</span></div>
      <div class="nav-item" onclick="navigate('calls', this)"><span class="nav-icon"><i class="bi bi-telephone-fill"></i></span> Calls</div>
      <div class="nav-item" onclick="navigate('wallet', this)"><span class="nav-icon"><i class="bi bi-wallet2"></i></span> Wallet</div>
      <div class="nav-section-label">Finance</div>
      <div class="nav-item" onclick="navigate('budget', this)"><span class="nav-icon"><i class="bi bi-pie-chart-fill"></i></span> Budget</div>
      <div class="nav-item" onclick="navigate('bills', this)"><span class="nav-icon"><i class="bi bi-receipt"></i></span> Bills<span class="nav-badge" style="background:var(--red)">!</span></div>
      <div class="nav-item" onclick="navigate('categorisation', this)"><span class="nav-icon"><i class="bi bi-tags-fill"></i></span> Categorisation</div>
      <div class="nav-item" onclick="navigate('vat', this)"><span class="nav-icon"><i class="bi bi-file-earmark-spreadsheet-fill"></i></span> VAT Return</div>
      <div class="nav-item" onclick="navigate('tax', this)"><span class="nav-icon"><i class="bi bi-calculator-fill"></i></span> Tax Return</div>
      <div class="nav-item" onclick="navigate('stocks', this)"><span class="nav-icon"><i class="bi bi-graph-up"></i></span> Stocks</div>
      <div class="nav-item" onclick="navigate('invoice', this)"><span class="nav-icon"><i class="bi bi-file-earmark-text-fill"></i></span> Invoice</div>
      <div class="nav-item" onclick="navigate('cashflow', this)"><span class="nav-icon"><i class="bi bi-cash-stack"></i></span> Cash Flow</div>
      <div class="nav-item" onclick="navigate('payslips', this)"><span class="nav-icon"><i class="bi bi-file-earmark-person-fill"></i></span> Payslips</div>
      <div class="nav-section-label">Lifestyle</div>
      <div class="nav-item" onclick="navigate('profile', this)"><span class="nav-icon"><i class="bi bi-person-fill"></i></span> Profile</div>
      <div class="nav-item" onclick="navigate('habits', this)"><span class="nav-icon"><i class="bi bi-activity"></i></span> Habits</div>
      <div class="nav-item" onclick="navigate('inventory', this)"><span class="nav-icon"><i class="bi bi-box-seam-fill"></i></span> Inventory</div>
      <div class="nav-item" onclick="navigate('meals', this)"><span class="nav-icon"><i class="bi bi-cup-hot-fill"></i></span> Meals</div>
      <div class="nav-item" onclick="navigate('trips', this)"><span class="nav-icon"><i class="bi bi-globe2"></i></span> Trips</div>
      <div class="nav-item" onclick="navigate('parcels', this)"><span class="nav-icon"><i class="bi bi-truck"></i></span> Parcels<span class="nav-badge">2</span></div>
    </div>
    <div class="sidebar-profile">
      <div class="profile-avatar">O</div>
      <div>
        <div class="profile-name">Overwatch</div>
        <div class="profile-role">Personal Â· Work</div>
      </div>
    </div>
  </div>

  <div class="main">
    <div class="topbar">
      <div>
        <div class="topbar-title" id="topbar-title">Dashboard</div>
        <div class="topbar-sub" id="topbar-sub">Saturday, 28 February 2026</div>
      </div>
      <div class="topbar-actions">
        <button class="btn btn-ghost" onclick="showToast('ðŸ”„ Syncing all accounts...')">Sync</button>
        <button class="btn btn-primary" id="action-btn" onclick="handleAction()">+ Add Task</button>
        <div class="notif-bell" onclick="toggleNotif()"><i class="bi bi-bell-fill"></i><div class="notif-dot"></div></div>
      </div>
    </div>

    <div class="notif-panel" id="notif-panel">
      <div class="notif-header">
        <div class="notif-title">Notifications</div>
        <div class="notif-clear" onclick="clearNotifs()">Clear all</div>
      </div>
      <div class="notif-list">
        <div class="notif-item"><div class="notif-ico"><i class="bi bi-receipt"></i></div><div class="notif-body"><div class="notif-msg">Netflix price increased from Â£10.99 to Â£13.99/mo</div><div class="notif-time">2 hours ago</div></div></div>
        <div class="notif-item"><div class="notif-ico"><i class="bi bi-truck"></i></div><div class="notif-body"><div class="notif-msg">Your ASOS order is out for delivery today</div><div class="notif-time">9:14 AM</div></div></div>
        <div class="notif-item"><div class="notif-ico"><i class="bi bi-envelope-fill"></i></div><div class="notif-body"><div class="notif-msg">Email from HMRC â€” Tax return reminder added to tasks</div><div class="notif-time">Yesterday</div></div></div>
        <div class="notif-item"><div class="notif-ico"><i class="bi bi-exclamation-circle-fill"></i></div><div class="notif-body"><div class="notif-msg">Low stock: Milk (1 unit remaining)</div><div class="notif-time">Yesterday</div></div></div>
        <div class="notif-item"><div class="notif-ico"><i class="bi bi-telephone-fill"></i></div><div class="notif-body"><div class="notif-msg">Voicemail from Dr. Smith summarised and added to tasks</div><div class="notif-time">2 days ago</div></div></div>
      </div>
    </div>

    <!-- DASHBOARD -->
    <div class="content active" id="view-dashboard">

      <!-- ASK ANN -->
      <div class="ann-ask-box" style="margin-bottom:16px;" id="ann-ask-box">
        <div class="ann-ask-header">
          <div class="ann-ask-icon"><i class="bi bi-stars"></i></div>
          <div>
            <div class="card-title">Ask ANN</div>
            <div class="card-sub">Your AI across all your data</div>
          </div>
        </div>
        <div class="ann-ask-body">
          <div class="ann-ask-suggestions" id="ann-suggestions">
            <div class="ann-suggestion" onclick="annAsk(this)">How much have I spent this month?</div>
            <div class="ann-suggestion" onclick="annAsk(this)">What's my next meeting?</div>
            <div class="ann-suggestion" onclick="annAsk(this)">What meals can I make tonight?</div>
            <div class="ann-suggestion" onclick="annAsk(this)">Summarise my emails today</div>
          </div>
          <div class="ann-ask-input-row">
            <input class="ann-ask-input" id="ann-ask-input" placeholder="Ask anything about your schedule, finances, inventory..." onkeydown="if(event.key==='Enter') annAskInput()">
            <button class="ann-ask-send" onclick="annAskInput()"><i class="bi bi-arrow-up"></i></button>
          </div>
          <div class="ann-response" id="ann-response" style="display:none;"></div>
        </div>
      </div>

      <div class="stat-row">
        <div class="stat-card"><div class="stat-value">5</div><div class="stat-label">Open Tasks</div><div class="stat-change change-down">â†‘ 2 from emails</div></div>
        <div class="stat-card"><div class="stat-value">Â£1,842</div><div class="stat-label">Spent This Month</div><div class="stat-change change-up">â†“ 8% vs last month</div></div>
        <div class="stat-card"><div class="stat-value">2</div><div class="stat-label">Parcels En Route</div><div class="stat-change" style="color:var(--amber)">1 out for delivery</div></div>
        <div class="stat-card"><div class="stat-value">3</div><div class="stat-label">Events This Week</div><div class="stat-change" style="color:var(--ink3)">Next: Mon 9AM</div></div>
      </div>
      <!-- Stock Summary Strip -->
      <div class="card" style="margin-bottom:16px;">
        <div class="card-header" style="border-bottom:none; padding-bottom:10px;">
          <div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-graph-up"></i></div>
          <div><div class="card-title">Markets</div><div class="card-sub">Last close Â· Tap to view details</div></div>
        </div>
        <div style="padding:0 18px 14px;">
          <div class="stock-strip">
            <div class="stock-chip" onclick="navigate('stocks', document.querySelector('[onclick*=navigate_stocks]'))">
              <span class="stock-chip-ticker">AAPL</span>
              <span class="stock-chip-price">$182.40</span>
              <span class="stock-chip-chg up">â†‘ 1.2%</span>
              <svg class="stock-sparkline" viewBox="0 0 52 24" fill="none"><polyline points="0,18 7,16 13,17 19,13 26,10 32,8 38,11 44,7 52,6" stroke="#166534" stroke-width="1.5" fill="none"/></svg>
            </div>
            <div class="stock-chip" onclick="navigate('stocks', document.querySelector('[onclick*=navigate_stocks]'))">
              <span class="stock-chip-ticker">NVDA</span>
              <span class="stock-chip-price">$875.10</span>
              <span class="stock-chip-chg up">â†‘ 3.4%</span>
              <svg class="stock-sparkline" viewBox="0 0 52 24" fill="none"><polyline points="0,20 7,18 13,15 19,12 26,9 32,7 38,5 44,4 52,2" stroke="#166534" stroke-width="1.5" fill="none"/></svg>
            </div>
            <div class="stock-chip" onclick="navigate('stocks', document.querySelector('[onclick*=navigate_stocks]'))">
              <span class="stock-chip-ticker">TSLA</span>
              <span class="stock-chip-price">$193.57</span>
              <span class="stock-chip-chg dn">â†“ 0.8%</span>
              <svg class="stock-sparkline" viewBox="0 0 52 24" fill="none"><polyline points="0,6 7,7 13,8 19,10 26,11 32,14 38,13 44,16 52,17" stroke="#991b1b" stroke-width="1.5" fill="none"/></svg>
            </div>
            <div class="stock-chip" onclick="navigate('stocks', document.querySelector('[onclick*=navigate_stocks]'))">
              <span class="stock-chip-ticker">META</span>
              <span class="stock-chip-price">$493.00</span>
              <span class="stock-chip-chg up">â†‘ 0.5%</span>
              <svg class="stock-sparkline" viewBox="0 0 52 24" fill="none"><polyline points="0,14 7,13 13,12 19,13 26,11 32,10 38,12 44,10 52,9" stroke="#166534" stroke-width="1.5" fill="none"/></svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Today's Briefing -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:#2c4a7c;"><i class="bi bi-stars" style="color:#fff;"></i></div>
          <div>
            <div class="card-title">Today's Briefing</div>
            <div class="card-sub">Sunday, 1 March 2026 Â· ANN generated</div>
          </div>
        </div>
        <div class="card-body">
          <!-- Schedule -->
          <div class="briefing-section">
            <div class="briefing-icon" style="background:var(--blue-light);"><i class="bi bi-calendar3" style="color:#2c4a7c;font-size:12px;"></i></div>
            <div class="briefing-items">
              <div class="briefing-label">Today's schedule</div>
              <div class="briefing-item"><strong>Client call with Sarah Mitchell</strong><span class="btime">09:00 Â· Zoom</span></div>
              <div class="briefing-item"><strong>Team standup</strong><span class="btime">10:30 Â· Teams</span></div>
              <div class="briefing-item"><strong>AAT revision session</strong><span class="btime">14:00 Â· Home</span></div>
            </div>
          </div>
          <!-- Tasks -->
          <div class="briefing-section">
            <div class="briefing-icon" style="background:var(--green-light);"><i class="bi bi-check2-square" style="color:var(--green);font-size:12px;"></i></div>
            <div class="briefing-items">
              <div class="briefing-label">Priority tasks</div>
              <div class="briefing-item"><strong>Submit self-assessment tax return</strong> â€” deadline 31 Jan, overdue</div>
              <div class="briefing-item"><strong>Renew car insurance</strong> â€” expires 15 March</div>
              <div class="briefing-item"><strong>Book dentist appointment</strong> â€” voicemail follow-up pending</div>
            </div>
          </div>
          <!-- Budget -->
          <div class="briefing-section">
            <div class="briefing-icon" style="background:var(--amber-light);"><i class="bi bi-pie-chart-fill" style="color:var(--amber);font-size:12px;"></i></div>
            <div class="briefing-items">
              <div class="briefing-label">Budget</div>
              <div class="briefing-item">Spent <strong>Â£1,842</strong> of <strong>Â£2,500</strong> this month â€” 74% used, 7 days remaining</div>
              <div class="briefing-item">Netflix price increase to <strong>Â£13.99</strong> detected from 15 Mar</div>
            </div>
          </div>
          <!-- Emails -->
          <div class="briefing-section">
            <div class="briefing-icon" style="background:var(--blue-light);"><i class="bi bi-envelope-fill" style="color:#2c4a7c;font-size:12px;"></i></div>
            <div class="briefing-items">
              <div class="briefing-label">Email highlights</div>
              <div class="briefing-item"><strong>HMRC</strong> â€” Self Assessment action required. File before 31 Jan to avoid penalty.</div>
              <div class="briefing-item"><strong>ASOS</strong> â€” Order #28291 out for delivery today via Evri</div>
            </div>
          </div>
          <!-- Inventory / Shopping -->
          <div class="briefing-section">
            <div class="briefing-icon" style="background:var(--red-light);"><i class="bi bi-cart-fill" style="color:var(--red);font-size:12px;"></i></div>
            <div class="briefing-items">
              <div class="briefing-label">Shopping needed</div>
              <div class="briefing-item"><strong>Milk</strong> is critically low (12%). <strong>Bread</strong> and <strong>Garlic</strong> running low.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MEETINGS VIEW -->
    <div class="content" id="view-meetings">
      <div>

        <!-- Left: meeting list -->
        <div style="display:flex;flex-direction:column;gap:16px;">
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-camera-video-fill"></i></div>
              <div><div class="card-title">Today's Meetings</div><div class="card-sub">Mon 2 Mar 2026 Â· Synced from Calendar</div></div>
            </div>
            <div class="card-body" style="padding:8px 14px;">

              <div class="meeting-item active-meeting" onclick="selectMeeting('standup')" id="mitem-standup">
                <div class="meeting-time-col">
                  <div class="meeting-time">09:00</div>
                  <div class="meeting-duration">30 min</div>
                </div>
                <div class="meeting-bar" style="background:#2c4a7c;"></div>
                <div class="meeting-info">
                  <div class="meeting-name">Daily Standup</div>
                  <div class="meeting-who"><i class="bi bi-camera-video-fill"></i> Teams Â· 4 attendees</div>
                </div>
                <div class="meeting-status-dot live"></div>
              </div>

              <div class="meeting-item" onclick="selectMeeting('quarterly')" id="mitem-quarterly">
                <div class="meeting-time-col">
                  <div class="meeting-time">11:00</div>
                  <div class="meeting-duration">60 min</div>
                </div>
                <div class="meeting-bar" style="background:#7c3aed;"></div>
                <div class="meeting-info">
                  <div class="meeting-name">Q1 Management Review</div>
                  <div class="meeting-who"><i class="bi bi-camera-video-fill"></i> Teams Â· 8 attendees</div>
                </div>
                <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--amber);">in 2h</div>
              </div>

              <div class="meeting-item" onclick="selectMeeting('aat')" id="mitem-aat">
                <div class="meeting-time-col">
                  <div class="meeting-time">14:00</div>
                  <div class="meeting-duration">45 min</div>
                </div>
                <div class="meeting-bar" style="background:#10b981;"></div>
                <div class="meeting-info">
                  <div class="meeting-name">AAT Revision Session</div>
                  <div class="meeting-who"><i class="bi bi-camera-video-fill"></i> Teams Â· 3 attendees</div>
                </div>
                <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);">in 5h</div>
              </div>

            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background:var(--surface2);"><i class="bi bi-calendar-event-fill"></i></div>
              <div><div class="card-title">This Week</div><div class="card-sub">Upcoming meetings</div></div>
            </div>
            <div class="card-body" style="padding:8px 14px;">
              <div class="meeting-item" style="padding:8px 0;">
                <div class="meeting-time-col"><div class="meeting-time" style="font-size:9px;color:var(--ink3);">TUE 10:00</div></div>
                <div class="meeting-bar" style="background:#f59e0b;"></div>
                <div class="meeting-info"><div class="meeting-name" style="font-size:11px;">1:1 with Line Manager</div><div class="meeting-who">30 min Â· Teams</div></div>
              </div>
              <div class="meeting-item" style="padding:8px 0;">
                <div class="meeting-time-col"><div class="meeting-time" style="font-size:9px;color:var(--ink3);">THU 15:30</div></div>
                <div class="meeting-bar" style="background:#ef4444;"></div>
                <div class="meeting-info"><div class="meeting-name" style="font-size:11px;">Client Call â€” Accounts Review</div><div class="meeting-who">45 min Â· Teams</div></div>
              </div>
              <div class="meeting-item" style="padding:8px 0;border-bottom:none;">
                <div class="meeting-time-col"><div class="meeting-time" style="font-size:9px;color:var(--ink3);">FRI 09:00</div></div>
                <div class="meeting-bar" style="background:#2c4a7c;"></div>
                <div class="meeting-info"><div class="meeting-name" style="font-size:11px;">Daily Standup</div><div class="meeting-who">30 min Â· Teams</div></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: briefing + join panel -->
        <div id="meeting-detail-panel" style="display:flex;flex-direction:column;gap:16px;">

          <!-- Briefing card -->
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background:#dbeafe;" id="meet-icon"><i class="bi bi-clipboard-fill"></i></div>
              <div>
                <div class="card-title" id="meet-title">Daily Standup</div>
                <div class="card-sub" id="meet-sub">09:00 â€“ 09:30 Â· Mon 2 Mar Â· 4 attendees</div>
              </div>
              <span class="status-pill status-transit" style="margin-left:auto;" id="meet-badge">Live Now</span>
            </div>
            <div class="card-body" id="meet-briefing-body">
              <!-- Briefing injected by JS -->
            </div>
          </div>

          <!-- Join card -->
          <div class="card" id="meet-join-card">
            <div class="card-header">
              <div class="card-icon" style="background:var(--green-light);"><i class="bi bi-camera-video-fill"></i></div>
              <div><div class="card-title">Join Meeting</div><div class="card-sub" id="meet-join-sub">Ready to join Â· Camera & mic available</div></div>
            </div>
            <div class="card-body">
              <div style="display:flex;gap:10px;margin-bottom:12px;">
                <button class="btn btn-ghost meet-toggle active" id="toggle-cam" onclick="toggleMeetCtrl(this,'cam')"><i class="bi bi-camera-video-fill"></i> Cam On</button>
                <button class="btn btn-ghost meet-toggle active" id="toggle-mic" onclick="toggleMeetCtrl(this,'mic')"><i class="bi bi-mic-fill"></i> Mic On</button>
                <button class="btn btn-ghost meet-toggle" id="toggle-blur" onclick="toggleMeetCtrl(this,'blur')"><i class="bi bi-eye-slash"></i> Blur Off</button>
              </div>
              <button class="btn btn-primary" style="width:100%;padding:12px;font-size:14px;font-weight:800;letter-spacing:0.5px;" id="join-btn" onclick="joinMeeting()"><i class="bi bi-arrow-up-right-circle-fill"></i> Join Meeting</button>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- VIDEO CALL MODAL -->
    <div class="modal-overlay" id="call-modal" style="z-index:500;" onclick="">
      <div id="call-window" style="width:min(860px,100vw);height:min(560px,100vh);background:#111827;border-radius:18px;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 60px 120px rgba(0,0,0,0.6);position:relative;">

        <!-- Call header bar -->
        <div style="display:flex;align-items:center;padding:12px 18px;background:#0f172a;gap:12px;flex-shrink:0;">
          <div style="width:8px;height:8px;border-radius:50%;background:#ef4444;animation:pulse 1.5s infinite;" class="meeting-status-dot live"></div>
          <div style="font-family:'DM Mono',monospace;font-size:11px;color:rgba(255,255,255,0.6);" id="call-title-bar">Daily Standup Â· 00:00</div>
          <div style="margin-left:auto;display:flex;gap:8px;">
            <div style="font-size:10px;font-family:'DM Mono',monospace;background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.5);padding:3px 10px;border-radius:5px;">4 participants</div>
          </div>
        </div>

        <!-- Video grid -->
        <div style="flex:1;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;gap:3px;background:#0a0f1a;padding:3px;" id="video-grid">

          <div class="video-tile" style="grid-column:1;grid-row:1 / span 2;position:relative;">
            <div class="video-person-bg" style="background:linear-gradient(135deg,#1e3a5f,#2c4a7c);">
              <div class="video-avatar-big">O</div>
              <div class="video-name-tag">You (Overwatch) <span style="background:#ef4444;font-size:8px;padding:1px 5px;border-radius:3px;margin-left:4px;">SPEAKING</span></div>
              <div id="your-cam-icon" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:24px;opacity:0.4;" style="display:none;"><i class="bi bi-camera-video-off-fill" style="font-size:24px;opacity:0.4;"></i></div>
            </div>
          </div>

          <div class="video-tile" style="position:relative;">
            <div class="video-person-bg" style="background:linear-gradient(135deg,#3b1f6e,#5b21b6);">
              <div class="video-avatar-big">S</div>
              <div class="video-name-tag">Sarah Mitchell</div>
            </div>
          </div>

          <div class="video-tile" style="position:relative;">
            <div class="video-person-bg" style="background:linear-gradient(135deg,#064e3b,#065f46);">
              <div class="video-avatar-big">J</div>
              <div class="video-name-tag">James K. ðŸŽ™</div>
            </div>
          </div>

          <div class="video-tile" style="position:relative;">
            <div class="video-person-bg" style="background:linear-gradient(135deg,#7c2d12,#9a3412);">
              <div class="video-avatar-big">R</div>
              <div class="video-name-tag">Rachel T.</div>
            </div>
          </div>

        </div>

        <!-- Chat sidebar (hidden by default) -->
        <div id="call-chat" style="display:none;position:absolute;top:48px;right:0;bottom:64px;width:240px;background:rgba(15,23,42,0.97);border-left:1px solid rgba(255,255,255,0.08);flex-direction:column;">
          <div style="padding:10px 14px;border-bottom:1px solid rgba(255,255,255,0.08);font-size:11px;font-family:'DM Mono',monospace;color:rgba(255,255,255,0.4);">MEETING CHAT</div>
          <div id="chat-messages" style="flex:1;overflow-y:auto;padding:10px 14px;display:flex;flex-direction:column;gap:8px;max-height:300px;">
            <div class="chat-msg"><span class="chat-who">Sarah M.</span><span class="chat-text">Morning everyone ðŸ‘‹</span></div>
            <div class="chat-msg"><span class="chat-who">James K.</span><span class="chat-text">Ready when you are</span></div>
            <div class="chat-msg"><span class="chat-who">Rachel T.</span><span class="chat-text">Just joining from mobile</span></div>
          </div>
          <div style="padding:8px 10px;border-top:1px solid rgba(255,255,255,0.08);display:flex;gap:6px;">
            <input id="chat-input" placeholder="Message..." style="flex:1;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:6px;color:white;font-size:11px;padding:6px 8px;outline:none;font-family:'Raleway',sans-serif;" onkeydown="if(event.key==='Enter')sendChatMsg()">
            <button onclick="sendChatMsg()" style="background:#2c4a7c;border:none;border-radius:6px;color:white;padding:0 10px;cursor:pointer;font-size:13px;">â†‘</button>
          </div>
        </div>

        <!-- Controls bar -->
        <div style="display:flex;align-items:center;justify-content:center;gap:12px;padding:14px 20px;background:#0f172a;flex-shrink:0;" id="call-controls">
          <button class="call-ctrl-btn active" id="ctrl-mic" onclick="toggleCallCtrl(this,'mic')"><i class="bi bi-mic-fill"></i></button>
          <button class="call-ctrl-btn active" id="ctrl-cam" onclick="toggleCallCtrl(this,'cam')"><i class="bi bi-camera-video-fill"></i></button>
          <button class="call-ctrl-btn" id="ctrl-screen" onclick="showToast('ðŸ–¥ Screen share not available in demo')"><i class="bi bi-display"></i></button>
          <button class="call-ctrl-btn" id="ctrl-chat" onclick="toggleChat()"><i class="bi bi-chat-fill"></i></button>
          <button class="call-ctrl-btn" id="ctrl-react" onclick="sendReaction()"><i class="bi bi-hand-index-thumb-fill"></i></button>
          <div style="width:1px;height:32px;background:rgba(255,255,255,0.1);margin:0 4px;"></div>
          <button onclick="leaveCall()" style="background:#ef4444;border:none;border-radius:10px;color:white;padding:10px 22px;font-size:13px;font-weight:700;cursor:pointer;font-family:'Raleway',sans-serif;">Leave</button>
        </div>

      </div>
    </div>

    <!-- TASKS VIEW -->
    <div class="content" id="view-tasks">
      <div class="add-task-row">
        <input class="task-input" id="new-task-input" placeholder="Add a new task..." onkeydown="if(event.key==='Enter') addNewTask()"/>
        <button class="btn btn-primary" onclick="addNewTask()">Add Task</button>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-icon" style="background:var(--green-light);"><i class="bi bi-check2-square"></i></div><div><div class="card-title">All Tasks</div><div class="card-sub">From emails, calls, and manual entries</div></div></div>
        <div class="card-body" id="all-tasks-list">
          <div class="task-item" onclick="toggleTask(this)"><div class="task-check"></div><div class="task-text">Submit self-assessment tax return to HMRC</div><div class="task-source">email</div></div>
          <div class="task-item" onclick="toggleTask(this)"><div class="task-check done"><i class="bi bi-check-lg"></i></div><div class="task-text done">Review Q4 management accounts</div><div class="task-source">manual</div></div>
          <div class="task-item" onclick="toggleTask(this)"><div class="task-check"></div><div class="task-text">Book dentist appointment â€” voicemail follow up</div><div class="task-source">call</div></div>
          <div class="task-item" onclick="toggleTask(this)"><div class="task-check"></div><div class="task-text">Renew car insurance â€” expires 15 March</div><div class="task-source">email</div></div>
          <div class="task-item" onclick="toggleTask(this)"><div class="task-check"></div><div class="task-text">Review AAT Level 2 practice exam papers</div><div class="task-source">manual</div></div>
        </div>
      </div>
    </div>

    <!-- EMAILS VIEW -->
    <div class="content" id="view-emails">
      <div class="card">
        <div class="card-header"><div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-envelope-fill"></i></div><div><div class="card-title">Inbox â€” AI Summarised</div><div class="card-sub">All email providers Â· Nylas unified</div></div></div>
        <div class="card-body">
          <div class="email-item"><div class="email-avatar" style="background:#dc2626;">H</div><div class="email-content"><div class="email-from">HMRC</div><div class="email-subject">Self Assessment 2024/25 â€” Action Required</div><div class="email-summary">â†’ File your self assessment return by 31 Jan. Penalty of Â£100 if late. Task added.</div></div><div class="email-time">09:02</div></div>
          <div class="email-item"><div class="email-avatar" style="background:#7c3aed;">N</div><div class="email-content"><div class="email-from">Netflix</div><div class="email-subject">Your plan price is changing from 15 March</div><div class="email-summary">â†’ Standard plan rising from Â£10.99 to Â£13.99/month. Bill alert created.</div></div><div class="email-time">Fri</div></div>
          <div class="email-item"><div class="email-avatar" style="background:#059669;">A</div><div class="email-content"><div class="email-from">ASOS</div><div class="email-subject">Your order is on its way ðŸŽ‰</div><div class="email-summary">â†’ Order dispatched via Evri. Tracking EVR-28291. Est. arrival today. Parcel added.</div></div><div class="email-time">Thu</div></div>
          <div class="email-item"><div class="email-avatar" style="background:#0284c7;">B</div><div class="email-content"><div class="email-from">Barclays</div><div class="email-subject">Your February statement is ready</div><div class="email-summary">â†’ Statement for Feb 2026 available. Total spend Â£1,842. No action required.</div></div><div class="email-time">Wed</div></div>
          <div class="email-item"><div class="email-avatar" style="background:#b45309;">E</div><div class="email-content"><div class="email-from">Eventim</div><div class="email-subject">Your tickets for Glastonbury 2026</div><div class="email-summary">â†’ 2x tickets attached. Event 25 Jun 2026. Tickets saved to Wallet.</div></div><div class="email-time">Tue</div></div>
        </div>
      </div>
    </div>

    <!-- CALLS VIEW -->
    <div class="content" id="view-calls">
      <div class="card">
        <div class="card-header"><div class="card-icon" style="background:var(--green-light);"><i class="bi bi-telephone-fill"></i></div><div><div class="card-title">Call Log â€” AI Summarised</div><div class="card-sub">Whisper transcription Â· Claude summary</div></div></div>
        <div class="card-body">
          <div class="call-item"><div class="call-avatar" style="background:#7c3aed;">D</div><div class="call-info"><div class="call-name">Dr. Smith â€” GP Surgery</div><div class="call-summary">Voicemail: Appointment available Mon 2 Mar at 10:30AM. Call back to confirm. Task added to book.</div></div><div class="call-meta"><div class="call-time">Yesterday</div><div class="call-duration">0:42</div></div></div>
          <div class="call-item"><div class="call-avatar" style="background:#0284c7;">M</div><div class="call-info"><div class="call-name">Manager â€” Work</div><div class="call-summary">Discussion re: Q1 management accounts deadline moved to 10 March. Review meeting booked for 12 Mar. Event added.</div></div><div class="call-meta"><div class="call-time">Thu</div><div class="call-duration">4:17</div></div></div>
          <div class="call-item"><div class="call-avatar" style="background:#059669;">I</div><div class="call-info"><div class="call-name">Insurance â€” Admiral</div><div class="call-summary">Renewal quote provided: Â£642/year. Valid 14 days. Task created to compare and renew before expiry.</div></div><div class="call-meta"><div class="call-time">Mon</div><div class="call-duration">6:54</div></div></div>
        </div>
      </div>
    </div>

    <!-- WALLET VIEW -->
    <div class="content" id="view-wallet">
      <div style="max-width:380px;">
        <div class="wallet-card">
          <div class="wallet-type">Event Ticket</div>
          <div class="wallet-event">Glastonbury Festival 2026</div>
          <div class="wallet-detail">25â€“29 June 2026 Â· Worthy Farm, Somerset</div>
          <div class="wallet-detail" style="margin-top:4px;">General Admission Â· x2</div>
          <div class="wallet-barcode"></div>
        </div>
        <div class="wallet-card" style="background:linear-gradient(135deg,#1e3a5f,#2d5a8e);">
          <div class="wallet-type">Travel Card</div>
          <div class="wallet-event">LNER â€” London to Leeds</div>
          <div class="wallet-detail">15 March 2026 Â· 08:45 departure Â· Coach C</div>
          <div class="wallet-detail" style="margin-top:4px;">Standard Â· 1 Adult</div>
          <div class="wallet-barcode"></div>
        </div>
      </div>
    </div>

    <!-- BUDGET VIEW â€” UPDATED WITH TRANSACTIONS -->
    <div class="content" id="view-budget">
      <div class="stat-row">
        <div class="stat-card"><div class="stat-value">Â£2,500</div><div class="stat-label">Monthly Budget</div></div>
        <div class="stat-card"><div class="stat-value">Â£1,842</div><div class="stat-label">Spent</div><div class="stat-change change-up">â†“ 8% vs Jan</div></div>
        <div class="stat-card"><div class="stat-value">Â£658</div><div class="stat-label">Remaining</div><div class="stat-change" style="color:var(--green)">26% of budget</div></div>
        <div class="stat-card"><div class="stat-value">Â£61</div><div class="stat-label">Daily Average</div></div>
      </div>

      <div style="display:grid; grid-template-columns:1fr 1.6fr; gap:16px;">

        <!-- Pie chart card -->
        <div class="card">
          <div class="card-header"><div class="card-icon" style="background:var(--amber-light);"><i class="bi bi-pie-chart-fill"></i></div><div><div class="card-title">February Breakdown</div><div class="card-sub">Linked via TrueLayer Â· Auto-categorised</div></div></div>
          <div class="card-body">
            <div class="budget-chart-wrap" style="flex-direction:column; gap:20px; align-items:flex-start;">
              <div class="pie-wrap" style="width:130px;height:130px; margin:0 auto;">
                <svg width="130" height="130" viewBox="0 0 130 130">
                  <circle cx="65" cy="65" r="54" fill="none" stroke="#f5f2ed" stroke-width="18"/>
                  <circle cx="65" cy="65" r="54" fill="none" stroke="#3b82f6" stroke-width="18" stroke-dasharray="104 236" stroke-dashoffset="0"/>
                  <circle cx="65" cy="65" r="54" fill="none" stroke="#10b981" stroke-width="18" stroke-dasharray="80 236" stroke-dashoffset="-104"/>
                  <circle cx="65" cy="65" r="54" fill="none" stroke="#f59e0b" stroke-width="18" stroke-dasharray="50 236" stroke-dashoffset="-184"/>
                  <circle cx="65" cy="65" r="54" fill="none" stroke="#ef4444" stroke-width="18" stroke-dasharray="74 236" stroke-dashoffset="-234"/>
                  <circle cx="65" cy="65" r="54" fill="none" stroke="#8b5cf6" stroke-width="18" stroke-dasharray="40 236" stroke-dashoffset="-308"/>
                </svg>
                <div class="pie-center"><div class="pie-total" style="font-size:16px;">Â£1,842</div><div class="pie-label">Feb 2026</div></div>
              </div>
              <div class="budget-legend" style="width:100%; gap:10px;">
                <div class="budget-item"><div class="budget-dot" style="background:#3b82f6;width:10px;height:10px;"></div><div class="budget-cat">Housing & Utilities</div><div class="budget-amt">Â£780</div><div class="budget-pct">31%</div></div>
                <div class="budget-item"><div class="budget-dot" style="background:#10b981;width:10px;height:10px;"></div><div class="budget-cat">Food & Groceries</div><div class="budget-amt">Â£340</div><div class="budget-pct">18%</div></div>
                <div class="budget-item"><div class="budget-dot" style="background:#f59e0b;width:10px;height:10px;"></div><div class="budget-cat">Transport</div><div class="budget-amt">Â£210</div><div class="budget-pct">11%</div></div>
                <div class="budget-item"><div class="budget-dot" style="background:#ef4444;width:10px;height:10px;"></div><div class="budget-cat">Shopping</div><div class="budget-amt">Â£312</div><div class="budget-pct">17%</div></div>
                <div class="budget-item"><div class="budget-dot" style="background:#8b5cf6;width:10px;height:10px;"></div><div class="budget-cat">Subscriptions</div><div class="budget-amt">Â£200</div><div class="budget-pct">11%</div></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Transactions card -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-list-ul"></i></div>
            <div>
              <div class="card-title">Transactions</div>
              <div class="card-sub">February 2026 Â· Auto-categorised Â· TrueLayer</div>
            </div>
            <button class="btn btn-ghost" style="margin-left:auto; font-size:11px; padding:6px 12px;" onclick="showToast('ðŸ” Filtering transactions...')">Filter</button>
          </div>
          <div class="card-body" style="padding:10px 18px;">

            <!-- Tesco â€” has receipt attached -->
            <div class="tx-item" onclick="openReceipt()">
              <div class="tx-logo tesco-logo" style="width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:10px;">T</div>
              <div class="tx-info">
                <div class="tx-merchant">
                  Tesco Superstore
                  <span class="receipt-badge" onclick="event.stopPropagation(); openReceipt()">ðŸ“„ Receipt</span>
                </div>
                <div class="tx-meta">
                  <span class="cat-pill cat-food">Food</span>
                  &nbsp;Â· Lincoln, Tritton Rd Â· 27 Feb
                </div>
              </div>
              <div class="tx-right">
                <div class="tx-amount debit">âˆ’Â£47.83</div>
                <div class="tx-date">Today</div>
              </div>
            </div>

            <!-- Barclays salary -->
            <div class="tx-item">
              <div class="tx-logo" style="background:#00395d;color:white;font-size:10px;font-weight:800;">BAR</div>
              <div class="tx-info">
                <div class="tx-merchant">Salary â€” Employer Ltd</div>
                <div class="tx-meta"><span class="cat-pill cat-housing">Income</span> &nbsp;Â· Direct credit Â· 25 Feb</div>
              </div>
              <div class="tx-right">
                <div class="tx-amount credit">+Â£1,650.00</div>
                <div class="tx-date">25 Feb</div>
              </div>
            </div>

            <!-- TfL -->
            <div class="tx-item">
              <div class="tx-logo" style="background:#e1251b;color:white;font-size:11px;font-weight:800;">TfL</div>
              <div class="tx-info">
                <div class="tx-merchant">Transport for London</div>
                <div class="tx-meta"><span class="cat-pill cat-transport">Transport</span> &nbsp;Â· Contactless Â· 24 Feb</div>
              </div>
              <div class="tx-right">
                <div class="tx-amount debit">âˆ’Â£4.80</div>
                <div class="tx-date">24 Feb</div>
              </div>
            </div>

            <!-- ASOS -->
            <div class="tx-item">
              <div class="tx-logo" style="background:#1a1a1a;color:white;font-size:10px;font-weight:800;">ASO</div>
              <div class="tx-info">
                <div class="tx-merchant">ASOS</div>
                <div class="tx-meta"><span class="cat-pill cat-shopping">Shopping</span> &nbsp;Â· Online Â· 23 Feb</div>
              </div>
              <div class="tx-right">
                <div class="tx-amount debit">âˆ’Â£62.00</div>
                <div class="tx-date">23 Feb</div>
              </div>
            </div>

            <!-- Netflix -->
            <div class="tx-item">
              <div class="tx-logo" style="background:#e50914;color:white;font-size:11px;font-weight:800;">N</div>
              <div class="tx-info">
                <div class="tx-merchant">Netflix</div>
                <div class="tx-meta"><span class="cat-pill cat-subs">Subscription</span> &nbsp;Â· Recurring Â· 15 Feb</div>
              </div>
              <div class="tx-right">
                <div class="tx-amount debit">âˆ’Â£13.99</div>
                <div class="tx-date">15 Feb</div>
              </div>
            </div>

            <!-- Tesco Express â€” no receipt -->
            <div class="tx-item">
              <div class="tx-logo tesco-logo" style="width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:10px;">T</div>
              <div class="tx-info">
                <div class="tx-merchant">Tesco Express</div>
                <div class="tx-meta"><span class="cat-pill cat-food">Food</span> &nbsp;Â· Lincoln, High St Â· 14 Feb</div>
              </div>
              <div class="tx-right">
                <div class="tx-amount debit">âˆ’Â£8.42</div>
                <div class="tx-date">14 Feb</div>
              </div>
            </div>

            <!-- Amazon -->
            <div class="tx-item">
              <div class="tx-logo" style="background:#ff9900;color:#111;font-size:10px;font-weight:800;">AMZ</div>
              <div class="tx-info">
                <div class="tx-merchant">Amazon</div>
                <div class="tx-meta"><span class="cat-pill cat-shopping">Shopping</span> &nbsp;Â· Online Â· 12 Feb</div>
              </div>
              <div class="tx-right">
                <div class="tx-amount debit">âˆ’Â£24.99</div>
                <div class="tx-date">12 Feb</div>
              </div>
            </div>

            <!-- Spotify -->
            <div class="tx-item">
              <div class="tx-logo" style="background:#1db954;color:white;font-size:11px;font-weight:800;">S</div>
              <div class="tx-info">
                <div class="tx-merchant">Spotify Premium</div>
                <div class="tx-meta"><span class="cat-pill cat-subs">Subscription</span> &nbsp;Â· Recurring Â· 3 Feb</div>
              </div>
              <div class="tx-right">
                <div class="tx-amount debit">âˆ’Â£11.99</div>
                <div class="tx-date">3 Feb</div>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>

    <!-- BILLS VIEW -->
    <div class="content" id="view-bills">
      <div class="card">
        <div class="card-header"><div class="card-icon" style="background:var(--red-light);"><i class="bi bi-receipt"></i></div><div><div class="card-title">Bills & Subscriptions</div><div class="card-sub">Auto-detected from recurring transactions</div></div></div>
        <div class="card-body">
          <div class="bill-item"><div class="bill-icon" style="background:#e50914;color:white;">N</div><div class="bill-info"><div class="bill-name">Netflix</div><div class="bill-freq">Monthly Â· 15th Â· Standard Plan</div></div><div><div class="bill-amount">Â£13.99</div><div class="price-change">â†‘ was Â£10.99</div></div></div>
          <div class="bill-item"><div class="bill-icon" style="background:#1db954;color:white;">S</div><div class="bill-info"><div class="bill-name">Spotify Premium</div><div class="bill-freq">Monthly Â· 3rd</div></div><div class="bill-amount">Â£11.99</div></div>
          <div class="bill-item"><div class="bill-icon" style="background:#0078d4;color:white;">M</div><div class="bill-info"><div class="bill-name">Microsoft 365</div><div class="bill-freq">Monthly Â· 1st</div></div><div class="bill-amount">Â£9.99</div></div>
          <div class="bill-item"><div class="bill-icon" style="background:#00b4d8;color:white;">C</div><div class="bill-info"><div class="bill-name">Claude AI Pro</div><div class="bill-freq">Monthly Â· 22nd</div></div><div class="bill-amount">Â£18.00</div></div>
          <div class="bill-item"><div class="bill-icon" style="background:#ff9900;color:white;">A</div><div class="bill-info"><div class="bill-name">Amazon Prime</div><div class="bill-freq">Monthly Â· 8th</div></div><div><div class="bill-amount">Â£8.99</div><div class="price-change">â†‘ was Â£7.99</div></div></div>
        </div>
      </div>
    </div>

    <!-- CATEGORISATION VIEW -->
    <div class="content" id="view-categorisation">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background:#dbeafe;"><i class="bi bi-tags-fill"></i></div>
            <div><div class="card-title">Auto-Categorisation Engine</div><div class="card-sub">AI rule-based Â· Learns from corrections</div></div>
          </div>
          <div class="card-body">
            <div style="font-size:11px;font-family:'DM Mono',monospace;color:var(--ink3);margin-bottom:12px;">RECURRING PATTERNS DETECTED â€” FEBRUARY 2026</div>
            <!-- Categorised transaction rows -->
            <div class="tx-item" style="border-bottom:1px solid var(--border);padding:10px 0;">
              <div class="tx-logo" style="background:#e50914;color:white;font-size:11px;font-weight:800;">N</div>
              <div class="tx-info">
                <div class="tx-merchant">Netflix <span class="cat-pill cat-subs" style="margin-left:4px;">Subscription</span></div>
                <div class="tx-meta">Recurring Â· Monthly Â· 15th Â· 12 months detected</div>
              </div>
              <div class="tx-right"><div class="tx-amount debit">âˆ’Â£13.99</div><div class="tx-date" style="color:var(--green);font-size:9px;">âœ“ Auto</div></div>
            </div>
            <div class="tx-item" style="border-bottom:1px solid var(--border);padding:10px 0;">
              <div class="tx-logo" style="background:#1db954;color:white;font-size:11px;font-weight:800;">S</div>
              <div class="tx-info">
                <div class="tx-merchant">Spotify <span class="cat-pill cat-subs" style="margin-left:4px;">Subscription</span></div>
                <div class="tx-meta">Recurring Â· Monthly Â· 3rd Â· 18 months detected</div>
              </div>
              <div class="tx-right"><div class="tx-amount debit">âˆ’Â£11.99</div><div class="tx-date" style="color:var(--green);font-size:9px;">âœ“ Auto</div></div>
            </div>
            <div class="tx-item" style="border-bottom:1px solid var(--border);padding:10px 0;">
              <div class="tx-logo" style="background:#00539f;color:white;font-size:11px;font-weight:800;">T</div>
              <div class="tx-info">
                <div class="tx-merchant">Tesco <span class="cat-pill cat-food" style="margin-left:4px;">Groceries</span></div>
                <div class="tx-meta">Recurring Â· Weekly Â· Avg Â£44.20 Â· 24 occurrences</div>
              </div>
              <div class="tx-right"><div class="tx-amount debit">âˆ’Â£47.83</div><div class="tx-date" style="color:var(--green);font-size:9px;">âœ“ Auto</div></div>
            </div>
            <div class="tx-item" style="border-bottom:1px solid var(--border);padding:10px 0;">
              <div class="tx-logo" style="background:#0078d4;color:white;font-size:11px;font-weight:800;">M</div>
              <div class="tx-info">
                <div class="tx-merchant">Microsoft 365 <span class="cat-pill cat-subs" style="margin-left:4px;">Subscription</span></div>
                <div class="tx-meta">Recurring Â· Monthly Â· 1st Â· 8 months detected</div>
              </div>
              <div class="tx-right"><div class="tx-amount debit">âˆ’Â£9.99</div><div class="tx-date" style="color:var(--green);font-size:9px;">âœ“ Auto</div></div>
            </div>
            <div class="tx-item" style="border-bottom:1px solid var(--border);padding:10px 0;">
              <div class="tx-logo" style="background:#e1251b;color:white;font-size:11px;font-weight:800;">TfL</div>
              <div class="tx-info">
                <div class="tx-merchant">Transport for London <span class="cat-pill cat-transport" style="margin-left:4px;">Transport</span></div>
                <div class="tx-meta">Recurring Â· Weekdays Â· Avg Â£5.20 Â· 48 occurrences</div>
              </div>
              <div class="tx-right"><div class="tx-amount debit">âˆ’Â£4.80</div><div class="tx-date" style="color:var(--green);font-size:9px;">âœ“ Auto</div></div>
            </div>
            <div class="tx-item" style="border-bottom:1px solid var(--border);padding:10px 0;">
              <div class="tx-logo" style="background:#00539f;color:white;font-size:11px;font-weight:800;">T</div>
              <div class="tx-info">
                <div class="tx-merchant">Tesco Express <span class="cat-pill cat-food" style="margin-left:4px;">Groceries</span></div>
                <div class="tx-meta">Recurring Â· 2â€“3x weekly Â· Avg Â£7.80 Â· Top-up shops</div>
              </div>
              <div class="tx-right"><div class="tx-amount debit">âˆ’Â£8.42</div><div class="tx-date" style="color:var(--green);font-size:9px;">âœ“ Auto</div></div>
            </div>
            <div class="tx-item" style="padding:10px 0;">
              <div class="tx-logo" style="background:#ff9900;color:#111;font-size:10px;font-weight:800;">AMZ</div>
              <div class="tx-info">
                <div class="tx-merchant">Amazon Prime <span class="cat-pill cat-subs" style="margin-left:4px;">Subscription</span></div>
                <div class="tx-meta">Recurring Â· Monthly Â· 8th Â· Price increase detected</div>
              </div>
              <div class="tx-right"><div class="tx-amount debit">âˆ’Â£8.99</div><div class="tx-date" style="color:var(--red);font-size:9px;">â†‘ Price</div></div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background:#fef3c7;"><i class="bi bi-calculator-fill"></i></div>
            <div><div class="card-title">Category Breakdown</div><div class="card-sub">Monthly recurring spend by category</div></div>
          </div>
          <div class="card-body">
            <div style="margin-bottom:16px;">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
                <div style="font-size:12px;font-weight:700;color:var(--ink);">Subscriptions</div>
                <div style="font-family:'DM Mono',monospace;font-size:12px;font-weight:600;">Â£62.96 / mo</div>
              </div>
              <div style="height:6px;background:var(--border);border-radius:3px;overflow:hidden;"><div style="height:100%;width:68%;background:#8b5cf6;border-radius:3px;"></div></div>
              <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);margin-top:4px;">Netflix Â· Spotify Â· M365 Â· Claude Â· Amazon Â· 5 services</div>
            </div>
            <div style="margin-bottom:16px;">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
                <div style="font-size:12px;font-weight:700;color:var(--ink);">Groceries</div>
                <div style="font-family:'DM Mono',monospace;font-size:12px;font-weight:600;">Â£196.40 / mo</div>
              </div>
              <div style="height:6px;background:var(--border);border-radius:3px;overflow:hidden;"><div style="height:100%;width:85%;background:#10b981;border-radius:3px;"></div></div>
              <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);margin-top:4px;">Tesco Superstore Â· Tesco Express Â· Weekly avg Â£44.20</div>
            </div>
            <div style="margin-bottom:16px;">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
                <div style="font-size:12px;font-weight:700;color:var(--ink);">Transport</div>
                <div style="font-family:'DM Mono',monospace;font-size:12px;font-weight:600;">Â£114.40 / mo</div>
              </div>
              <div style="height:6px;background:var(--border);border-radius:3px;overflow:hidden;"><div style="height:100%;width:52%;background:#3b82f6;border-radius:3px;"></div></div>
              <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);margin-top:4px;">TfL contactless Â· 22 journeys avg detected</div>
            </div>
            <div style="padding:12px;background:var(--bg2);border-radius:8px;border:1px solid var(--border);margin-top:8px;">
              <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);margin-bottom:6px;">AI INSIGHT</div>
              <div style="font-size:12px;color:var(--ink2);line-height:1.5;">Subscription spend has increased <strong>Â£5.99/mo</strong> since October due to Netflix and Amazon price rises. Grocery spend is <strong>12% above</strong> your 6-month average.</div>
            </div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:var(--amber-light);"><i class="bi bi-exclamation-triangle-fill"></i></div>
          <div><div class="card-title">Uncategorised Transactions</div><div class="card-sub">2 transactions need review</div></div>
        </div>
        <div class="card-body">
          <div class="tx-item" style="border-bottom:1px solid var(--border);padding:10px 0;">
            <div class="tx-logo" style="background:#6b7280;color:white;font-size:10px;font-weight:800;">?</div>
            <div class="tx-info">
              <div class="tx-merchant">SUMUP*THECOFFEEHOUSE <span style="font-size:9px;font-family:'DM Mono',monospace;background:var(--amber-light);color:var(--amber);padding:2px 6px;border-radius:4px;margin-left:4px;">Unclassified</span></div>
              <div class="tx-meta">25 Feb Â· Card payment Â· Possible: Food & Drink</div>
            </div>
            <div class="tx-right">
              <div class="tx-amount debit">âˆ’Â£4.20</div>
              <div style="display:flex;gap:4px;margin-top:4px;">
                <button class="btn btn-ghost" style="padding:2px 8px;font-size:9px;" onclick="showToast('âœ“ Categorised as Food & Drink')">Food</button>
                <button class="btn btn-ghost" style="padding:2px 8px;font-size:9px;" onclick="showToast('âœ“ Category saved')">Other</button>
              </div>
            </div>
          </div>
          <div class="tx-item" style="padding:10px 0;">
            <div class="tx-logo" style="background:#6b7280;color:white;font-size:10px;font-weight:800;">?</div>
            <div class="tx-info">
              <div class="tx-merchant">PAYPAL*EBAY_SELLER <span style="font-size:9px;font-family:'DM Mono',monospace;background:var(--amber-light);color:var(--amber);padding:2px 6px;border-radius:4px;margin-left:4px;">Unclassified</span></div>
              <div class="tx-meta">18 Feb Â· Card payment Â· Possible: Shopping</div>
            </div>
            <div class="tx-right">
              <div class="tx-amount debit">âˆ’Â£32.00</div>
              <div style="display:flex;gap:4px;margin-top:4px;">
                <button class="btn btn-ghost" style="padding:2px 8px;font-size:9px;" onclick="showToast('âœ“ Categorised as Shopping')">Shopping</button>
                <button class="btn btn-ghost" style="padding:2px 8px;font-size:9px;" onclick="showToast('âœ“ Category saved')">Other</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- VAT RETURN VIEW -->
    <div class="content" id="view-vat">
      <!-- Header stats -->
      <div class="stat-row" style="grid-template-columns:repeat(4,1fr);">
        <div class="stat-card" style="border-left:3px solid #2c4a7c;">
          <div class="stat-label">VAT on Sales (Box 1)</div>
          <div class="stat-value" style="font-size:20px;margin-top:6px;">Â£4,820.00</div>
          <div class="stat-change" style="color:var(--ink3);">Output VAT @ 20%</div>
        </div>
        <div class="stat-card" style="border-left:3px solid #10b981;">
          <div class="stat-label">VAT Reclaimed (Box 4)</div>
          <div class="stat-value" style="font-size:20px;margin-top:6px;">Â£1,243.60</div>
          <div class="stat-change" style="color:var(--green);">Input VAT reclaimable</div>
        </div>
        <div class="stat-card" style="border-left:3px solid #ef4444;">
          <div class="stat-label">VAT Owed to HMRC</div>
          <div class="stat-value" style="font-size:20px;margin-top:6px;">Â£3,576.40</div>
          <div class="stat-change" style="color:var(--red);">Box 1 minus Box 4</div>
        </div>
        <div class="stat-card" style="border-left:3px solid var(--amber);">
          <div class="stat-label">Due Date</div>
          <div class="stat-value" style="font-size:20px;margin-top:6px;">7 Feb 26</div>
          <div class="stat-change" style="color:var(--amber);">Overdue â€” submit now</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1.2fr 1fr;gap:16px;margin-bottom:16px;">
        <!-- VAT Return Form -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background:#d0ddf5;"><i class="bi bi-file-earmark-spreadsheet-fill"></i></div>
            <div><div class="card-title">VAT Return â€” Q4 Octâ€“Dec 2025</div><div class="card-sub">MTD compliant Â· Auto-populated from transactions</div></div>
            <span style="font-size:9px;font-family:'DM Mono',monospace;background:var(--amber-light);color:var(--amber);padding:3px 8px;border-radius:4px;margin-left:auto;">DRAFT</span>
          </div>
          <div class="card-body">
            <table style="width:100%;border-collapse:collapse;font-size:12px;">
              <thead>
                <tr style="border-bottom:2px solid var(--border);">
                  <th style="text-align:left;padding:6px 4px;font-family:'DM Mono',monospace;font-size:10px;color:var(--ink3);font-weight:500;letter-spacing:1px;">BOX</th>
                  <th style="text-align:left;padding:6px 4px;font-family:'DM Mono',monospace;font-size:10px;color:var(--ink3);font-weight:500;letter-spacing:1px;">DESCRIPTION</th>
                  <th style="text-align:right;padding:6px 4px;font-family:'DM Mono',monospace;font-size:10px;color:var(--ink3);font-weight:500;letter-spacing:1px;">AMOUNT</th>
                </tr>
              </thead>
              <tbody>
                <tr style="border-bottom:1px solid var(--border);">
                  <td style="padding:8px 4px;font-family:'DM Mono',monospace;font-weight:700;color:#2c4a7c;">1</td>
                  <td style="padding:8px 4px;color:var(--ink2);">VAT due on sales and other outputs</td>
                  <td style="padding:8px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£4,820.00</td>
                </tr>
                <tr style="border-bottom:1px solid var(--border);">
                  <td style="padding:8px 4px;font-family:'DM Mono',monospace;font-weight:700;color:#2c4a7c;">2</td>
                  <td style="padding:8px 4px;color:var(--ink2);">VAT due on acquisitions from EU</td>
                  <td style="padding:8px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£0.00</td>
                </tr>
                <tr style="border-bottom:1px solid var(--border);">
                  <td style="padding:8px 4px;font-family:'DM Mono',monospace;font-weight:700;color:#2c4a7c;">3</td>
                  <td style="padding:8px 4px;color:var(--ink2);">Total VAT due (Box 1 + Box 2)</td>
                  <td style="padding:8px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£4,820.00</td>
                </tr>
                <tr style="border-bottom:1px solid var(--border);background:rgba(16,185,129,0.04);">
                  <td style="padding:8px 4px;font-family:'DM Mono',monospace;font-weight:700;color:#166534;">4</td>
                  <td style="padding:8px 4px;color:var(--ink2);">VAT reclaimed on purchases and inputs</td>
                  <td style="padding:8px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;color:#166534;">Â£1,243.60</td>
                </tr>
                <tr style="border-bottom:2px solid var(--border);background:rgba(239,68,68,0.04);">
                  <td style="padding:8px 4px;font-family:'DM Mono',monospace;font-weight:700;color:#991b1b;">5</td>
                  <td style="padding:8px 4px;color:var(--ink);font-weight:700;">Net VAT to pay to HMRC</td>
                  <td style="padding:8px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:700;color:#991b1b;">Â£3,576.40</td>
                </tr>
                <tr style="border-bottom:1px solid var(--border);">
                  <td style="padding:8px 4px;font-family:'DM Mono',monospace;font-weight:700;color:#2c4a7c;">6</td>
                  <td style="padding:8px 4px;color:var(--ink2);">Total value of sales excl. VAT</td>
                  <td style="padding:8px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£24,100.00</td>
                </tr>
                <tr style="border-bottom:1px solid var(--border);">
                  <td style="padding:8px 4px;font-family:'DM Mono',monospace;font-weight:700;color:#2c4a7c;">7</td>
                  <td style="padding:8px 4px;color:var(--ink2);">Total value of purchases excl. VAT</td>
                  <td style="padding:8px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£6,218.00</td>
                </tr>
                <tr style="border-bottom:1px solid var(--border);">
                  <td style="padding:8px 4px;font-family:'DM Mono',monospace;font-weight:700;color:#2c4a7c;">8</td>
                  <td style="padding:8px 4px;color:var(--ink2);">Total supplies to EU excl. VAT</td>
                  <td style="padding:8px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£0.00</td>
                </tr>
                <tr>
                  <td style="padding:8px 4px;font-family:'DM Mono',monospace;font-weight:700;color:#2c4a7c;">9</td>
                  <td style="padding:8px 4px;color:var(--ink2);">Total acquisitions from EU excl. VAT</td>
                  <td style="padding:8px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£0.00</td>
                </tr>
              </tbody>
            </table>
            <div style="margin-top:14px;display:flex;gap:8px;">
              <button class="btn btn-primary" style="flex:1;" onclick="showToast('ðŸ“¤ Submitting VAT return to HMRC via MTD...')">Submit to HMRC (MTD)</button>
              <button class="btn btn-ghost" onclick="showToast('ðŸ“„ VAT return exported as PDF')">Export PDF</button>
            </div>
          </div>
        </div>

        <!-- VAT breakdown detail -->
        <div style="display:flex;flex-direction:column;gap:16px;">
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-bar-chart-fill"></i></div>
              <div><div class="card-title">Output VAT Detail</div><div class="card-sub">Sales by VAT rate â€” Q4 2025</div></div>
            </div>
            <div class="card-body">
              <div style="display:flex;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border);font-size:12px;">
                <div style="color:var(--ink2);">Standard Rate (20%)</div>
                <div style="font-family:'DM Mono',monospace;font-weight:600;">Â£24,100.00 â†’ <span style="color:#2c4a7c;">Â£4,820.00</span></div>
              </div>
              <div style="display:flex;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border);font-size:12px;">
                <div style="color:var(--ink2);">Reduced Rate (5%)</div>
                <div style="font-family:'DM Mono',monospace;font-weight:600;">Â£0.00 â†’ <span style="color:#2c4a7c;">Â£0.00</span></div>
              </div>
              <div style="display:flex;justify-content:space-between;padding:7px 0;font-size:12px;">
                <div style="color:var(--ink2);">Zero Rated (0%)</div>
                <div style="font-family:'DM Mono',monospace;font-weight:600;">Â£0.00 â†’ <span style="color:#2c4a7c;">Â£0.00</span></div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background:var(--green-light);"><i class="bi bi-graph-up-arrow"></i></div>
              <div><div class="card-title">Input VAT Detail</div><div class="card-sub">Reclaimable purchases â€” Q4 2025</div></div>
            </div>
            <div class="card-body">
              <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid var(--border);font-size:12px;">
                <div><div style="font-weight:600;color:var(--ink);">Software & Subscriptions</div><div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">M365, Claude, Adobe</div></div>
                <div style="font-family:'DM Mono',monospace;font-weight:600;color:#166534;">Â£87.40</div>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid var(--border);font-size:12px;">
                <div><div style="font-weight:600;color:var(--ink);">Office & Equipment</div><div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">Hardware, peripherals</div></div>
                <div style="font-family:'DM Mono',monospace;font-weight:600;color:#166534;">Â£624.00</div>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid var(--border);font-size:12px;">
                <div><div style="font-weight:600;color:var(--ink);">Professional Services</div><div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">Accountancy, legal</div></div>
                <div style="font-family:'DM Mono',monospace;font-weight:600;color:#166534;">Â£360.00</div>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;padding:7px 0;font-size:12px;">
                <div><div style="font-weight:600;color:var(--ink);">Travel & Transport</div><div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">Rail, fuel, parking</div></div>
                <div style="font-family:'DM Mono',monospace;font-weight:600;color:#166534;">Â£172.20</div>
              </div>
              <div style="border-top:2px solid var(--border);margin-top:6px;padding-top:8px;display:flex;justify-content:space-between;font-size:13px;font-weight:700;">
                <div>Total Input VAT</div>
                <div style="font-family:'DM Mono',monospace;color:#166534;">Â£1,243.60</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- TAX RETURN VIEW -->
    <div class="content" id="view-tax">
      <div class="stat-row" style="grid-template-columns:repeat(4,1fr);">
        <div class="stat-card" style="border-left:3px solid #2c4a7c;">
          <div class="stat-label">Total Income</div>
          <div class="stat-value" style="font-size:20px;margin-top:6px;">Â£42,800.00</div>
          <div class="stat-change" style="color:var(--ink3);">All sources 2024/25</div>
        </div>
        <div class="stat-card" style="border-left:3px solid #10b981;">
          <div class="stat-label">Allowable Expenses</div>
          <div class="stat-value" style="font-size:20px;margin-top:6px;">Â£8,340.00</div>
          <div class="stat-change" style="color:var(--green);">Deducted from income</div>
        </div>
        <div class="stat-card" style="border-left:3px solid #ef4444;">
          <div class="stat-label">Tax Owed</div>
          <div class="stat-value" style="font-size:20px;margin-top:6px;">Â£6,182.40</div>
          <div class="stat-change" style="color:var(--red);">Inc. NI contributions</div>
        </div>
        <div class="stat-card" style="border-left:3px solid var(--amber);">
          <div class="stat-label">Payments on Account</div>
          <div class="stat-value" style="font-size:20px;margin-top:6px;">Â£3,091.20</div>
          <div class="stat-change" style="color:var(--amber);">Due 31 Jan + 31 Jul</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1.3fr 1fr;gap:16px;">

        <!-- SA100 Form -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background:#d0ddf5;"><i class="bi bi-calculator-fill"></i></div>
            <div><div class="card-title">Self Assessment â€” SA100</div><div class="card-sub">Tax year 6 Apr 2024 â€“ 5 Apr 2025 Â· HMRC reference: UTR 1234567890</div></div>
            <span style="font-size:9px;font-family:'DM Mono',monospace;background:var(--amber-light);color:var(--amber);padding:3px 8px;border-radius:4px;margin-left:auto;">DRAFT</span>
          </div>
          <div class="card-body">
            <!-- Income section -->
            <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid var(--border);">INCOME</div>
            <table style="width:100%;border-collapse:collapse;font-size:12px;margin-bottom:16px;">
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Employment income (P60)</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£28,500.00</td>
              </tr>
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Self-employment / freelance income</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£12,300.00</td>
              </tr>
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Dividends received</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£1,200.00</td>
              </tr>
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Savings interest</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£800.00</td>
              </tr>
              <tr style="border-bottom:2px solid var(--border);">
                <td style="padding:7px 4px;font-weight:700;color:var(--ink);">Total Income</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:700;">Â£42,800.00</td>
              </tr>
            </table>
            <!-- Deductions -->
            <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid var(--border);">ALLOWABLE DEDUCTIONS</div>
            <table style="width:100%;border-collapse:collapse;font-size:12px;margin-bottom:16px;">
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Personal allowance</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;color:#166534;">âˆ’Â£12,570.00</td>
              </tr>
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Business expenses (SE income)</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;color:#166534;">âˆ’Â£4,200.00</td>
              </tr>
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Pension contributions</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;color:#166534;">âˆ’Â£2,400.00</td>
              </tr>
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Gift Aid donations</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;color:#166534;">âˆ’Â£480.00</td>
              </tr>
              <tr style="border-bottom:2px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Dividend allowance</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;color:#166534;">âˆ’Â£500.00</td>
              </tr>
              <tr>
                <td style="padding:7px 4px;font-weight:700;color:var(--ink);">Taxable Income</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:700;">Â£22,650.00</td>
              </tr>
            </table>
            <!-- Tax Calculation -->
            <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid var(--border);">TAX CALCULATION</div>
            <table style="width:100%;border-collapse:collapse;font-size:12px;">
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Basic rate tax (20%) on Â£22,650</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£4,530.00</td>
              </tr>
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Tax deducted at source (PAYE)</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;color:#166534;">âˆ’Â£2,340.00</td>
              </tr>
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Class 4 NI (9% on Â£12,300 SE profit)</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£1,107.00</td>
              </tr>
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Class 2 NI contributions</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£179.40</td>
              </tr>
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Dividend tax (8.75% on Â£700)</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£61.25</td>
              </tr>
              <tr style="border-bottom:1px solid var(--border);">
                <td style="padding:7px 4px;color:var(--ink2);">Savings income tax (20%)</td>
                <td style="padding:7px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:600;">Â£0.00</td>
              </tr>
              <tr style="border-top:2px solid var(--border);background:rgba(239,68,68,0.04);">
                <td style="padding:9px 4px;font-weight:700;color:var(--ink);font-size:13px;">Total Tax &amp; NI Owed</td>
                <td style="padding:9px 4px;text-align:right;font-family:'DM Mono',monospace;font-weight:700;font-size:14px;color:#991b1b;">Â£6,182.40</td>
              </tr>
            </table>
            <div style="margin-top:14px;display:flex;gap:8px;">
              <button class="btn btn-primary" style="flex:1;" onclick="showToast('ðŸ“¤ Submitting Self Assessment to HMRC...')">Submit to HMRC</button>
              <button class="btn btn-ghost" onclick="showToast('ðŸ“„ SA100 exported as PDF')">Export PDF</button>
              <button class="btn btn-ghost" onclick="showToast('ðŸ“Š Report exported to Excel')">Export XLS</button>
            </div>
          </div>
        </div>

        <!-- Right column -->
        <div style="display:flex;flex-direction:column;gap:16px;">

          <!-- Tax timeline -->
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background:var(--amber-light);"><i class="bi bi-clock-history"></i></div>
              <div><div class="card-title">Key Deadlines</div><div class="card-sub">2024/25 tax year</div></div>
            </div>
            <div class="card-body">
              <div style="display:flex;gap:12px;align-items:flex-start;padding:8px 0;border-bottom:1px solid var(--border);">
                <div style="width:3px;height:36px;background:#991b1b;border-radius:2px;flex-shrink:0;margin-top:2px;"></div>
                <div><div style="font-size:12px;font-weight:700;color:#991b1b;">31 Jan 2026 â€” OVERDUE</div><div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">Online SA submission + balancing payment</div></div>
              </div>
              <div style="display:flex;gap:12px;align-items:flex-start;padding:8px 0;border-bottom:1px solid var(--border);">
                <div style="width:3px;height:36px;background:var(--amber);border-radius:2px;flex-shrink:0;margin-top:2px;"></div>
                <div><div style="font-size:12px;font-weight:700;color:var(--amber);">31 Jan 2026 â€” OVERDUE</div><div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">1st payment on account: Â£3,091.20</div></div>
              </div>
              <div style="display:flex;gap:12px;align-items:flex-start;padding:8px 0;">
                <div style="width:3px;height:36px;background:#2c4a7c;border-radius:2px;flex-shrink:0;margin-top:2px;"></div>
                <div><div style="font-size:12px;font-weight:700;color:#2c4a7c;">31 Jul 2026</div><div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">2nd payment on account: Â£3,091.20</div></div>
              </div>
            </div>
          </div>

          <!-- Expenses breakdown -->
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background:var(--green-light);"><i class="bi bi-currency-pound"></i></div>
              <div><div class="card-title">Allowable Expenses</div><div class="card-sub">Auto-matched from transactions</div></div>
            </div>
            <div class="card-body">
              <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border);font-size:12px;">
                <div><div style="font-weight:600;color:var(--ink);">Software & Tools</div><div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">Claude, VS Code, M365</div></div>
                <div style="font-family:'DM Mono',monospace;font-weight:600;color:#166534;">Â£648.00</div>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border);font-size:12px;">
                <div><div style="font-weight:600;color:var(--ink);">Home Office (25%)</div><div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">Utilities, broadband</div></div>
                <div style="font-family:'DM Mono',monospace;font-weight:600;color:#166534;">Â£960.00</div>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border);font-size:12px;">
                <div><div style="font-weight:600;color:var(--ink);">Professional Development</div><div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">AAT course, books</div></div>
                <div style="font-family:'DM Mono',monospace;font-weight:600;color:#166534;">Â£1,200.00</div>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border);font-size:12px;">
                <div><div style="font-weight:600;color:var(--ink);">Travel (business)</div><div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">Rail, LNER receipts</div></div>
                <div style="font-family:'DM Mono',monospace;font-weight:600;color:#166534;">Â£892.00</div>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;font-size:12px;">
                <div><div style="font-weight:600;color:var(--ink);">Equipment & Hardware</div><div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">GPU cable, peripherals</div></div>
                <div style="font-family:'DM Mono',monospace;font-weight:600;color:#166534;">Â£500.00</div>
              </div>
              <div style="border-top:2px solid var(--border);margin-top:6px;padding-top:8px;display:flex;justify-content:space-between;font-size:13px;font-weight:700;">
                <div>Total Expenses</div>
                <div style="font-family:'DM Mono',monospace;color:#166534;">Â£4,200.00</div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- INVENTORY VIEW -->
    <div class="content" id="view-inventory">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:var(--green-light);"><i class="bi bi-box-seam-fill"></i></div>
          <div>
            <div class="card-title">Food & Drink Inventory</div>
            <div class="card-sub">Updated from receipt scans Â· 1 item low</div>
          </div>
          <button class="btn btn-primary" style="margin-left:auto;" onclick="showToast('ðŸ“„ Upload receipt to scan inventory')">Scan Receipt</button>
        </div>
        <div class="card-body">
          <div class="inventory-item"><div class="inv-emoji">ðŸ¥›</div><div class="inv-name">Milk</div><div class="inv-qty">1 jug</div><div class="stock-bar"><div class="stock-fill" style="width:12%;background:#ef4444;"></div></div><div class="status-pill status-alert" style="margin-left:8px;">Low</div></div>
          <div class="inventory-item"><div class="inv-emoji">ðŸž</div><div class="inv-name">Bread</div><div class="inv-qty">1 loaf</div><div class="stock-bar"><div class="stock-fill" style="width:35%;background:#f59e0b;"></div></div></div>
          <div class="inventory-item"><div class="inv-emoji">ðŸ¥š</div><div class="inv-name">Eggs</div><div class="inv-qty">8</div><div class="stock-bar"><div class="stock-fill" style="width:65%;background:#10b981;"></div></div></div>
          <div class="inventory-item"><div class="inv-emoji">â˜•</div><div class="inv-name">Coffee Beans</div><div class="inv-qty">250g</div><div class="stock-bar"><div class="stock-fill" style="width:80%;background:#10b981;"></div></div></div>
          <div class="inventory-item"><div class="inv-emoji">ðŸš</div><div class="inv-name">Rice</div><div class="inv-qty">500g</div><div class="stock-bar"><div class="stock-fill" style="width:50%;background:#3b82f6;"></div></div></div>
          <div class="inventory-item"><div class="inv-emoji">ðŸ«’</div><div class="inv-name">Olive Oil</div><div class="inv-qty">400ml</div><div class="stock-bar"><div class="stock-fill" style="width:70%;background:#10b981;"></div></div></div>
          <div class="inventory-item"><div class="inv-emoji">ðŸ§„</div><div class="inv-name">Garlic</div><div class="inv-qty">4 cloves</div><div class="stock-bar"><div class="stock-fill" style="width:30%;background:#f59e0b;"></div></div></div>
        </div>
      </div>

      <!-- Shopping List -->
      <div class="card" style="margin-top:16px;">
        <div class="card-header">
          <div class="card-icon" style="background:var(--green-light);"><i class="bi bi-cart-fill"></i></div>
          <div>
            <div class="card-title">Shopping List</div>
            <div class="card-sub">Auto-generated from low stock Â· ANN suggested</div>
          </div>
          <button class="btn btn-ghost" style="margin-left:auto;font-size:11px;padding:6px 12px;" onclick="regenShopList()"><i class="bi bi-arrow-clockwise"></i> Regenerate</button>
        </div>
        <div class="card-body">
          <div id="shop-list">
            <div class="shop-item"><div class="shop-check" onclick="toggleShopItem(this)"></div><div class="shop-name">Milk</div><div class="shop-qty">2 jugs</div><span class="shop-source auto">Auto</span></div>
            <div class="shop-item"><div class="shop-check" onclick="toggleShopItem(this)"></div><div class="shop-name">Bread</div><div class="shop-qty">1 loaf</div><span class="shop-source auto">Auto</span></div>
            <div class="shop-item"><div class="shop-check" onclick="toggleShopItem(this)"></div><div class="shop-name">Garlic</div><div class="shop-qty">1 bulb</div><span class="shop-source auto">Auto</span></div>
            <div class="shop-item"><div class="shop-check" onclick="toggleShopItem(this)"></div><div class="shop-name">Chicken Breast</div><div class="shop-qty">500g</div><span class="shop-source auto">Auto</span></div>
            <div class="shop-item"><div class="shop-check" onclick="toggleShopItem(this)"></div><div class="shop-name">Spinach</div><div class="shop-qty">1 bag</div><span class="shop-source auto">Auto</span></div>
            <div class="shop-item"><div class="shop-check" onclick="toggleShopItem(this)"></div><div class="shop-name">Greek Yoghurt</div><div class="shop-qty">500g</div><span class="shop-source auto">Auto</span></div>
          </div>
          <div class="shop-add-row">
            <input class="shop-add-input" id="shop-add-input" placeholder="Add itemâ€¦" onkeydown="if(event.key==='Enter')addShopItem()">
            <button class="btn btn-ghost" style="padding:7px 14px;font-size:12px;" onclick="addShopItem()">+ Add</button>
          </div>
          <div style="display:flex;gap:8px;margin-top:12px;">
            <button class="btn btn-ghost" style="font-size:12px;" onclick="showToast('Opening Tesco onlineâ€¦')"><i class="bi bi-bag-fill"></i> Order via Tesco</button>
            <button class="btn btn-ghost" style="font-size:12px;" onclick="copyShopList()"><i class="bi bi-clipboard"></i> Copy List</button>
          </div>
        </div>
      </div>
    </div>

    <!-- MEALS VIEW -->
    <div class="content" id="view-meals">

      <!-- Tab bar -->
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <button class="meal-tab active" id="meal-tab-plan" onclick="switchMealTab('plan')">ðŸ“… Weekly Planner</button>
        <button class="meal-tab" id="meal-tab-recipes" onclick="switchMealTab('recipes')">ðŸ“– My Recipes</button>
      </div>

      <!-- WEEKLY PLANNER TAB -->
      <div id="meal-tab-content-plan">
        <div class="card" style="margin-bottom:16px;">
          <div class="card-header">
            <div class="card-icon" style="background:var(--green-light);"><i class="bi bi-cup-hot-fill"></i></div>
            <div>
              <div class="card-title">Weekly Meal Plan</div>
              <div class="card-sub">Mon 2 â€“ Sun 8 Mar 2026 Â· Click any slot to assign a meal</div>
            </div>
            <button class="btn btn-primary" style="margin-left:auto;" onclick="aiGeneratePlan()">ðŸ¤– AI Generate</button>
          </div>
          <div class="card-body" style="padding:0;">
            <div id="meal-planner-grid"></div>
          </div>
        </div>
      </div>

      <!-- RECIPES TAB -->
      <div id="meal-tab-content-recipes" style="display:none;">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <!-- Recipe list -->
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background:var(--amber-light);"><i class="bi bi-book-fill"></i></div>
              <div><div class="card-title">My Recipes</div><div class="card-sub" id="recipe-count-sub">6 saved recipes</div></div>
              <button class="btn btn-primary" style="margin-left:auto;" onclick="openRecipeEditor(null)">+ Add Recipe</button>
            </div>
            <div class="card-body" style="padding:8px 14px;" id="recipe-list-container"></div>
          </div>
          <!-- Recipe detail / editor -->
          <div class="card" id="recipe-detail-card">
            <div class="card-header">
              <div class="card-icon" style="background:var(--green-light);"><i class="bi bi-egg-fried"></i></div>
              <div><div class="card-title" id="recipe-detail-title">Select a recipe</div><div class="card-sub" id="recipe-detail-sub">or add a new one</div></div>
              <button class="btn btn-ghost" style="margin-left:auto;display:none;" id="recipe-edit-btn" onclick="openRecipeEditor(currentRecipeId)">Edit</button>
            </div>
            <div class="card-body" id="recipe-detail-body">
              <div style="text-align:center;padding:32px 16px;color:var(--ink3);font-family:'DM Mono',monospace;font-size:11px;">
                Select a recipe from the list to view details, or press + Add Recipe to create your own.
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- MEAL SLOT PICKER MODAL -->
    <div class="modal-overlay" id="meal-slot-modal" onclick="closeMealSlotModal(event)">
      <div class="receipt-modal" style="width:min(460px,calc(100vw - 24px));" onclick="event.stopPropagation()">
        <div class="receipt-modal-header">
          <div class="card-icon" style="background:var(--green-light);width:32px;height:32px;"><i class="bi bi-egg-fried"></i></div>
          <div>
            <div style="font-size:13px;font-weight:700;color:var(--ink);" id="slot-modal-title">Assign Meal</div>
            <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);" id="slot-modal-sub">Monday Â· Breakfast</div>
          </div>
          <button class="receipt-modal-close" onclick="closeMealSlotModalBtn()"><i class="bi bi-x-lg"></i></button>
        </div>
        <div style="padding:14px 20px;">
          <input class="task-input" id="meal-slot-search" placeholder="Search recipes or type a meal name..." oninput="filterSlotRecipes(this.value)" style="margin-bottom:12px;width:100%;">
          <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:8px;">YOUR RECIPES</div>
          <div id="slot-recipe-list" style="max-height:220px;overflow-y:auto;display:flex;flex-direction:column;gap:6px;"></div>
          <div style="border-top:1px solid var(--border);margin:12px 0;"></div>
          <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:8px;">OR QUICK-ADD</div>
          <div style="display:flex;gap:8px;">
            <input class="task-input" id="quick-meal-name" placeholder="Meal name..." style="flex:1;">
            <input class="task-input" id="quick-meal-kcal" placeholder="kcal" style="width:72px;">
          </div>
          <div style="display:flex;gap:8px;margin-top:10px;">
            <button class="btn btn-primary" style="flex:1;" onclick="assignQuickMeal()">Assign Meal</button>
            <button class="btn btn-ghost" onclick="clearMealSlot()">Clear Slot</button>
          </div>
        </div>
      </div>
    </div>

    <!-- RECIPE EDITOR MODAL -->
    <div class="modal-overlay" id="recipe-editor-modal" onclick="closeRecipeEditorOverlay(event)">
      <div class="receipt-modal" style="width:min(540px,calc(100vw - 24px));max-height:90vh;" onclick="event.stopPropagation()">
        <div class="receipt-modal-header">
          <div class="card-icon" style="background:var(--amber-light);width:32px;height:32px;"><i class="bi bi-pencil-square"></i></div>
          <div>
            <div style="font-size:13px;font-weight:700;color:var(--ink);" id="recipe-editor-title">New Recipe</div>
            <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">Fill in the details below</div>
          </div>
          <button class="receipt-modal-close" onclick="closeRecipeEditor()"><i class="bi bi-x-lg"></i></button>
        </div>
        <div style="padding:16px 20px;overflow-y:auto;max-height:calc(90vh - 120px);">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
            <div class="date-field" style="grid-column:1/-1;">
              <label>Recipe Name</label>
              <input class="task-input" id="re-name" placeholder="e.g. Garlic Egg Fried Rice" style="width:100%;">
            </div>
            <div class="date-field">
              <label>Emoji</label>
              <input class="task-input" id="re-emoji" placeholder="ðŸœ" style="width:100%;font-size:20px;text-align:center;" maxlength="4">
            </div>
            <div class="date-field">
              <label>Calories (est.)</label>
              <input class="task-input" id="re-kcal" placeholder="520" type="number" style="width:100%;">
            </div>
            <div class="date-field">
              <label>Prep Time</label>
              <input class="task-input" id="re-prep" placeholder="15 mins" style="width:100%;">
            </div>
            <div class="date-field">
              <label>Category</label>
              <select class="task-input" id="re-category" style="width:100%;">
                <option>Breakfast</option>
                <option>Lunch</option>
                <option>Dinner</option>
                <option>Snack</option>
                <option>Any</option>
              </select>
            </div>
          </div>
          <div class="date-field" style="margin-bottom:12px;">
            <label>Ingredients (one per line)</label>
            <textarea id="re-ingredients" class="task-input" rows="5" placeholder="2 eggs&#10;150g rice&#10;2 cloves garlic&#10;1 tbsp olive oil" style="width:100%;resize:vertical;font-family:'DM Mono',monospace;font-size:11px;"></textarea>
          </div>
          <div class="date-field" style="margin-bottom:16px;">
            <label>Method / Instructions</label>
            <textarea id="re-method" class="task-input" rows="6" placeholder="1. Cook rice and let cool.&#10;2. Heat oil in wok over high heat.&#10;3. Fry garlic until golden.&#10;4. Add rice and eggs, stir-fry 3 mins." style="width:100%;resize:vertical;font-family:'DM Mono',monospace;font-size:11px;"></textarea>
          </div>
          <div style="display:flex;gap:8px;">
            <button class="btn btn-primary" style="flex:1;" onclick="saveRecipe()">Save Recipe</button>
            <button class="btn btn-ghost" id="recipe-delete-btn" onclick="deleteRecipe()" style="display:none;color:var(--red);border-color:var(--red);">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <!-- TRIPS VIEW -->
    <div class="content" id="view-trips">
      <div class="card" style="margin-bottom:16px;">
        <div class="card-header">
          <div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-globe2"></i></div>
          <div>
            <div class="card-title">Suggested Destinations</div>
            <div class="card-sub">Based on your taste profile & interests</div>
          </div>
          <button class="btn btn-primary" style="margin-left:auto;" onclick="openTripPlanner()">Plan New Trip</button>
        </div>
        <div class="card-body">
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
            <div class="trip-card" style="margin-bottom:0;"><div class="trip-img">ðŸ—¼</div><div class="trip-info"><div class="trip-name">Paris, France</div><div class="trip-dates">Suggested Â· Based on your travel profile</div></div></div>
            <div class="trip-card" style="margin-bottom:0;"><div class="trip-img">ðŸ—¾</div><div class="trip-info"><div class="trip-name">Tokyo, Japan</div><div class="trip-dates">Suggested Â· Asian cuisine interest</div></div></div>
            <div class="trip-card" style="margin-bottom:0;cursor:pointer;" onclick="openTripPlanner()">
              <div class="trip-img">ðŸŒ†</div>
              <div class="trip-info">
                <div class="trip-name">New York, USA</div>
                <div class="trip-dates" style="color:#2c4a7c;font-weight:700;">âœ¦ Click to plan this trip</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-airplane-fill"></i></div>
          <div>
            <div class="card-title">Upcoming â€” Glastonbury 2026</div>
            <div class="card-sub">25â€“29 June 2026 Â· Somerset, UK</div>
          </div>
        </div>
        <div class="card-body">
          <div class="event-item"><div class="event-time-col"><div class="event-time">25 Jun</div><div class="event-bar" style="background:#3b82f6;"></div></div><div class="event-info"><div class="event-name">Depart â€” LNER London to Somerset</div><div class="event-detail">08:45 Â· Kings Cross Â· Booked</div></div></div>
          <div class="event-item"><div class="event-time-col"><div class="event-time">25 Jun</div><div class="event-bar" style="background:#10b981;"></div></div><div class="event-info"><div class="event-name">Check in â€” Worthy Farm Camping</div><div class="event-detail">From 12:00 Â· GA Ticket in Wallet</div></div></div>
          <div class="event-item"><div class="event-time-col"><div class="event-time">29 Jun</div><div class="event-bar" style="background:#f59e0b;"></div></div><div class="event-info"><div class="event-name">Depart â€” Return to London</div><div class="event-detail">16:00 Â· Castle Cary station</div></div></div>
        </div>
      </div>
    </div>

    <!-- PARCELS VIEW -->
    <div class="content" id="view-parcels">
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:var(--amber-light);"><i class="bi bi-truck"></i></div>
          <div>
            <div class="card-title">Parcel Tracking</div>
            <div class="card-sub">Auto-detected from emails Â· AfterShip</div>
          </div>
          <button class="btn btn-primary" style="margin-left:auto;" onclick="showToast('ðŸ“¦ Enter tracking number')">Add Tracking</button>
        </div>
        <div class="card-body">
          <div class="parcel-item"><div class="parcel-icon">ðŸ“¦</div><div class="parcel-info"><div class="parcel-name">ASOS Order #28291 â€” Clothing</div><div class="parcel-courier">Evri Â· EVR-28291-UK Â· Est. today by 6PM</div></div><div class="status-pill status-transit">Out for delivery</div></div>
          <div class="parcel-item"><div class="parcel-icon">ðŸ“¦</div><div class="parcel-info"><div class="parcel-name">Amazon â€” GPU Power Cable</div><div class="parcel-courier">Royal Mail Â· RM-774821-GB Â· Est. Mon 2 Mar</div></div><div class="status-pill status-processing">In transit</div></div>
        </div>
      </div>
    </div>

    <!-- CALENDAR VIEW -->
    <div class="content" id="view-calendar">
      <div style="display:grid; grid-template-columns:1fr 1.4fr; gap:16px;">
        <div class="card">
          <div class="card-header"><div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-calendar3"></i></div><div><div class="card-title">February 2026</div></div></div>
          <div class="card-body">
            <div class="calendar-grid">
              <div class="cal-day-label">M</div><div class="cal-day-label">T</div><div class="cal-day-label">W</div><div class="cal-day-label">T</div><div class="cal-day-label">F</div><div class="cal-day-label">S</div><div class="cal-day-label">S</div>
              <div class="cal-day other-month">27</div><div class="cal-day other-month">28</div><div class="cal-day other-month">29</div><div class="cal-day other-month">30</div><div class="cal-day other-month">31</div><div class="cal-day">1</div><div class="cal-day">2</div>
              <div class="cal-day">3</div><div class="cal-day">4</div><div class="cal-day has-event">5</div><div class="cal-day">6</div><div class="cal-day">7</div><div class="cal-day">8</div><div class="cal-day">9</div>
              <div class="cal-day">10</div><div class="cal-day has-event">11</div><div class="cal-day">12</div><div class="cal-day">13</div><div class="cal-day">14</div><div class="cal-day">15</div><div class="cal-day">16</div>
              <div class="cal-day">17</div><div class="cal-day">18</div><div class="cal-day">19</div><div class="cal-day">20</div><div class="cal-day">21</div><div class="cal-day">22</div><div class="cal-day">23</div>
              <div class="cal-day">24</div><div class="cal-day">25</div><div class="cal-day">26</div><div class="cal-day">27</div><div class="cal-day today has-event">28</div><div class="cal-day other-month">1</div><div class="cal-day other-month">2</div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-icon" style="background:var(--purple-light);"><i class="bi bi-calendar-event-fill"></i></div><div><div class="card-title">Upcoming Events</div><div class="card-sub">From emails, calls & manual</div></div></div>
          <div class="card-body">
            <div class="event-item"><div class="event-time-col"><div class="event-time">Today</div><div class="event-bar" style="background:#2c4a7c;"></div></div><div class="event-info"><div class="event-name">ASOS Delivery Expected</div><div class="event-detail">Evri Â· by 6PM Â· No action needed</div></div></div>
            <div class="event-item"><div class="event-time-col"><div class="event-time">Mon 2</div><div class="event-bar" style="background:#7c3aed;"></div></div><div class="event-info"><div class="event-name">GP Appointment â€” Dr. Smith</div><div class="event-detail">10:30 AM Â· Booked from voicemail</div></div></div>
            <div class="event-item"><div class="event-time-col"><div class="event-time">15 Mar</div><div class="event-bar" style="background:#0284c7;"></div></div><div class="event-info"><div class="event-name">LNER â€” London to Somerset</div><div class="event-detail">08:45 Â· Ticket in Wallet</div></div></div>
            <div class="event-item"><div class="event-time-col"><div class="event-time">25 Jun</div><div class="event-bar" style="background:#10b981;"></div></div><div class="event-info"><div class="event-name">Glastonbury Festival 2026</div><div class="event-detail">Worthy Farm Â· Ticket in Wallet Â· 5 days</div></div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- TASTE PROFILE VIEW -->
    <div class="content" id="view-profile">
      <!-- Sub-tab nav -->
      <div class="profile-subtabs">
        <button class="meal-tab active" onclick="switchProfileTab('interests', this)"><i class="bi bi-stars" style="margin-right:5px;"></i>Interests</button>
        <button class="meal-tab" onclick="switchProfileTab('hobbies', this)"><i class="bi bi-controller" style="margin-right:5px;"></i>Hobbies</button>
        <button class="meal-tab" onclick="switchProfileTab('food', this)"><i class="bi bi-cup-hot-fill" style="margin-right:5px;"></i>Food & Taste</button>
      </div>

      <!-- INTERESTS PANEL -->
      <div id="ptab-interests" class="profile-tab-panel active">
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-stars"></i></div>
            <div>
              <div class="card-title">Your Interests</div>
              <div class="card-sub">Click to toggle Â· ANN uses these to personalise suggestions</div>
            </div>
            <button class="btn btn-ghost" style="margin-left:auto; font-size:11px; padding:6px 12px;" onclick="addTag()">+ Add</button>
          </div>
          <div class="card-body">
            <div class="profile-section-label">Active Interests</div>
            <div class="profile-tags" id="profile-tags" style="margin-bottom:16px;">
              <span class="profile-tag tag-active" onclick="toggleTag(this)">ðŸ“ˆ Stocks & Trading</span>
              <span class="profile-tag tag-active" onclick="toggleTag(this)">ðŸ’» Software Dev</span>
              <span class="profile-tag tag-active" onclick="toggleTag(this)">âœˆï¸ Travel</span>
              <span class="profile-tag tag-active" onclick="toggleTag(this)">ðŸ’° Finance</span>
              <span class="profile-tag tag-active" onclick="toggleTag(this)">ðŸ‹ï¸ Fitness</span>
              <span class="profile-tag tag-inactive" onclick="toggleTag(this)">ðŸŽµ Music</span>
              <span class="profile-tag tag-inactive" onclick="toggleTag(this)">ðŸ“¸ Photography</span>
              <span class="profile-tag tag-inactive" onclick="toggleTag(this)">ðŸŽ® Gaming</span>
              <span class="profile-tag tag-active" onclick="toggleTag(this)">ðŸ“š Finance Books</span>
              <span class="profile-tag tag-active" onclick="toggleTag(this)">ðŸŒ World Affairs</span>
              <span class="profile-tag tag-add" onclick="addTag()">+ Add</span>
            </div>
            <div class="profile-section-label">ANN Personalisation</div>
            <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;">
              <div style="padding:12px;background:var(--blue-light);border-radius:10px;border:1px solid rgba(44,74,124,0.15);">
                <div style="font-size:10px;font-family:'DM Mono',monospace;color:#1a3260;letter-spacing:1px;margin-bottom:4px;">FINANCE ALERTS</div>
                <div style="font-size:12px;color:#1a3260;">Stock market summaries, budgeting tips, HMRC updates</div>
              </div>
              <div style="padding:12px;background:var(--green-light);border-radius:10px;border:1px solid rgba(22,101,52,0.15);">
                <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--green);letter-spacing:1px;margin-bottom:4px;">TRIP SUGGESTIONS</div>
                <div style="font-size:12px;color:var(--green);">Destinations based on travel & food preferences</div>
              </div>
              <div style="padding:12px;background:var(--amber-light);border-radius:10px;border:1px solid rgba(146,64,14,0.15);">
                <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--amber);letter-spacing:1px;margin-bottom:4px;">MEAL IDEAS</div>
                <div style="font-size:12px;color:var(--amber);">Recipe suggestions matched to your taste preferences</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- HOBBIES PANEL -->
      <div id="ptab-hobbies" class="profile-tab-panel">
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background:var(--purple-light);"><i class="bi bi-controller"></i></div>
            <div>
              <div class="card-title">Hobbies & Activities</div>
              <div class="card-sub">Track how you spend your time</div>
            </div>
          </div>
          <div class="card-body">
            <div class="profile-section-label">Active Hobbies</div>
            <div class="hobby-grid" style="margin-bottom:20px;">
              <div class="hobby-item active" onclick="this.classList.toggle('active')">
                <span class="hobby-icon">ðŸ‹ï¸</span>
                <div><div class="hobby-name">Gym / Fitness</div><div class="hobby-freq">4x per week</div></div>
              </div>
              <div class="hobby-item active" onclick="this.classList.toggle('active')">
                <span class="hobby-icon">ðŸ’»</span>
                <div><div class="hobby-name">Coding</div><div class="hobby-freq">Daily</div></div>
              </div>
              <div class="hobby-item active" onclick="this.classList.toggle('active')">
                <span class="hobby-icon">ðŸ“š</span>
                <div><div class="hobby-name">Reading</div><div class="hobby-freq">Evenings</div></div>
              </div>
              <div class="hobby-item" onclick="this.classList.toggle('active')">
                <span class="hobby-icon">ðŸŽ®</span>
                <div><div class="hobby-name">Gaming</div><div class="hobby-freq">Weekends</div></div>
              </div>
              <div class="hobby-item active" onclick="this.classList.toggle('active')">
                <span class="hobby-icon">â˜•</span>
                <div><div class="hobby-name">Coffee Culture</div><div class="hobby-freq">Daily</div></div>
              </div>
              <div class="hobby-item" onclick="this.classList.toggle('active')">
                <span class="hobby-icon">ðŸŽµ</span>
                <div><div class="hobby-name">Music</div><div class="hobby-freq">Occasional</div></div>
              </div>
              <div class="hobby-item active" onclick="this.classList.toggle('active')">
                <span class="hobby-icon">âœˆï¸</span>
                <div><div class="hobby-name">Travel</div><div class="hobby-freq">Monthly</div></div>
              </div>
              <div class="hobby-item" onclick="this.classList.toggle('active')">
                <span class="hobby-icon">ðŸ§—</span>
                <div><div class="hobby-name">Climbing</div><div class="hobby-freq">Occasional</div></div>
              </div>
            </div>
            <div class="profile-section-label">Upcoming Hobby Events</div>
            <div class="event-item"><div class="event-time-col"><div class="event-time">25 Jun</div><div class="event-bar" style="background:#10b981;"></div></div><div class="event-info"><div class="event-name">Glastonbury Festival</div><div class="event-detail">Music Â· 5 days Â· Ticket in Wallet</div></div></div>
          </div>
        </div>
      </div>

      <!-- FOOD & TASTE PANEL -->
      <div id="ptab-food" class="profile-tab-panel">
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px;">
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background:var(--amber-light);"><i class="bi bi-cup-hot-fill"></i></div>
              <div>
                <div class="card-title">Cuisine Preferences</div>
                <div class="card-sub">Used for meal planning & restaurant suggestions</div>
              </div>
            </div>
            <div class="card-body">
              <div class="food-pref-grid">
                <div class="food-pref-item selected" onclick="this.classList.toggle('selected')">
                  <span class="food-pref-icon">ðŸœ</span>
                  <div><div class="food-pref-name">Asian</div><div class="food-pref-sub">Favourite</div></div>
                </div>
                <div class="food-pref-item selected" onclick="this.classList.toggle('selected')">
                  <span class="food-pref-icon">ðŸ•</span>
                  <div><div class="food-pref-name">Italian</div><div class="food-pref-sub">Weekly</div></div>
                </div>
                <div class="food-pref-item selected" onclick="this.classList.toggle('selected')">
                  <span class="food-pref-icon">ðŸŒ®</span>
                  <div><div class="food-pref-name">Mexican</div><div class="food-pref-sub">Monthly</div></div>
                </div>
                <div class="food-pref-item" onclick="this.classList.toggle('selected')">
                  <span class="food-pref-icon">ðŸ¥˜</span>
                  <div><div class="food-pref-name">Mediterranean</div><div class="food-pref-sub">Occasional</div></div>
                </div>
                <div class="food-pref-item selected" onclick="this.classList.toggle('selected')">
                  <span class="food-pref-icon">ðŸ±</span>
                  <div><div class="food-pref-name">Japanese</div><div class="food-pref-sub">Favourite</div></div>
                </div>
                <div class="food-pref-item" onclick="this.classList.toggle('selected')">
                  <span class="food-pref-icon">ðŸ«•</span>
                  <div><div class="food-pref-name">Indian</div><div class="food-pref-sub">Monthly</div></div>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background:var(--green-light);"><i class="bi bi-heart-fill"></i></div>
              <div>
                <div class="card-title">Dietary Preferences</div>
                <div class="card-sub">Affects meal planning & shopping lists</div>
              </div>
            </div>
            <div class="card-body">
              <div class="profile-section-label">Dietary Tags</div>
              <div class="profile-tags" style="margin-bottom:16px;">
                <span class="profile-tag tag-active" onclick="toggleTag(this)">High Protein</span>
                <span class="profile-tag tag-active" onclick="toggleTag(this)">Low Carb</span>
                <span class="profile-tag tag-inactive" onclick="toggleTag(this)">Vegetarian</span>
                <span class="profile-tag tag-inactive" onclick="toggleTag(this)">Vegan</span>
                <span class="profile-tag tag-active" onclick="toggleTag(this)">Gluten-free options</span>
                <span class="profile-tag tag-inactive" onclick="toggleTag(this)">Dairy-free</span>
                <span class="profile-tag tag-add" onclick="addTag()">+ Add</span>
              </div>
              <div class="profile-section-label">Allergies & Avoidances</div>
              <div style="padding:10px 12px;background:var(--red-light);border-radius:8px;border-left:3px solid var(--red);">
                <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--red);letter-spacing:1px;margin-bottom:4px;"><i class="bi bi-exclamation-triangle-fill" style="margin-right:4px;"></i>NONE RECORDED</div>
                <div style="font-size:12px;color:var(--red);">Add any allergies or foods to avoid</div>
              </div>
            </div>
          </div>
          <div class="card" style="grid-column:1/-1;">
            <div class="card-header">
              <div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-bar-chart-fill"></i></div>
              <div>
                <div class="card-title">Top Foods This Month</div>
                <div class="card-sub">From Tesco receipts & meal planner</div>
              </div>
            </div>
            <div class="card-body">
              <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px;">
                <div style="padding:10px;background:var(--surface2);border-radius:8px;text-align:center;">
                  <div style="font-size:24px;margin-bottom:4px;">ðŸ¥š</div>
                  <div style="font-size:11px;font-weight:700;color:var(--ink);">Eggs</div>
                  <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);">12 this month</div>
                </div>
                <div style="padding:10px;background:var(--surface2);border-radius:8px;text-align:center;">
                  <div style="font-size:24px;margin-bottom:4px;">ðŸš</div>
                  <div style="font-size:11px;font-weight:700;color:var(--ink);">Rice</div>
                  <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);">4 packs</div>
                </div>
                <div style="padding:10px;background:var(--surface2);border-radius:8px;text-align:center;">
                  <div style="font-size:24px;margin-bottom:4px;">â˜•</div>
                  <div style="font-size:11px;font-weight:700;color:var(--ink);">Coffee</div>
                  <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);">500g beans</div>
                </div>
                <div style="padding:10px;background:var(--surface2);border-radius:8px;text-align:center;">
                  <div style="font-size:24px;margin-bottom:4px;">ðŸ—</div>
                  <div style="font-size:11px;font-weight:700;color:var(--ink);">Chicken</div>
                  <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);">3 packs</div>
                </div>
                <div style="padding:10px;background:var(--surface2);border-radius:8px;text-align:center;">
                  <div style="font-size:24px;margin-bottom:4px;">ðŸ¥‘</div>
                  <div style="font-size:11px;font-weight:700;color:var(--ink);">Avocado</div>
                  <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);">8 this month</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- CHAT VIEW -->
    <div class="content" id="view-chat">
      <div class="chat-layout" id="chat-layout">

        <!-- Conversation sidebar -->
        <div class="chat-sidebar">
          <div class="chat-sidebar-header">
            <input class="chat-search" type="text" placeholder="Search conversationsâ€¦" oninput="filterChats(this.value)">
            <div class="chat-tabs">
              <button class="chat-tab-btn active" onclick="filterChatTab('all', this)">All</button>
              <button class="chat-tab-btn" onclick="filterChatTab('groups', this)">Groups</button>
              <button class="chat-tab-btn" onclick="filterChatTab('dms', this)">DMs</button>
            </div>
          </div>
          <div class="conv-list" id="conv-list">
            <!-- Group: Work Team -->
            <div class="conv-item active" data-chat="work-team" data-type="group" onclick="selectChat('work-team', this)">
              <div class="conv-avatar group"><i class="bi bi-people-fill" style="font-size:16px;"></i></div>
              <div class="conv-meta">
                <div class="conv-name">Work Team</div>
                <div class="conv-preview">James: Team lunch confirmed for Friday!</div>
              </div>
              <div class="conv-time">12:41</div>
              <div class="conv-badge">3</div>
            </div>
            <!-- Group: Glastonbury 2026 -->
            <div class="conv-item" data-chat="glastonbury" data-type="group" onclick="selectChat('glastonbury', this)">
              <div class="conv-avatar group" style="background:var(--purple-light);color:#7c3aed;"><i class="bi bi-music-note-beamed" style="font-size:16px;"></i></div>
              <div class="conv-meta">
                <div class="conv-name">Glastonbury 2026 ðŸŽª</div>
                <div class="conv-preview">You: Anyone want to carpool from London?</div>
              </div>
              <div class="conv-time">10:15</div>
            </div>
            <!-- DM: Sarah Mitchell -->
            <div class="conv-item" data-chat="sarah" data-type="dm" onclick="selectChat('sarah', this)">
              <div class="conv-avatar" style="background:var(--pink-light, #fce7f3);color:#be185d;">SM</div>
              <div class="conv-meta">
                <div class="conv-name">Sarah Mitchell</div>
                <div class="conv-preview">See you tomorrow at 9!</div>
              </div>
              <div class="conv-time">09:53</div>
            </div>
            <!-- DM: James K. -->
            <div class="conv-item" data-chat="james" data-type="dm" onclick="selectChat('james', this)">
              <div class="conv-avatar" style="background:var(--green-light);color:var(--green);">JK</div>
              <div class="conv-meta">
                <div class="conv-name">James K.</div>
                <div class="conv-preview">Did you get a chance to look at the brief?</div>
              </div>
              <div class="conv-time">Fri</div>
            </div>
            <!-- DM: Rachel T. -->
            <div class="conv-item" data-chat="rachel" data-type="dm" onclick="selectChat('rachel', this)">
              <div class="conv-avatar" style="background:var(--amber-light);color:var(--amber);">RT</div>
              <div class="conv-meta">
                <div class="conv-name">Rachel T.</div>
                <div class="conv-preview">The Figma file is ready to review</div>
              </div>
              <div class="conv-time">Thu</div>
            </div>
          </div>
        </div>

        <!-- Active chat: Work Team (shown by default) -->
        <div class="chat-main" id="chat-main-work-team">
          <div class="chat-header">
            <div class="chat-header-avatar group"><i class="bi bi-people-fill"></i></div>
            <div class="chat-header-info">
              <div class="chat-header-name">Work Team</div>
              <div class="chat-header-sub">Microsoft Teams Â· 6 members Â· James K., Sarah M., Rachel T. +3</div>
            </div>
            <div class="chat-header-actions">
              <div class="chat-hdr-btn" title="Search"><i class="bi bi-search"></i></div>
              <div class="chat-hdr-btn" title="Video call"><i class="bi bi-camera-video"></i></div>
            </div>
          </div>
          <div class="chat-messages">
            <div class="chat-date-sep">Monday, 2 March 2026</div>

            <!-- James -->
            <div class="chat-bubble-row">
              <div class="msg-avatar">JK</div>
              <div>
                <div class="bubble-sender">James K.</div>
                <div class="chat-bubble other">Morning everyone â€” quick update on the Q1 deck. I've added the new slides. Can someone proof before EOD?</div>
                <div class="bubble-time">09:14</div>
              </div>
            </div>

            <!-- Rachel -->
            <div class="chat-bubble-row">
              <div class="msg-avatar" style="background:var(--amber-light);color:var(--amber);">RT</div>
              <div>
                <div class="bubble-sender">Rachel T.</div>
                <div class="chat-bubble other">On it! Will send feedback by 3pm.</div>
                <div class="bubble-time">09:21</div>
              </div>
            </div>

            <!-- Own -->
            <div class="chat-bubble-row own">
              <div>
                <div class="chat-bubble own">Looks great James. Slide 8 might need a chart update with the latest numbers â€” I'll do that now.</div>
                <div class="bubble-time">09:34</div>
              </div>
            </div>

            <!-- ANN Summary Card â€” calendar detection -->
            <div class="chat-ann-card" id="ann-lunch-card">
              <div class="chat-ann-icon"><i class="bi bi-stars"></i></div>
              <div class="chat-ann-body">
                <div class="chat-ann-label">ANN detected an event</div>
                <div class="chat-ann-text">James mentioned a <strong>team lunch on Friday 6 March, 12:30 at Carluccio's</strong>. Would you like to add this to your calendar?</div>
                <div class="chat-ann-actions">
                  <button class="chat-ann-btn" id="ann-add-cal-btn" onclick="addChatEventToCalendar()">
                    <i class="bi bi-calendar-plus"></i> Add to Calendar
                  </button>
                  <button class="chat-ann-dismiss" onclick="this.closest('.chat-ann-card').style.display='none'">Dismiss</button>
                </div>
              </div>
            </div>

            <!-- James follow-up -->
            <div class="chat-bubble-row">
              <div class="msg-avatar">JK</div>
              <div>
                <div class="bubble-sender">James K.</div>
                <div class="chat-bubble other">Also â€” team lunch confirmed for <strong>Friday 6 March, 12:30 at Carluccio's</strong>. Everyone in? ðŸ</div>
                <div class="bubble-time">12:41</div>
              </div>
            </div>

            <!-- Sarah -->
            <div class="chat-bubble-row">
              <div class="msg-avatar" style="background:var(--pink-light,#fce7f3);color:#be185d;">SM</div>
              <div>
                <div class="bubble-sender">Sarah M.</div>
                <div class="chat-bubble other">I'm in! ðŸ™‹</div>
                <div class="bubble-time">12:43</div>
              </div>
            </div>

            <!-- Own reply -->
            <div class="chat-bubble-row own">
              <div>
                <div class="chat-bubble own">Count me in too!</div>
                <div class="bubble-time">12:45</div>
              </div>
            </div>
          </div>
          <div class="chat-input-bar">
            <input class="chat-input" id="chat-input-work-team" placeholder="Message Work Teamâ€¦" onkeydown="if(event.key==='Enter')sendMainChat('work-team')">
            <button class="chat-send-btn" onclick="sendMainChat('work-team')"><i class="bi bi-arrow-up"></i></button>
          </div>
        </div>

        <!-- Active chat: Glastonbury -->
        <div class="chat-main" id="chat-main-glastonbury" style="display:none;">
          <div class="chat-header">
            <div class="chat-header-avatar group" style="background:var(--purple-light);color:#7c3aed;"><i class="bi bi-music-note-beamed"></i></div>
            <div class="chat-header-info">
              <div class="chat-header-name">Glastonbury 2026 ðŸŽª</div>
              <div class="chat-header-sub">WhatsApp Â· 8 members</div>
            </div>
            <div class="chat-header-actions">
              <div class="chat-hdr-btn"><i class="bi bi-search"></i></div>
              <div class="chat-hdr-btn"><i class="bi bi-telephone"></i></div>
            </div>
          </div>
          <div class="chat-messages">
            <div class="chat-date-sep">Friday, 27 February 2026</div>
            <div class="chat-bubble-row">
              <div class="msg-avatar" style="background:var(--purple-light);color:#7c3aed;">LK</div>
              <div>
                <div class="bubble-sender">Liam K.</div>
                <div class="chat-bubble other">Tickets arrived in the post today! Who's camping Wednesday night?</div>
                <div class="bubble-time">18:02</div>
              </div>
            </div>
            <div class="chat-bubble-row own">
              <div>
                <div class="chat-bubble own">Wednesday for me! Anyone want to carpool from London?</div>
                <div class="bubble-time">18:15</div>
              </div>
            </div>
            <div class="chat-bubble-row">
              <div class="msg-avatar" style="background:var(--pink-light,#fce7f3);color:#be185d;">SM</div>
              <div>
                <div class="bubble-sender">Sarah M.</div>
                <div class="chat-bubble other">Yes please! Pick me up from Waterloo?</div>
                <div class="bubble-time">18:20</div>
              </div>
            </div>
            <div class="chat-bubble-row own">
              <div>
                <div class="chat-bubble own">Done âœ…</div>
                <div class="bubble-time">18:21</div>
              </div>
            </div>
          </div>
          <div class="chat-input-bar">
            <input class="chat-input" id="chat-input-glastonbury" placeholder="Message Glastonbury 2026 ðŸŽªâ€¦" onkeydown="if(event.key==='Enter')sendMainChat('glastonbury')">
            <button class="chat-send-btn" onclick="sendMainChat('glastonbury')"><i class="bi bi-arrow-up"></i></button>
          </div>
        </div>

        <!-- Active chat: Sarah Mitchell (DM) -->
        <div class="chat-main" id="chat-main-sarah" style="display:none;">
          <div class="chat-header">
            <div class="chat-header-avatar" style="background:var(--pink-light,#fce7f3);color:#be185d;">SM</div>
            <div class="chat-header-info">
              <div class="chat-header-name">Sarah Mitchell</div>
              <div class="chat-header-sub">Direct message Â· iMessage</div>
            </div>
            <div class="chat-header-actions">
              <div class="chat-hdr-btn"><i class="bi bi-telephone"></i></div>
              <div class="chat-hdr-btn"><i class="bi bi-camera-video"></i></div>
            </div>
          </div>
          <div class="chat-messages">
            <div class="chat-date-sep">Sunday, 1 March 2026</div>
            <div class="chat-bubble-row">
              <div class="msg-avatar" style="background:var(--pink-light,#fce7f3);color:#be185d;">SM</div>
              <div>
                <div class="chat-bubble other">Hey! Are we still on for the client call tomorrow at 9?</div>
                <div class="bubble-time">09:45</div>
              </div>
            </div>
            <div class="chat-bubble-row own">
              <div>
                <div class="chat-bubble own">Yes, I've got it in my calendar. I'll send the Zoom link in the morning.</div>
                <div class="bubble-time">09:50</div>
              </div>
            </div>
            <div class="chat-bubble-row">
              <div class="msg-avatar" style="background:var(--pink-light,#fce7f3);color:#be185d;">SM</div>
              <div>
                <div class="chat-bubble other">Perfect. See you tomorrow at 9! ðŸ‘</div>
                <div class="bubble-time">09:53</div>
              </div>
            </div>
          </div>
          <div class="chat-input-bar">
            <input class="chat-input" id="chat-input-sarah" placeholder="Message Sarah Mitchellâ€¦" onkeydown="if(event.key==='Enter')sendMainChat('sarah')">
            <button class="chat-send-btn" onclick="sendMainChat('sarah')"><i class="bi bi-arrow-up"></i></button>
          </div>
        </div>

        <!-- Active chat: James K. (DM) -->
        <div class="chat-main" id="chat-main-james" style="display:none;">
          <div class="chat-header">
            <div class="chat-header-avatar" style="background:var(--green-light);color:var(--green);">JK</div>
            <div class="chat-header-info">
              <div class="chat-header-name">James K.</div>
              <div class="chat-header-sub">Direct message Â· Slack</div>
            </div>
            <div class="chat-header-actions">
              <div class="chat-hdr-btn"><i class="bi bi-telephone"></i></div>
              <div class="chat-hdr-btn"><i class="bi bi-camera-video"></i></div>
            </div>
          </div>
          <div class="chat-messages">
            <div class="chat-date-sep">Friday, 27 February 2026</div>
            <div class="chat-bubble-row">
              <div class="msg-avatar" style="background:var(--green-light);color:var(--green);">JK</div>
              <div>
                <div class="chat-bubble other">Hey, did you get a chance to look at the project brief I sent over?</div>
                <div class="bubble-time">14:10</div>
              </div>
            </div>
            <div class="chat-bubble-row own">
              <div>
                <div class="chat-bubble own">Just reading through it now â€” looks solid. I have a couple of questions on scope, will send them over shortly.</div>
                <div class="bubble-time">14:22</div>
              </div>
            </div>
          </div>
          <div class="chat-input-bar">
            <input class="chat-input" id="chat-input-james" placeholder="Message James K.â€¦" onkeydown="if(event.key==='Enter')sendMainChat('james')">
            <button class="chat-send-btn" onclick="sendMainChat('james')"><i class="bi bi-arrow-up"></i></button>
          </div>
        </div>

        <!-- Active chat: Rachel T. (DM) -->
        <div class="chat-main" id="chat-main-rachel" style="display:none;">
          <div class="chat-header">
            <div class="chat-header-avatar" style="background:var(--amber-light);color:var(--amber);">RT</div>
            <div class="chat-header-info">
              <div class="chat-header-name">Rachel T.</div>
              <div class="chat-header-sub">Direct message Â· Slack</div>
            </div>
            <div class="chat-header-actions">
              <div class="chat-hdr-btn"><i class="bi bi-telephone"></i></div>
              <div class="chat-hdr-btn"><i class="bi bi-camera-video"></i></div>
            </div>
          </div>
          <div class="chat-messages">
            <div class="chat-date-sep">Thursday, 26 February 2026</div>
            <div class="chat-bubble-row">
              <div class="msg-avatar" style="background:var(--amber-light);color:var(--amber);">RT</div>
              <div>
                <div class="chat-bubble other">The Figma file is ready to review â€” I've left comments on the tricky sections. Let me know what you think!</div>
                <div class="bubble-time">16:45</div>
              </div>
            </div>
            <div class="chat-bubble-row own">
              <div>
                <div class="chat-bubble own">Will look at it first thing tomorrow, thanks Rachel!</div>
                <div class="bubble-time">16:58</div>
              </div>
            </div>
          </div>
          <div class="chat-input-bar">
            <input class="chat-input" id="chat-input-rachel" placeholder="Message Rachel T.â€¦" onkeydown="if(event.key==='Enter')sendMainChat('rachel')">
            <button class="chat-send-btn" onclick="sendMainChat('rachel')"><i class="bi bi-arrow-up"></i></button>
          </div>
        </div>

      </div>
    </div>

    <!-- HABITS VIEW -->
    <div class="content" id="view-habits">
      <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;">
        <button class="meal-tab active" id="htab-btn-sleep" onclick="switchHabitTab('sleep',this)"><i class="bi bi-moon-fill" style="margin-right:5px;"></i>Sleep</button>
        <button class="meal-tab" id="htab-btn-gym" onclick="switchHabitTab('gym',this)"><i class="bi bi-lightning-fill" style="margin-right:5px;"></i>Gym</button>
        <button class="meal-tab" id="htab-btn-screen" onclick="switchHabitTab('screen',this)"><i class="bi bi-phone-fill" style="margin-right:5px;"></i>Screen Time</button>
      </div>

      <!-- SLEEP PANEL -->
      <div id="htab-sleep" class="profile-tab-panel active">
        <div class="habit-stats-row">
          <div class="habit-stat"><div class="habit-stat-val">7.2<span style="font-size:14px;font-weight:400;">h</span></div><div class="habit-stat-lbl">Weekly Avg</div></div>
          <div class="habit-stat"><div class="habit-stat-val" style="color:var(--green);">9<span style="font-size:14px;font-weight:400;">h</span></div><div class="habit-stat-lbl">Best Night</div></div>
          <div class="habit-stat"><div class="habit-stat-val" style="color:var(--red);">5.5<span style="font-size:14px;font-weight:400;">h</span></div><div class="habit-stat-lbl">Worst Night</div></div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-icon" style="background:var(--purple-light);"><i class="bi bi-moon-fill" style="color:var(--purple);"></i></div><div><div class="card-title">Sleep This Week</div><div class="card-sub">Hours per night Â· Sun 23 Feb â€” Sat 1 Mar</div></div></div>
          <div class="card-body">
            <svg width="100%" height="120" viewBox="0 0 420 120" preserveAspectRatio="none" style="display:block;margin-bottom:8px;">
              <!-- bars: Mon 7h, Tue 6h, Wed 8.5h, Thu 9h, Fri 5.5h, Sat 7.5h, Sun 7h â€” scale 0-10h â†’ 0-100px -->
              <rect x="10" y="30" width="44" height="70" rx="4" fill="#2c4a7c" opacity=".85"/>
              <rect x="70" y="40" width="44" height="60" rx="4" fill="#2c4a7c" opacity=".85"/>
              <rect x="130" y="15" width="44" height="85" rx="4" fill="#2c4a7c" opacity=".85"/>
              <rect x="190" y="10" width="44" height="90" rx="4" fill="#2c4a7c"/>
              <rect x="250" y="45" width="44" height="55" rx="4" fill="#ef4444" opacity=".8"/>
              <rect x="310" y="25" width="44" height="75" rx="4" fill="#2c4a7c" opacity=".85"/>
              <rect x="370" y="30" width="44" height="70" rx="4" fill="#2c4a7c" opacity=".85"/>
              <!-- avg line at 72% -->
              <line x1="0" y1="28" x2="420" y2="28" stroke="#10b981" stroke-width="1.5" stroke-dasharray="6 3"/>
              <!-- labels -->
              <text x="32" y="115" text-anchor="middle" font-size="10" fill="#6b7280" font-family="DM Mono,monospace">Mon</text>
              <text x="92" y="115" text-anchor="middle" font-size="10" fill="#6b7280" font-family="DM Mono,monospace">Tue</text>
              <text x="152" y="115" text-anchor="middle" font-size="10" fill="#6b7280" font-family="DM Mono,monospace">Wed</text>
              <text x="212" y="115" text-anchor="middle" font-size="10" fill="#6b7280" font-family="DM Mono,monospace">Thu</text>
              <text x="272" y="115" text-anchor="middle" font-size="10" fill="#6b7280" font-family="DM Mono,monospace">Fri</text>
              <text x="332" y="115" text-anchor="middle" font-size="10" fill="#6b7280" font-family="DM Mono,monospace">Sat</text>
              <text x="392" y="115" text-anchor="middle" font-size="10" fill="#6b7280" font-family="DM Mono,monospace">Sun</text>
              <text x="4" y="32" font-size="9" fill="#10b981" font-family="DM Mono,monospace">avg 7.2h</text>
              <text x="32" y="26" text-anchor="middle" font-size="9" fill="#1e2a3a" font-family="DM Mono,monospace">7h</text>
              <text x="92" y="36" text-anchor="middle" font-size="9" fill="#1e2a3a" font-family="DM Mono,monospace">6h</text>
              <text x="152" y="11" text-anchor="middle" font-size="9" fill="#1e2a3a" font-family="DM Mono,monospace">8.5h</text>
              <text x="212" y="6" text-anchor="middle" font-size="9" fill="#1e2a3a" font-family="DM Mono,monospace">9h</text>
              <text x="272" y="41" text-anchor="middle" font-size="9" fill="#ef4444" font-family="DM Mono,monospace">5.5h</text>
              <text x="332" y="21" text-anchor="middle" font-size="9" fill="#1e2a3a" font-family="DM Mono,monospace">7.5h</text>
              <text x="392" y="26" text-anchor="middle" font-size="9" fill="#1e2a3a" font-family="DM Mono,monospace">7h</text>
            </svg>
            <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:4px;">
              <input type="number" min="0" max="12" step="0.5" placeholder="e.g. 7.5" class="shop-add-input" style="width:110px;flex:none;" id="sleep-input">
              <span style="font-size:12px;color:var(--ink2);">hours tonight</span>
              <button class="btn btn-primary" style="font-size:12px;padding:7px 16px;" onclick="logSleep()">Log Sleep</button>
            </div>
          </div>
        </div>
      </div>

      <!-- GYM PANEL -->
      <div id="htab-gym" class="profile-tab-panel">
        <div class="habit-stats-row">
          <div class="habit-stat"><div class="habit-stat-val">4</div><div class="habit-stat-lbl">This week</div></div>
          <div class="habit-stat"><div class="habit-stat-val" style="color:var(--green);">14</div><div class="habit-stat-lbl">This month</div></div>
          <div class="habit-stat"><div class="habit-stat-val">ðŸ”¥ 5</div><div class="habit-stat-lbl">Day streak</div></div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-icon" style="background:var(--green-light);"><i class="bi bi-lightning-fill" style="color:var(--green);"></i></div><div><div class="card-title">Gym This Week</div><div class="card-sub">Mon 2 Mar â€” Sun 8 Mar Â· Tap to toggle</div></div></div>
          <div class="card-body">
            <div class="gym-week-grid">
              <div class="gym-day"><div class="gym-day-label">Mon</div><div class="gym-day-dot done" onclick="toggleGymDay(this)"><i class="bi bi-check-lg"></i></div></div>
              <div class="gym-day"><div class="gym-day-label">Tue</div><div class="gym-day-dot rest" onclick="toggleGymDay(this)"><i class="bi bi-dash"></i></div></div>
              <div class="gym-day"><div class="gym-day-label">Wed</div><div class="gym-day-dot done" onclick="toggleGymDay(this)"><i class="bi bi-check-lg"></i></div></div>
              <div class="gym-day"><div class="gym-day-label">Thu</div><div class="gym-day-dot done" onclick="toggleGymDay(this)"><i class="bi bi-check-lg"></i></div></div>
              <div class="gym-day"><div class="gym-day-label">Fri</div><div class="gym-day-dot rest" onclick="toggleGymDay(this)"><i class="bi bi-dash"></i></div></div>
              <div class="gym-day"><div class="gym-day-label">Sat</div><div class="gym-day-dot done" onclick="toggleGymDay(this)"><i class="bi bi-check-lg"></i></div></div>
              <div class="gym-day"><div class="gym-day-label">Sun</div><div class="gym-day-dot rest" onclick="toggleGymDay(this)"><i class="bi bi-dash"></i></div></div>
            </div>
            <button class="btn btn-primary" style="font-size:12px;padding:7px 18px;" onclick="logGym()"><i class="bi bi-plus-lg"></i> Log Today's Session</button>
          </div>
        </div>
      </div>

      <!-- SCREEN TIME PANEL -->
      <div id="htab-screen" class="profile-tab-panel">
        <div class="habit-stats-row">
          <div class="habit-stat"><div class="habit-stat-val">4<span style="font-size:14px;font-weight:400;">h</span> 32<span style="font-size:14px;font-weight:400;">m</span></div><div class="habit-stat-lbl">Today total</div></div>
          <div class="habit-stat"><div class="habit-stat-val">5<span style="font-size:14px;font-weight:400;">h</span> 10<span style="font-size:14px;font-weight:400;">m</span></div><div class="habit-stat-lbl">Yesterday</div></div>
          <div class="habit-stat"><div class="habit-stat-val">4<span style="font-size:14px;font-weight:400;">h</span> 45<span style="font-size:14px;font-weight:400;">m</span></div><div class="habit-stat-lbl">Weekly avg</div></div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-phone-fill" style="color:#2c4a7c;"></i></div><div><div class="card-title">Screen Time Breakdown</div><div class="card-sub">Synced from iPhone Â· Today</div></div></div>
          <div class="card-body">
            <!-- Total bar -->
            <div style="margin-bottom:14px;">
              <div style="display:flex;justify-content:space-between;margin-bottom:5px;"><span style="font-size:11px;font-weight:700;color:var(--ink);">Total</span><span style="font-size:11px;font-family:'DM Mono',monospace;color:var(--ink);">4h 32m</span></div>
              <div class="screen-bar-track" style="height:10px;"><div class="screen-bar-fill" style="width:75%;background:#2c4a7c;"></div></div>
            </div>
            <div class="screen-bar-row"><span class="screen-bar-label"><i class="bi bi-instagram" style="margin-right:5px;color:#e1306c;"></i>Social</span><div class="screen-bar-track"><div class="screen-bar-fill" style="width:58%;background:#e1306c;"></div></div><span class="screen-bar-time">1h 20m</span></div>
            <div class="screen-bar-row"><span class="screen-bar-label"><i class="bi bi-briefcase-fill" style="margin-right:5px;color:#2c4a7c;"></i>Productivity</span><div class="screen-bar-track"><div class="screen-bar-fill" style="width:55%;background:#2c4a7c;"></div></div><span class="screen-bar-time">1h 15m</span></div>
            <div class="screen-bar-row"><span class="screen-bar-label"><i class="bi bi-play-circle-fill" style="margin-right:5px;color:#ef4444;"></i>Entertainment</span><div class="screen-bar-track"><div class="screen-bar-fill" style="width:36%;background:#ef4444;"></div></div><span class="screen-bar-time">58m</span></div>
            <div class="screen-bar-row"><span class="screen-bar-label"><i class="bi bi-grid-fill" style="margin-right:5px;color:var(--ink3);"></i>Other</span><div class="screen-bar-track"><div class="screen-bar-fill" style="width:36%;background:var(--border2);"></div></div><span class="screen-bar-time">59m</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- STOCKS VIEW -->
    <div class="content" id="view-stocks">
      <!-- Watchlist sidebar -->
      <div class="stock-sidebar">
        <div class="stock-sidebar-hdr">Watchlist</div>
        <div class="stock-list">
          <div class="stock-row active" id="srow-aapl" onclick="selectStock('aapl',this)">
            <span class="stock-ticker-badge">AAPL</span>
            <span class="stock-row-name">Apple Inc.</span>
            <span class="stock-row-price">$182.40</span>
            <span class="stock-row-chg up" style="background:var(--green-light);color:var(--green);">+1.2%</span>
          </div>
          <div class="stock-row" id="srow-nvda" onclick="selectStock('nvda',this)">
            <span class="stock-ticker-badge">NVDA</span>
            <span class="stock-row-name">NVIDIA Corp.</span>
            <span class="stock-row-price">$875.10</span>
            <span class="stock-row-chg up" style="background:var(--green-light);color:var(--green);">+3.4%</span>
          </div>
          <div class="stock-row" id="srow-tsla" onclick="selectStock('tsla',this)">
            <span class="stock-ticker-badge">TSLA</span>
            <span class="stock-row-name">Tesla Inc.</span>
            <span class="stock-row-price">$193.57</span>
            <span class="stock-row-chg dn" style="background:var(--red-light);color:var(--red);">âˆ’0.8%</span>
          </div>
          <div class="stock-row" id="srow-meta" onclick="selectStock('meta',this)">
            <span class="stock-ticker-badge">META</span>
            <span class="stock-row-name">Meta Platforms</span>
            <span class="stock-row-price">$493.00</span>
            <span class="stock-row-chg up" style="background:var(--green-light);color:var(--green);">+0.5%</span>
          </div>
        </div>
      </div>
      <!-- Detail panels -->
      <div class="stock-detail" id="sdetail-aapl">
        <div class="stock-hero">
          <div class="stock-hero-name">Apple Inc.</div>
          <div class="stock-hero-meta">AAPL Â· NASDAQ Â· Last updated: Mon 2 Mar, 21:00 EST</div>
          <div class="stock-hero-price">$182.40</div>
          <span class="stock-hero-chg" style="background:var(--green-light);color:var(--green);">â–² $2.16 (+1.21%) today</span>
          <svg class="stock-sparkline-lg" viewBox="0 0 400 80" preserveAspectRatio="none">
            <defs><linearGradient id="sg1" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c4a7c" stop-opacity=".2"/><stop offset="100%" stop-color="#2c4a7c" stop-opacity="0"/></linearGradient></defs>
            <polyline points="0,60 20,55 40,58 60,50 80,45 100,47 120,40 140,35 160,38 180,32 200,28 220,30 240,25 260,22 280,26 300,20 320,18 340,22 360,15 380,12 400,10" stroke="#2c4a7c" stroke-width="2" fill="none"/>
            <polygon points="0,60 20,55 40,58 60,50 80,45 100,47 120,40 140,35 160,38 180,32 200,28 220,30 240,25 260,22 280,26 300,20 320,18 340,22 360,15 380,12 400,10 400,80 0,80" fill="url(#sg1)"/>
          </svg>
        </div>
        <div class="stock-stats-grid">
          <div class="stock-stat-box"><div class="stock-stat-lbl">Market Cap</div><div class="stock-stat-val">$2.81T</div></div>
          <div class="stock-stat-box"><div class="stock-stat-lbl">P/E Ratio</div><div class="stock-stat-val">28.4</div></div>
          <div class="stock-stat-box"><div class="stock-stat-lbl">52w High</div><div class="stock-stat-val">$199.62</div></div>
          <div class="stock-stat-box"><div class="stock-stat-lbl">52w Low</div><div class="stock-stat-val">$164.08</div></div>
        </div>
        <div class="stock-news">
          <div style="font-size:11px;font-family:'DM Mono',monospace;color:var(--ink3);text-transform:uppercase;letter-spacing:.5px;">Related News</div>
          <div class="stock-news-item"><div class="stock-news-source">Reuters</div><div class="stock-news-headline">Apple reportedly developing AI chip for smart home devices ahead of 2026 launch</div><div class="stock-news-time">2h ago</div></div>
          <div class="stock-news-item"><div class="stock-news-source">Bloomberg</div><div class="stock-news-headline">iPhone sales in China rebound as pricing strategy shifts, analysts say</div><div class="stock-news-time">5h ago</div></div>
          <div class="stock-news-item"><div class="stock-news-source">CNBC</div><div class="stock-news-headline">Apple Services revenue hits new record in Q1 2026 earnings preview</div><div class="stock-news-time">Yesterday</div></div>
        </div>
      </div>
      <div class="stock-detail" id="sdetail-nvda" style="display:none;">
        <div class="stock-hero">
          <div class="stock-hero-name">NVIDIA Corporation</div>
          <div class="stock-hero-meta">NVDA Â· NASDAQ Â· Last updated: Mon 2 Mar, 21:00 EST</div>
          <div class="stock-hero-price">$875.10</div>
          <span class="stock-hero-chg" style="background:var(--green-light);color:var(--green);">â–² $28.78 (+3.40%) today</span>
          <svg class="stock-sparkline-lg" viewBox="0 0 400 80" preserveAspectRatio="none">
            <defs><linearGradient id="sg2" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#166534" stop-opacity=".2"/><stop offset="100%" stop-color="#166534" stop-opacity="0"/></linearGradient></defs>
            <polyline points="0,70 20,65 40,60 60,52 80,48 100,42 120,36 140,30 160,26 180,22 200,18 220,20 240,15 260,12 280,10 300,8 320,6 340,8 360,5 380,3 400,2" stroke="#166534" stroke-width="2" fill="none"/>
            <polygon points="0,70 20,65 40,60 60,52 80,48 100,42 120,36 140,30 160,26 180,22 200,18 220,20 240,15 260,12 280,10 300,8 320,6 340,8 360,5 380,3 400,2 400,80 0,80" fill="url(#sg2)"/>
          </svg>
        </div>
        <div class="stock-stats-grid">
          <div class="stock-stat-box"><div class="stock-stat-lbl">Market Cap</div><div class="stock-stat-val">$2.16T</div></div>
          <div class="stock-stat-box"><div class="stock-stat-lbl">P/E Ratio</div><div class="stock-stat-val">65.2</div></div>
          <div class="stock-stat-box"><div class="stock-stat-lbl">52w High</div><div class="stock-stat-val">$974.00</div></div>
          <div class="stock-stat-box"><div class="stock-stat-lbl">52w Low</div><div class="stock-stat-val">$461.88</div></div>
        </div>
        <div class="stock-news">
          <div style="font-size:11px;font-family:'DM Mono',monospace;color:var(--ink3);text-transform:uppercase;letter-spacing:.5px;">Related News</div>
          <div class="stock-news-item"><div class="stock-news-source">FT</div><div class="stock-news-headline">NVIDIA Blackwell GPU demand continues to outstrip supply through H1 2026</div><div class="stock-news-time">1h ago</div></div>
          <div class="stock-news-item"><div class="stock-news-source">WSJ</div><div class="stock-news-headline">Jensen Huang hints at next-gen AI accelerator roadmap at GTC 2026</div><div class="stock-news-time">4h ago</div></div>
          <div class="stock-news-item"><div class="stock-news-source">The Verge</div><div class="stock-news-headline">NVIDIA expands data centre partnerships with three major cloud providers</div><div class="stock-news-time">Yesterday</div></div>
        </div>
      </div>
      <div class="stock-detail" id="sdetail-tsla" style="display:none;">
        <div class="stock-hero">
          <div class="stock-hero-name">Tesla Inc.</div>
          <div class="stock-hero-meta">TSLA Â· NASDAQ Â· Last updated: Mon 2 Mar, 21:00 EST</div>
          <div class="stock-hero-price">$193.57</div>
          <span class="stock-hero-chg" style="background:var(--red-light);color:var(--red);">â–¼ $1.56 (âˆ’0.80%) today</span>
          <svg class="stock-sparkline-lg" viewBox="0 0 400 80" preserveAspectRatio="none">
            <defs><linearGradient id="sg3" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#991b1b" stop-opacity=".15"/><stop offset="100%" stop-color="#991b1b" stop-opacity="0"/></linearGradient></defs>
            <polyline points="0,10 20,15 40,12 60,20 80,25 100,22 120,30 140,28 160,35 180,32 200,40 220,38 240,45 260,42 280,48 300,52 320,50 340,56 360,58 380,62 400,65" stroke="#991b1b" stroke-width="2" fill="none"/>
            <polygon points="0,10 20,15 40,12 60,20 80,25 100,22 120,30 140,28 160,35 180,32 200,40 220,38 240,45 260,42 280,48 300,52 320,50 340,56 360,58 380,62 400,65 400,80 0,80" fill="url(#sg3)"/>
          </svg>
        </div>
        <div class="stock-stats-grid">
          <div class="stock-stat-box"><div class="stock-stat-lbl">Market Cap</div><div class="stock-stat-val">$617B</div></div>
          <div class="stock-stat-box"><div class="stock-stat-lbl">P/E Ratio</div><div class="stock-stat-val">52.1</div></div>
          <div class="stock-stat-box"><div class="stock-stat-lbl">52w High</div><div class="stock-stat-val">$299.29</div></div>
          <div class="stock-stat-box"><div class="stock-stat-lbl">52w Low</div><div class="stock-stat-val">$138.80</div></div>
        </div>
        <div class="stock-news">
          <div style="font-size:11px;font-family:'DM Mono',monospace;color:var(--ink3);text-transform:uppercase;letter-spacing:.5px;">Related News</div>
          <div class="stock-news-item"><div class="stock-news-source">Reuters</div><div class="stock-news-headline">Tesla Model Y refresh sales disappoint in Europe amid growing competition</div><div class="stock-news-time">3h ago</div></div>
          <div class="stock-news-item"><div class="stock-news-source">Bloomberg</div><div class="stock-news-headline">Elon Musk's political activities seen weighing on Tesla brand perception</div><div class="stock-news-time">6h ago</div></div>
          <div class="stock-news-item"><div class="stock-news-source">Electrek</div><div class="stock-news-headline">Tesla Cybertruck recall expanded to cover additional powertrain faults</div><div class="stock-news-time">Yesterday</div></div>
        </div>
      </div>
      <div class="stock-detail" id="sdetail-meta" style="display:none;">
        <div class="stock-hero">
          <div class="stock-hero-name">Meta Platforms Inc.</div>
          <div class="stock-hero-meta">META Â· NASDAQ Â· Last updated: Mon 2 Mar, 21:00 EST</div>
          <div class="stock-hero-price">$493.00</div>
          <span class="stock-hero-chg" style="background:var(--green-light);color:var(--green);">â–² $2.45 (+0.50%) today</span>
          <svg class="stock-sparkline-lg" viewBox="0 0 400 80" preserveAspectRatio="none">
            <defs><linearGradient id="sg4" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c4a7c" stop-opacity=".2"/><stop offset="100%" stop-color="#2c4a7c" stop-opacity="0"/></linearGradient></defs>
            <polyline points="0,45 20,42 40,44 60,38 80,36 100,39 120,34 140,32 160,35 180,30 200,28 220,31 240,26 260,24 280,27 300,22 320,20 340,23 360,18 380,16 400,14" stroke="#2c4a7c" stroke-width="2" fill="none"/>
            <polygon points="0,45 20,42 40,44 60,38 80,36 100,39 120,34 140,32 160,35 180,30 200,28 220,31 240,26 260,24 280,27 300,22 320,20 340,23 360,18 380,16 400,14 400,80 0,80" fill="url(#sg4)"/>
          </svg>
        </div>
        <div class="stock-stats-grid">
          <div class="stock-stat-box"><div class="stock-stat-lbl">Market Cap</div><div class="stock-stat-val">$1.26T</div></div>
          <div class="stock-stat-box"><div class="stock-stat-lbl">P/E Ratio</div><div class="stock-stat-val">26.8</div></div>
          <div class="stock-stat-box"><div class="stock-stat-lbl">52w High</div><div class="stock-stat-val">$544.69</div></div>
          <div class="stock-stat-box"><div class="stock-stat-lbl">52w Low</div><div class="stock-stat-val">$414.50</div></div>
        </div>
        <div class="stock-news">
          <div style="font-size:11px;font-family:'DM Mono',monospace;color:var(--ink3);text-transform:uppercase;letter-spacing:.5px;">Related News</div>
          <div class="stock-news-item"><div class="stock-news-source">TechCrunch</div><div class="stock-news-headline">Meta's Llama 4 model beats GPT-4o on several key benchmarks, paper claims</div><div class="stock-news-time">2h ago</div></div>
          <div class="stock-news-item"><div class="stock-news-source">Bloomberg</div><div class="stock-news-headline">Instagram ad revenue surges 18% YoY as Reels monetisation matures</div><div class="stock-news-time">5h ago</div></div>
          <div class="stock-news-item"><div class="stock-news-source">WSJ</div><div class="stock-news-headline">Meta Reality Labs losses narrow as Quest 4 headset launch approaches</div><div class="stock-news-time">Yesterday</div></div>
        </div>
      </div>
    </div>

    <!-- INVOICE VIEW -->
    <div class="content" id="view-invoice">
      <div class="invoice-layout">
        <!-- Form -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-file-earmark-text-fill"></i></div>
            <div><div class="card-title">Invoice Details</div><div class="card-sub">Fill in to generate invoice</div></div>
          </div>
          <div class="card-body invoice-form-section" style="display:flex;flex-direction:column;gap:12px;">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
              <div>
                <label>From</label>
                <input class="inv-input" id="inv-from" value="Your Name / Company" oninput="updateInvoicePreview()">
              </div>
              <div>
                <label>Invoice #</label>
                <input class="inv-input" id="inv-num" value="INV-2026-001" oninput="updateInvoicePreview()">
              </div>
            </div>
            <div>
              <label>Bill To</label>
              <input class="inv-input" id="inv-to" value="Acme Ltd, London" oninput="updateInvoicePreview()">
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
              <div>
                <label>Issue Date</label>
                <input class="inv-input" id="inv-date" value="01/03/2026" oninput="updateInvoicePreview()">
              </div>
              <div>
                <label>Due Date</label>
                <input class="inv-input" id="inv-due" value="15/03/2026" oninput="updateInvoicePreview()">
              </div>
            </div>
            <div>
              <label>Line Items</label>
              <table class="inv-line-table">
                <thead><tr><th>Description</th><th>Qty</th><th>Unit Price</th><th>Amount</th><th></th></tr></thead>
                <tbody id="inv-lines">
                  <tr>
                    <td><input class="inv-desc" value="Web Development â€” March" oninput="updateInvoicePreview()"></td>
                    <td><input style="width:50px;" class="inv-qty" value="1" oninput="updateInvoicePreview()"></td>
                    <td><input style="width:80px;" class="inv-price" value="1200" oninput="updateInvoicePreview()"></td>
                    <td>Â£1,200.00</td>
                    <td><span style="cursor:pointer;color:var(--red);font-size:12px;" onclick="removeInvoiceLine(this)">âœ•</span></td>
                  </tr>
                  <tr>
                    <td><input class="inv-desc" value="SEO Consultancy" oninput="updateInvoicePreview()"></td>
                    <td><input style="width:50px;" class="inv-qty" value="3" oninput="updateInvoicePreview()"></td>
                    <td><input style="width:80px;" class="inv-price" value="150" oninput="updateInvoicePreview()"></td>
                    <td>Â£450.00</td>
                    <td><span style="cursor:pointer;color:var(--red);font-size:12px;" onclick="removeInvoiceLine(this)">âœ•</span></td>
                  </tr>
                </tbody>
              </table>
              <button class="btn btn-ghost" style="font-size:12px;margin-top:6px;" onclick="addInvoiceLine()">+ Add Line</button>
            </div>
            <div>
              <label>Notes</label>
              <input class="inv-input" id="inv-notes" value="Payment via bank transfer. 30-day terms." oninput="updateInvoicePreview()">
            </div>
            <div style="display:flex;gap:10px;align-items:center;">
              <input type="checkbox" id="inv-vat" onchange="updateInvoicePreview()" checked>
              <label style="font-size:12px;color:var(--ink);margin:0;text-transform:none;letter-spacing:0;">Include VAT (20%)</label>
            </div>
            <div style="display:flex;gap:8px;margin-top:4px;">
              <button class="btn btn-primary" style="flex:1;" onclick="showToast('Email sent â€” Invoice INV-2026-001')"><i class="bi bi-envelope"></i> Send by Email</button>
              <button class="btn btn-ghost" onclick="downloadInvoice()"><i class="bi bi-download"></i> Download PDF</button>
            </div>
          </div>
        </div>
        <!-- Live Preview -->
        <div>
          <div style="font-size:11px;font-family:'DM Mono',monospace;color:var(--ink3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px;">Live Preview</div>
          <div class="inv-preview" id="inv-preview">
            <div class="inv-preview-header">
              <div><div class="inv-preview-title">INVOICE</div><div class="inv-preview-from" id="prv-from">Your Name / Company</div></div>
              <div style="text-align:right;font-size:12px;color:#555;">
                <div style="font-weight:700;" id="prv-num">INV-2026-001</div>
                <div id="prv-date">Issued: 01/03/2026</div>
                <div id="prv-due">Due: 15/03/2026</div>
              </div>
            </div>
            <div class="inv-preview-meta">
              <div><div class="inv-preview-to-label">Bill To</div><div id="prv-to" style="font-weight:600;">Acme Ltd, London</div></div>
              <div></div>
            </div>
            <table class="inv-preview-table">
              <thead><tr><th>Description</th><th>Qty</th><th>Unit Price</th><th>Amount</th></tr></thead>
              <tbody id="prv-lines">
                <tr><td>Web Development â€” March</td><td>1</td><td>Â£1,200.00</td><td>Â£1,200.00</td></tr>
                <tr><td>SEO Consultancy</td><td>3</td><td>Â£150.00</td><td>Â£450.00</td></tr>
              </tbody>
            </table>
            <div class="inv-preview-totals">
              <div class="inv-preview-total-line"><span>Subtotal</span><span id="prv-sub">Â£1,650.00</span></div>
              <div class="inv-preview-total-line" id="prv-vat-row"><span>VAT (20%)</span><span id="prv-vat">Â£330.00</span></div>
              <div class="inv-preview-total-line inv-preview-grand"><span>Total Due</span><span id="prv-total">Â£1,980.00</span></div>
            </div>
            <div style="margin-top:12px;font-size:11px;color:#888;" id="prv-notes">Payment via bank transfer. 30-day terms.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- CASH FLOW VIEW -->
    <div class="content" id="view-cashflow">
      <!-- Summary stats -->
      <div class="stat-row" style="margin-bottom:16px;">
        <div class="stat-card"><div class="stat-value" style="color:var(--green);">+Â£1,240</div><div class="stat-label">Net This Month</div><div class="stat-change" style="color:var(--ink3);">Income âˆ’ Expenses</div></div>
        <div class="stat-card"><div class="stat-value" style="color:var(--green);">+Â£980</div><div class="stat-label">Forecast Next Month</div><div class="stat-change" style="color:var(--ink3);">ANN projection</div></div>
        <div class="stat-card"><div class="stat-value" style="color:var(--green);">+Â£1,100</div><div class="stat-label">3-Month Average</div><div class="stat-change" style="color:var(--ink3);">Decâ€“Feb</div></div>
        <div class="stat-card"><div class="stat-value">Â£3,200</div><div class="stat-label">Monthly Income</div><div class="stat-change" style="color:var(--ink3);">Salary + freelance</div></div>
      </div>

      <!-- Bar Chart -->
      <div class="card" style="margin-bottom:16px;">
        <div class="card-header">
          <div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-cash-stack"></i></div>
          <div><div class="card-title">Income vs Expenses</div><div class="card-sub">Oct 2025 â€” Mar 2026</div></div>
          <div style="display:flex;gap:12px;margin-left:auto;align-items:center;">
            <div style="display:flex;align-items:center;gap:5px;font-size:11px;color:var(--ink2);"><div style="width:10px;height:10px;background:#2c4a7c;border-radius:2px;"></div>Income</div>
            <div style="display:flex;align-items:center;gap:5px;font-size:11px;color:var(--ink2);"><div style="width:10px;height:10px;background:#ef4444;border-radius:2px;"></div>Expenses</div>
          </div>
        </div>
        <div class="card-body cashflow-chart-wrap">
          <div style="display:flex;align-items:flex-end;gap:0;padding:8px 0 0;">
            <div style="display:flex;flex-direction:column;justify-content:space-between;height:140px;padding-right:8px;font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);text-align:right;flex-shrink:0;">
              <span>Â£4k</span><span>Â£3k</span><span>Â£2k</span><span>Â£1k</span><span>Â£0</span>
            </div>
            <div style="flex:1;display:flex;gap:12px;align-items:flex-end;height:140px;border-bottom:1px solid var(--border);">
              <!-- Oct: income 3200, exp 2050 -->
              <div class="cf-month-group"><div class="cf-bar income" style="height:112px;" title="Â£3,200"></div><div class="cf-bar expense" style="height:72px;" title="Â£2,050"></div></div>
              <!-- Nov: income 3200, exp 2200 -->
              <div class="cf-month-group"><div class="cf-bar income" style="height:112px;"></div><div class="cf-bar expense" style="height:77px;"></div></div>
              <!-- Dec: income 4100, exp 2800 -->
              <div class="cf-month-group"><div class="cf-bar income" style="height:140px;" title="Â£4,100"></div><div class="cf-bar expense" style="height:98px;" title="Â£2,800"></div></div>
              <!-- Jan: income 3200, exp 1960 -->
              <div class="cf-month-group"><div class="cf-bar income" style="height:112px;"></div><div class="cf-bar expense" style="height:68px;"></div></div>
              <!-- Feb: income 3200, exp 1958 (actual) -->
              <div class="cf-month-group"><div class="cf-bar income" style="height:112px;"></div><div class="cf-bar expense" style="height:69px;"></div></div>
              <!-- Mar: forecast income 3200, exp 2220 (projected) -->
              <div class="cf-month-group"><div class="cf-bar income" style="height:112px;opacity:.5;"></div><div class="cf-bar expense" style="height:78px;opacity:.5;"></div></div>
            </div>
          </div>
          <div style="display:flex;gap:12px;padding-left:36px;margin-top:5px;">
            <div class="cf-month-label" style="flex:1;text-align:center;">Oct</div>
            <div class="cf-month-label" style="flex:1;text-align:center;">Nov</div>
            <div class="cf-month-label" style="flex:1;text-align:center;">Dec</div>
            <div class="cf-month-label" style="flex:1;text-align:center;">Jan</div>
            <div class="cf-month-label" style="flex:1;text-align:center;">Feb</div>
            <div class="cf-month-label" style="flex:1;text-align:center;">Mar <span style="font-size:8px;color:var(--ink3);">(est)</span></div>
          </div>
        </div>
      </div>

      <!-- Breakdown table -->
      <div class="card" style="margin-bottom:16px;">
        <div class="card-header"><div class="card-icon" style="background:var(--amber-light);"><i class="bi bi-table"></i></div><div><div class="card-title">Monthly Breakdown</div><div class="card-sub">Feb 2026 actuals</div></div></div>
        <div class="card-body" style="padding:0;">
          <table class="cf-table">
            <thead><tr><th>Category</th><th>Income</th><th>Expenses</th><th>Net</th></tr></thead>
            <tbody>
              <tr><td>Salary</td><td class="income-col">+Â£2,800</td><td>â€”</td><td class="net-col">+Â£2,800</td></tr>
              <tr><td>Freelance</td><td class="income-col">+Â£400</td><td>â€”</td><td class="net-col">+Â£400</td></tr>
              <tr><td>Rent / Mortgage</td><td>â€”</td><td class="expense-col">âˆ’Â£780</td><td class="net-col" style="color:var(--red);">âˆ’Â£780</td></tr>
              <tr><td>Food & Groceries</td><td>â€”</td><td class="expense-col">âˆ’Â£340</td><td class="net-col" style="color:var(--red);">âˆ’Â£340</td></tr>
              <tr><td>Transport</td><td>â€”</td><td class="expense-col">âˆ’Â£210</td><td class="net-col" style="color:var(--red);">âˆ’Â£210</td></tr>
              <tr><td>Subscriptions</td><td>â€”</td><td class="expense-col">âˆ’Â£200</td><td class="net-col" style="color:var(--red);">âˆ’Â£200</td></tr>
              <tr><td>Shopping</td><td>â€”</td><td class="expense-col">âˆ’Â£312</td><td class="net-col" style="color:var(--red);">âˆ’Â£312</td></tr>
              <tr><td style="font-weight:700;">Total</td><td class="income-col">+Â£3,200</td><td class="expense-col">âˆ’Â£1,842</td><td class="net-col" style="color:var(--green);">+Â£1,358</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- ANN insight -->
      <div class="cf-ann-insight">
        <div style="width:28px;height:28px;border-radius:8px;background:#2c4a7c;display:flex;align-items:center;justify-content:center;color:#fff;font-size:13px;flex-shrink:0;"><i class="bi bi-stars"></i></div>
        <div><div style="font-size:10.5px;font-weight:700;color:#2c4a7c;text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px;">ANN Insight</div><div style="font-size:12.5px;color:var(--ink);">Your shopping spend is <strong>Â£312</strong> this month â€” 12% above your 3-month average. Reducing dining-out and impulse purchases could save approx. <strong>Â£60/month</strong>.</div></div>
      </div>
    </div>

    <!-- PAYSLIPS VIEW -->
    <div class="content" id="view-payslips">
      <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;">
        <button class="btn btn-primary" style="font-size:12px;" onclick="uploadPayslip()"><i class="bi bi-upload"></i> Upload Payslip</button>
        <button class="btn btn-ghost" style="font-size:12px;" onclick="showToast('Syncing payslips from emailâ€¦')"><i class="bi bi-envelope-arrow-down"></i> Sync Emails</button>
      </div>
      <div class="payslip-layout">
        <!-- List -->
        <div class="card" style="overflow:hidden;">
          <div class="card-header"><div class="card-icon" style="background:var(--blue-light);"><i class="bi bi-file-earmark-person-fill"></i></div><div><div class="card-title">Your Payslips</div><div class="card-sub">4 total Â· 3 synced Â· 1 uploaded</div></div></div>
          <div style="padding:0;" id="payslip-list">
            <div class="payslip-item active" onclick="selectPayslip('mar26',this)">
              <div class="payslip-logo">A</div>
              <div class="payslip-meta"><div class="payslip-employer">Acme Ltd</div><div class="payslip-date">March 2026</div></div>
              <div class="payslip-gross">Â£2,800</div>
              <span class="payslip-badge synced">Synced</span>
            </div>
            <div class="payslip-item" onclick="selectPayslip('feb26',this)">
              <div class="payslip-logo">A</div>
              <div class="payslip-meta"><div class="payslip-employer">Acme Ltd</div><div class="payslip-date">February 2026</div></div>
              <div class="payslip-gross">Â£2,800</div>
              <span class="payslip-badge synced">Synced</span>
            </div>
            <div class="payslip-item" onclick="selectPayslip('jan26',this)">
              <div class="payslip-logo">A</div>
              <div class="payslip-meta"><div class="payslip-employer">Acme Ltd</div><div class="payslip-date">January 2026</div></div>
              <div class="payslip-gross">Â£2,800</div>
              <span class="payslip-badge synced">Synced</span>
            </div>
            <div class="payslip-item" onclick="selectPayslip('dec25',this)">
              <div class="payslip-logo">F</div>
              <div class="payslip-meta"><div class="payslip-employer">Freelance Invoice</div><div class="payslip-date">December 2025</div></div>
              <div class="payslip-gross">Â£400</div>
              <span class="payslip-badge uploaded">Uploaded</span>
            </div>
          </div>
        </div>
        <!-- Detail -->
        <div class="card" id="payslip-detail">
          <div class="card-header">
            <div class="card-icon" style="background:#2c4a7c;color:#fff;font-weight:800;font-size:12px;">A</div>
            <div><div class="card-title">Acme Ltd â€” March 2026</div><div class="card-sub">Payslip Â· Employee: Your Name Â· NI: AB123456C</div></div>
            <button class="btn btn-ghost" style="margin-left:auto;font-size:11px;" onclick="showToast('Payslip PDF downloaded')"><i class="bi bi-download"></i> PDF</button>
          </div>
          <div class="card-body">
            <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px;">Pay Period: 1â€“31 March 2026 Â· Payment Date: 28 March 2026</div>
            <div class="payslip-detail-row"><span class="payslip-detail-lbl">Gross Pay</span><span class="payslip-detail-val">Â£2,800.00</span></div>
            <div class="payslip-detail-row"><span class="payslip-detail-lbl">Income Tax (PAYE)</span><span class="payslip-detail-val deduction">âˆ’Â£420.00</span></div>
            <div class="payslip-detail-row"><span class="payslip-detail-lbl">National Insurance</span><span class="payslip-detail-val deduction">âˆ’Â£196.00</span></div>
            <div class="payslip-detail-row"><span class="payslip-detail-lbl">Pension (5%)</span><span class="payslip-detail-val deduction">âˆ’Â£140.00</span></div>
            <div class="payslip-detail-row total"><span class="payslip-detail-lbl">Net Pay</span><span class="payslip-detail-val" style="color:#2c4a7c;">Â£2,044.00</span></div>
            <div style="margin-top:16px;padding-top:12px;border-top:1px solid var(--border);">
              <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px;">Year to Date (2025/26)</div>
              <div class="payslip-detail-row" style="font-size:12px;"><span class="payslip-detail-lbl">Gross YTD</span><span class="payslip-detail-val">Â£28,000.00</span></div>
              <div class="payslip-detail-row" style="font-size:12px;"><span class="payslip-detail-lbl">Tax YTD</span><span class="payslip-detail-val deduction">âˆ’Â£4,200.00</span></div>
              <div class="payslip-detail-row" style="font-size:12px;"><span class="payslip-detail-lbl">NI YTD</span><span class="payslip-detail-val deduction">âˆ’Â£1,960.00</span></div>
            </div>
          </div>
        </div>
      </div>
      <input type="file" id="payslip-file-input" accept=".pdf,.jpg,.png" style="display:none;" onchange="showToast('Payslip uploaded successfully')">
    </div>

  </div>
</div>

<!-- Mobile Drawer Overlay -->
<div class="mobile-drawer-overlay" id="drawer-overlay" onclick="toggleDrawer()"></div>

<!-- Mobile Drawer (full nav) -->
<div class="mobile-drawer" id="mobile-drawer">
  <div class="sidebar-brand">
    <div class="brand-name">ANN</div>
    <div class="brand-sub">Personal Assistant</div>
  </div>
  <div class="sidebar-nav">
    <div class="nav-section-label">Overview</div>
    <div class="nav-item" onclick="navigateMobile('dashboard', this)"><span class="nav-icon"><i class="bi bi-grid-fill"></i></span> Dashboard</div>
    <div class="nav-item" onclick="navigateMobile('calendar', this)"><span class="nav-icon"><i class="bi bi-calendar3"></i></span> Calendar<span class="nav-badge">3</span></div>
    <div class="nav-item" onclick="navigateMobile('tasks', this)"><span class="nav-icon"><i class="bi bi-check2-square"></i></span> Tasks<span class="nav-badge">5</span></div>
    <div class="nav-item" onclick="navigateMobile('meetings', this)"><span class="nav-icon"><i class="bi bi-camera-video-fill"></i></span> Meetings<span class="nav-badge">2</span></div>
    <div class="nav-section-label">Communications</div>
    <div class="nav-item" onclick="navigateMobile('emails', this)"><span class="nav-icon"><i class="bi bi-envelope-fill"></i></span> Emails<span class="nav-badge">4</span></div>
    <div class="nav-item" onclick="navigateMobile('chat', this)"><span class="nav-icon"><i class="bi bi-chat-dots-fill"></i></span> Chat<span class="nav-badge">3</span></div>
    <div class="nav-item" onclick="navigateMobile('calls', this)"><span class="nav-icon"><i class="bi bi-telephone-fill"></i></span> Calls</div>
    <div class="nav-item" onclick="navigateMobile('wallet', this)"><span class="nav-icon"><i class="bi bi-wallet2"></i></span> Wallet</div>
    <div class="nav-section-label">Finance</div>
    <div class="nav-item" onclick="navigateMobile('budget', this)"><span class="nav-icon"><i class="bi bi-pie-chart-fill"></i></span> Budget</div>
    <div class="nav-item" onclick="navigateMobile('bills', this)"><span class="nav-icon"><i class="bi bi-receipt"></i></span> Bills<span class="nav-badge" style="background:var(--red)">!</span></div>
    <div class="nav-item" onclick="navigateMobile('categorisation', this)"><span class="nav-icon"><i class="bi bi-tags-fill"></i></span> Categorisation</div>
    <div class="nav-item" onclick="navigateMobile('vat', this)"><span class="nav-icon"><i class="bi bi-file-earmark-spreadsheet-fill"></i></span> VAT Return</div>
    <div class="nav-item" onclick="navigateMobile('tax', this)"><span class="nav-icon"><i class="bi bi-calculator-fill"></i></span> Tax Return</div>
    <div class="nav-item" onclick="navigateMobile('stocks', this)"><span class="nav-icon"><i class="bi bi-graph-up"></i></span> Stocks</div>
    <div class="nav-item" onclick="navigateMobile('invoice', this)"><span class="nav-icon"><i class="bi bi-file-earmark-text-fill"></i></span> Invoice</div>
    <div class="nav-item" onclick="navigateMobile('cashflow', this)"><span class="nav-icon"><i class="bi bi-cash-stack"></i></span> Cash Flow</div>
    <div class="nav-item" onclick="navigateMobile('payslips', this)"><span class="nav-icon"><i class="bi bi-file-earmark-person-fill"></i></span> Payslips</div>
    <div class="nav-section-label">Lifestyle</div>
    <div class="nav-item" onclick="navigateMobile('profile', this)"><span class="nav-icon"><i class="bi bi-person-fill"></i></span> Profile</div>
    <div class="nav-item" onclick="navigateMobile('habits', this)"><span class="nav-icon"><i class="bi bi-activity"></i></span> Habits</div>
    <div class="nav-item" onclick="navigateMobile('inventory', this)"><span class="nav-icon"><i class="bi bi-box-seam-fill"></i></span> Inventory</div>
    <div class="nav-item" onclick="navigateMobile('meals', this)"><span class="nav-icon"><i class="bi bi-cup-hot-fill"></i></span> Meals</div>
    <div class="nav-item" onclick="navigateMobile('trips', this)"><span class="nav-icon"><i class="bi bi-globe2"></i></span> Trips</div>
    <div class="nav-item" onclick="navigateMobile('parcels', this)"><span class="nav-icon"><i class="bi bi-truck"></i></span> Parcels<span class="nav-badge">2</span></div>
  </div>
  <div class="sidebar-profile">
    <div class="profile-avatar">O</div>
    <div>
      <div class="profile-name">Overwatch</div>
      <div class="profile-role">Personal Â· Work</div>
    </div>
  </div>
</div>

<!-- Mobile Bottom Nav -->
<nav class="mobile-nav">
  <div class="mobile-nav-inner">
    <div class="mobile-nav-btn active" id="mnav-dashboard" onclick="navigateMobileBottom('dashboard', this)">
      <span class="mobile-nav-icon"><i class="bi bi-grid-fill"></i></span>
      <span>Home</span>
    </div>
    <div class="mobile-nav-btn" id="mnav-emails" onclick="navigateMobileBottom('emails', this)">
      <span class="mobile-nav-icon"><i class="bi bi-envelope-fill"></i></span>
      <span>Emails</span>
      <div class="mobile-nav-badge">4</div>
    </div>
    <div class="mobile-nav-btn" id="mnav-budget" onclick="navigateMobileBottom('budget', this)">
      <span class="mobile-nav-icon"><i class="bi bi-pie-chart-fill"></i></span>
      <span>Budget</span>
    </div>
    <div class="mobile-nav-btn" id="mnav-tasks" onclick="navigateMobileBottom('tasks', this)">
      <span class="mobile-nav-icon"><i class="bi bi-check2-square"></i></span>
      <span>Tasks</span>
      <div class="mobile-nav-badge">5</div>
    </div>
    <div class="mobile-nav-btn" id="mnav-chat" onclick="navigateMobileBottom('chat', this)">
      <span class="mobile-nav-icon"><i class="bi bi-chat-dots-fill"></i></span>
      <span>Chat</span>
      <div class="mobile-nav-badge">3</div>
    </div>
    <div class="mobile-nav-btn" id="mnav-more" onclick="toggleDrawer()">
      <span class="mobile-nav-icon"><i class="bi bi-list"></i></span>
      <span>More</span>
    </div>
  </div>
</nav>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Trip Planner Modal -->
<div class="trip-modal-overlay" id="trip-modal-overlay" onclick="closeTripPlannerOverlay(event)">
  <div class="trip-modal" onclick="event.stopPropagation()">

    <!-- Hero -->
    <div class="trip-modal-hero">
      <button class="trip-modal-close-btn" onclick="closeTripPlanner()"><i class="bi bi-x-lg"></i></button>
      <div class="trip-modal-hero-text">
        <h2>New York City</h2>
        <p>TRIP PLANNER Â· POWERED BY ANN AI</p>
      </div>
    </div>

    <!-- Step indicator -->
    <div class="trip-steps" id="trip-steps">
      <div class="trip-step">
        <div class="trip-step-dot active" id="step-dot-1">1</div>
        <div class="trip-step-label active" id="step-label-1">Dates</div>
      </div>
      <div class="trip-step-line" id="step-line-1"></div>
      <div class="trip-step">
        <div class="trip-step-dot" id="step-dot-2">2</div>
        <div class="trip-step-label" id="step-label-2">Flights</div>
      </div>
      <div class="trip-step-line" id="step-line-2"></div>
      <div class="trip-step">
        <div class="trip-step-dot" id="step-dot-3">3</div>
        <div class="trip-step-label" id="step-label-3">Hotel</div>
      </div>
      <div class="trip-step-line" id="step-line-3"></div>
      <div class="trip-step">
        <div class="trip-step-dot" id="step-dot-4">4</div>
        <div class="trip-step-label" id="step-label-4">Itinerary</div>
      </div>
      <div class="trip-step-line" id="step-line-4"></div>
      <div class="trip-step">
        <div class="trip-step-dot" id="step-dot-5">5</div>
        <div class="trip-step-label" id="step-label-5">Confirm</div>
      </div>
    </div>

    <!-- Panel 1: Dates & Preferences -->
    <div class="trip-panel active" id="trip-panel-1">
      <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:12px;">TRAVEL DATES</div>
      <div class="date-grid">
        <div class="date-field">
          <label>Departure</label>
          <input type="date" id="trip-depart" value="2026-06-10">
        </div>
        <div class="date-field">
          <label>Return</label>
          <input type="date" id="trip-return" value="2026-06-15">
        </div>
        <div class="date-field">
          <label>Travellers</label>
          <select id="trip-travellers">
            <option>1 Adult</option>
            <option>2 Adults</option>
            <option>3 Adults</option>
          </select>
        </div>
        <div class="date-field">
          <label>Class</label>
          <select id="trip-class">
            <option>Economy</option>
            <option>Premium Economy</option>
            <option>Business</option>
          </select>
        </div>
      </div>
      <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:10px;margin-top:4px;">INTERESTS (from your profile)</div>
      <div class="pref-chips" id="pref-chips">
        <div class="pref-chip selected" onclick="toggleChip(this)">ðŸ“ˆ Finance & Business</div>
        <div class="pref-chip selected" onclick="toggleChip(this)">ðŸœ Asian Cuisine</div>
        <div class="pref-chip selected" onclick="toggleChip(this)">â˜• Coffee Shops</div>
        <div class="pref-chip selected" onclick="toggleChip(this)">ðŸ’» Tech Culture</div>
        <div class="pref-chip" onclick="toggleChip(this)">ðŸŽ¨ Art & Museums</div>
        <div class="pref-chip" onclick="toggleChip(this)">ðŸ™ Architecture</div>
        <div class="pref-chip" onclick="toggleChip(this)">ðŸŽ­ Broadway</div>
        <div class="pref-chip" onclick="toggleChip(this)">ðŸ‹ï¸ Fitness</div>
      </div>
      <div style="padding:12px 14px;background:var(--blue-light);border-radius:8px;font-size:11px;color:#1a3260;font-family:'DM Mono',monospace;line-height:1.5;">
        âœ¦ ANN will generate a personalised itinerary, flight options, and hotel suggestions based on your selections and taste profile.
      </div>
    </div>

    <!-- Panel 2: Flights -->
    <div class="trip-panel" id="trip-panel-2">
      <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:14px;">AVAILABLE FLIGHTS Â· LHR â†’ JFK Â· 10 JUN 2026</div>

      <div class="flight-option selected" id="flight-1" onclick="selectFlight('flight-1')">
        <div>
          <div class="flight-airline">British Airways</div>
          <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);margin-top:2px;">BA 177 Â· Non-stop</div>
        </div>
        <div class="flight-times">
          <div class="flight-time">09:15</div>
          <div class="flight-route-line">
            <div class="flight-duration">7h 45m</div>
            <div class="flight-line"></div>
            <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);">LHR â†’ JFK</div>
          </div>
          <div class="flight-time">12:00</div>
        </div>
        <div>
          <div class="flight-price">Â£389</div>
          <div class="flight-price-sub">per person</div>
        </div>
      </div>

      <div class="flight-option" id="flight-2" onclick="selectFlight('flight-2')">
        <div>
          <div class="flight-airline">Virgin Atlantic</div>
          <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);margin-top:2px;">VS 3 Â· Non-stop</div>
        </div>
        <div class="flight-times">
          <div class="flight-time">11:30</div>
          <div class="flight-route-line">
            <div class="flight-duration">8h 05m</div>
            <div class="flight-line"></div>
            <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);">LHR â†’ JFK</div>
          </div>
          <div class="flight-time">14:35</div>
        </div>
        <div>
          <div class="flight-price">Â£342</div>
          <div class="flight-price-sub">per person</div>
        </div>
      </div>

      <div class="flight-option" id="flight-3" onclick="selectFlight('flight-3')">
        <div>
          <div class="flight-airline">American Airlines</div>
          <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);margin-top:2px;">AA 106 Â· 1 stop Â· ORD</div>
        </div>
        <div class="flight-times">
          <div class="flight-time">07:45</div>
          <div class="flight-route-line">
            <div class="flight-duration">11h 20m</div>
            <div class="flight-line"></div>
            <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);">LHR â†’ ORD â†’ JFK</div>
          </div>
          <div class="flight-time">13:05</div>
        </div>
        <div>
          <div class="flight-price">Â£274</div>
          <div class="flight-price-sub">per person</div>
        </div>
      </div>

      <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);margin-top:4px;">RETURN FLIGHT Â· JFK â†’ LHR Â· 15 JUN 2026</div>
      <div class="flight-option selected" style="margin-top:10px;" id="flight-r1" onclick="selectFlight('flight-r1')">
        <div>
          <div class="flight-airline">British Airways</div>
          <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);margin-top:2px;">BA 178 Â· Non-stop</div>
        </div>
        <div class="flight-times">
          <div class="flight-time">18:30</div>
          <div class="flight-route-line">
            <div class="flight-duration">6h 45m</div>
            <div class="flight-line"></div>
            <div style="font-size:9px;font-family:'DM Mono',monospace;color:var(--ink3);">JFK â†’ LHR</div>
          </div>
          <div class="flight-time">06:15+1</div>
        </div>
        <div>
          <div class="flight-price">Â£349</div>
          <div class="flight-price-sub">per person</div>
        </div>
      </div>
    </div>

    <!-- Panel 3: Hotels -->
    <div class="trip-panel" id="trip-panel-3">
      <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:14px;">HOTELS Â· NEW YORK CITY Â· 5 NIGHTS</div>

      <div class="hotel-option selected" id="hotel-1" onclick="selectHotel('hotel-1')">
        <div class="hotel-img">ðŸ¨</div>
        <div class="hotel-info">
          <div class="hotel-name">The Manhattan at Times Square</div>
          <div class="hotel-location">Midtown Â· 0.3mi to Central Park Â· Free WiFi</div>
          <div class="hotel-stars">â˜…â˜…â˜…â˜…â˜† 4.2 Â· 1,840 reviews</div>
          <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--green);margin-top:3px;">âœ“ Gym Â· Rooftop bar Â· Business centre</div>
        </div>
        <div>
          <div class="hotel-price">Â£189</div>
          <div class="hotel-price-sub">per night</div>
          <div class="hotel-price-sub" style="color:var(--ink);font-weight:600;margin-top:4px;">Â£945 total</div>
        </div>
      </div>

      <div class="hotel-option" id="hotel-2" onclick="selectHotel('hotel-2')">
        <div class="hotel-img">ðŸ©</div>
        <div class="hotel-info">
          <div class="hotel-name">Ace Hotel Brooklyn</div>
          <div class="hotel-location">Williamsburg Â· Hip district Â· Near subway</div>
          <div class="hotel-stars">â˜…â˜…â˜…â˜…â˜… 4.7 Â· 920 reviews</div>
          <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--green);margin-top:3px;">âœ“ Rooftop pool Â· Coffee shop Â· Coworking</div>
        </div>
        <div>
          <div class="hotel-price">Â£224</div>
          <div class="hotel-price-sub">per night</div>
          <div class="hotel-price-sub" style="color:var(--ink);font-weight:600;margin-top:4px;">Â£1,120 total</div>
        </div>
      </div>

      <div class="hotel-option" id="hotel-3" onclick="selectHotel('hotel-3')">
        <div class="hotel-img">ðŸ¦</div>
        <div class="hotel-info">
          <div class="hotel-name">Wall Street Inn</div>
          <div class="hotel-location">Financial District Â· Near NYSE Â· Business hub</div>
          <div class="hotel-stars">â˜…â˜…â˜…â˜…â˜† 4.0 Â· 2,110 reviews</div>
          <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--green);margin-top:3px;">âœ“ Conference rooms Â· Express check-in Â· Bar</div>
        </div>
        <div>
          <div class="hotel-price">Â£155</div>
          <div class="hotel-price-sub">per night</div>
          <div class="hotel-price-sub" style="color:var(--ink);font-weight:600;margin-top:4px;">Â£775 total</div>
        </div>
      </div>
    </div>

    <!-- Panel 4: AI Itinerary (with loading state) -->
    <div class="trip-panel" id="trip-panel-4">
      <div id="itin-loading" class="ai-thinking" style="display:none;">
        <div class="ai-dots">
          <div class="ai-dot"></div>
          <div class="ai-dot"></div>
          <div class="ai-dot"></div>
        </div>
        <div style="font-size:12px;font-family:'DM Mono',monospace;color:var(--ink3);">ANN is generating your personalised itinerary...</div>
      </div>

      <div id="itin-content">
        <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:16px;">AI-GENERATED ITINERARY Â· NEW YORK CITY Â· 5 DAYS</div>

        <!-- Day 1 -->
        <div class="itin-day">
          <div class="itin-day-header">
            <div class="itin-day-num">1</div>
            <div><div class="itin-day-title">Arrival & Midtown</div><div class="itin-day-sub">Wed 10 Jun Â· JFK arrival ~12:00pm</div></div>
          </div>
          <div class="itin-item"><div class="itin-time">12:30</div><div class="itin-dot" style="background:#3b82f6;"></div><div class="itin-info"><div class="itin-name">JFK â†’ Manhattan Â· AirTrain + Subway</div><div class="itin-detail">45 min Â· $10.75 Â· E train to 5th Ave</div><span class="itin-tag itin-tag-transit">Transit</span></div></div>
          <div class="itin-item"><div class="itin-time">13:30</div><div class="itin-dot" style="background:#10b981;"></div><div class="itin-info"><div class="itin-name">Check-in Â· The Manhattan at Times Square</div><div class="itin-detail">Request early check-in Â· Store luggage if unavailable</div><span class="itin-tag itin-tag-hotel">Hotel</span></div></div>
          <div class="itin-item"><div class="itin-time">15:00</div><div class="itin-dot" style="background:#f59e0b;"></div><div class="itin-info"><div class="itin-name">Stumptown Coffee Roasters</div><div class="itin-detail">18 W 29th St Â· Specialty coffee Â· Matches your â˜• profile</div><span class="itin-tag itin-tag-food">Food</span></div></div>
          <div class="itin-item"><div class="itin-time">16:00</div><div class="itin-dot" style="background:#8b5cf6;"></div><div class="itin-info"><div class="itin-name">High Line Walking Tour</div><div class="itin-detail">Elevated park Â· 1.45 miles Â· Hudson Yards views Â· Free</div><span class="itin-tag itin-tag-culture">Culture</span></div></div>
          <div class="itin-item"><div class="itin-time">19:00</div><div class="itin-dot" style="background:#f59e0b;"></div><div class="itin-info"><div class="itin-name">Momofuku Noodle Bar</div><div class="itin-detail">171 1st Ave Â· Asian ramen Â· Matches your ðŸœ taste profile</div><span class="itin-tag itin-tag-food">Food</span></div></div>
        </div>

        <!-- Day 2 -->
        <div class="itin-day">
          <div class="itin-day-header">
            <div class="itin-day-num">2</div>
            <div><div class="itin-day-title">Finance District & Wall Street</div><div class="itin-day-sub">Thu 11 Jun Â· Matched to your ðŸ“ˆ finance interest</div></div>
          </div>
          <div class="itin-item"><div class="itin-time">08:30</div><div class="itin-dot" style="background:#f59e0b;"></div><div class="itin-info"><div class="itin-name">Gregory's Coffee Â· Breakfast</div><div class="itin-detail">Ground floor of 1 WTC Â· NYC speciality chain</div><span class="itin-tag itin-tag-food">Food</span></div></div>
          <div class="itin-item"><div class="itin-time">09:30</div><div class="itin-dot" style="background:#8b5cf6;"></div><div class="itin-info"><div class="itin-name">NYSE & Wall Street Walking Tour</div><div class="itin-detail">11 Wall St Â· See trading floor exterior Â· Charging Bull sculpture</div><span class="itin-tag itin-tag-culture">Culture</span></div></div>
          <div class="itin-item"><div class="itin-time">11:00</div><div class="itin-dot" style="background:#8b5cf6;"></div><div class="itin-info"><div class="itin-name">Museum of American Finance</div><div class="itin-detail">48 Wall St Â· Historic stock certificates, trading history Â· Â£15</div><span class="itin-tag itin-tag-culture">Culture</span></div></div>
          <div class="itin-item"><div class="itin-time">13:00</div><div class="itin-dot" style="background:#f59e0b;"></div><div class="itin-info"><div class="itin-name">Xi'an Famous Foods Â· Lunch</div><div class="itin-detail">FiDi location Â· Hand-pulled noodles Â· Matches ðŸœ profile</div><span class="itin-tag itin-tag-food">Food</span></div></div>
          <div class="itin-item"><div class="itin-time">15:00</div><div class="itin-dot" style="background:#8b5cf6;"></div><div class="itin-info"><div class="itin-name">One World Observatory</div><div class="itin-detail">1 World Trade Center Â· 100th floor Â· 360Â° views Â· Â£28</div><span class="itin-tag itin-tag-culture">Culture</span></div></div>
          <div class="itin-item"><div class="itin-time">19:30</div><div class="itin-dot" style="background:#f59e0b;"></div><div class="itin-info"><div class="itin-name">Nobu Downtown Â· Dinner</div><div class="itin-detail">195 Broadway Â· Japanese fusion Â· Reserve ahead</div><span class="itin-tag itin-tag-food">Food</span></div></div>
        </div>

        <!-- Day 3 -->
        <div class="itin-day">
          <div class="itin-day-header">
            <div class="itin-day-num">3</div>
            <div><div class="itin-day-title">Tech & Brooklyn</div><div class="itin-day-sub">Fri 12 Jun Â· Matched to your ðŸ’» tech interest</div></div>
          </div>
          <div class="itin-item"><div class="itin-time">09:00</div><div class="itin-dot" style="background:#f59e0b;"></div><div class="itin-info"><div class="itin-name">Blank Street Coffee Â· Williamsburg</div><div class="itin-detail">NYC-born specialty chain Â· Pour-over bar</div><span class="itin-tag itin-tag-food">Food</span></div></div>
          <div class="itin-item"><div class="itin-time">10:30</div><div class="itin-dot" style="background:#8b5cf6;"></div><div class="itin-info"><div class="itin-name">DUMBO & Brooklyn Bridge Walk</div><div class="itin-detail">Tech startup district Â· Manhattan skyline views Â· Free</div><span class="itin-tag itin-tag-culture">Culture</span></div></div>
          <div class="itin-item"><div class="itin-time">14:00</div><div class="itin-dot" style="background:#8b5cf6;"></div><div class="itin-info"><div class="itin-name">NYC Tech Hub Tour Â· Hudson Yards</div><div class="itin-detail">Google NYC campus exterior Â· Shed cultural centre</div><span class="itin-tag itin-tag-culture">Culture</span></div></div>
          <div class="itin-item"><div class="itin-time">18:00</div><div class="itin-dot" style="background:#3b82f6;"></div><div class="itin-info"><div class="itin-name">Equinox Gym Â· Day Pass</div><div class="itin-detail">31st St Â· Premium gym Â· Matches ðŸ‹ï¸ interest Â· $35</div><span class="itin-tag itin-tag-transit">Fitness</span></div></div>
          <div class="itin-item"><div class="itin-time">20:00</div><div class="itin-dot" style="background:#f59e0b;"></div><div class="itin-info"><div class="itin-name">Ugly Baby Â· Thai Â· Brooklyn</div><div class="itin-detail">407 Smith St Â· Authentic Thai street food</div><span class="itin-tag itin-tag-food">Food</span></div></div>
        </div>

        <div style="padding:10px 12px;background:var(--blue-light);border-radius:8px;font-size:10px;font-family:'DM Mono',monospace;color:#1a3260;line-height:1.6;">
          âœ¦ Days 4â€“5 (Satâ€“Sun) include Central Park, MoMA, Chelsea Market, and departure to JFK.<br>Full itinerary saved to calendar on confirmation.
        </div>
      </div>
    </div>

    <!-- Panel 5: Confirmation -->
    <div class="trip-panel" id="trip-panel-5">
      <div class="trip-summary-box">
        <div style="font-size:10px;font-family:'DM Mono',monospace;color:rgba(255,255,255,0.4);letter-spacing:1px;">TRIP SUMMARY Â· NEW YORK CITY</div>
        <div class="trip-summary-grid">
          <div class="trip-summary-item"><div class="trip-summary-label">Dates</div><div class="trip-summary-val">10â€“15 Jun</div></div>
          <div class="trip-summary-item"><div class="trip-summary-label">Duration</div><div class="trip-summary-val">5 nights</div></div>
          <div class="trip-summary-item"><div class="trip-summary-label">Flight</div><div class="trip-summary-val">BA 177/178</div></div>
          <div class="trip-summary-item"><div class="trip-summary-label">Hotel</div><div class="trip-summary-val">Manhattan TS</div></div>
        </div>
      </div>

      <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">
        <div style="display:flex;justify-content:space-between;padding:10px 14px;background:var(--surface2);border-radius:8px;border:1px solid var(--border);font-size:13px;">
          <span style="font-weight:600;">âœˆ Outbound Â· BA 177</span>
          <span style="font-family:'DM Mono',monospace;font-weight:700;">Â£389</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:10px 14px;background:var(--surface2);border-radius:8px;border:1px solid var(--border);font-size:13px;">
          <span style="font-weight:600;">âœˆ Return Â· BA 178</span>
          <span style="font-family:'DM Mono',monospace;font-weight:700;">Â£349</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:10px 14px;background:var(--surface2);border-radius:8px;border:1px solid var(--border);font-size:13px;">
          <span style="font-weight:600;">ðŸ¨ Hotel Â· 5 nights</span>
          <span style="font-family:'DM Mono',monospace;font-weight:700;">Â£945</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:10px 14px;background:var(--surface2);border-radius:8px;border:1px solid var(--border);font-size:13px;">
          <span style="font-weight:600;">ðŸ—º Est. activities & food</span>
          <span style="font-family:'DM Mono',monospace;font-weight:700;">~Â£420</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:12px 14px;background:#1e3560;border-radius:8px;font-size:14px;color:white;">
          <span style="font-weight:700;">Total Estimated Cost</span>
          <span style="font-family:'DM Mono',monospace;font-weight:800;">Â£2,103</span>
        </div>
      </div>

      <div style="display:flex;flex-direction:column;gap:8px;">
        <label style="display:flex;align-items:center;gap:10px;font-size:12px;cursor:pointer;">
          <input type="checkbox" checked style="width:14px;height:14px;accent-color:#2c4a7c;">
          Add all 5 days to Calendar
        </label>
        <label style="display:flex;align-items:center;gap:10px;font-size:12px;cursor:pointer;">
          <input type="checkbox" checked style="width:14px;height:14px;accent-color:#2c4a7c;">
          Set budget alert at Â£2,200 total spend
        </label>
        <label style="display:flex;align-items:center;gap:10px;font-size:12px;cursor:pointer;">
          <input type="checkbox" style="width:14px;height:14px;accent-color:#2c4a7c;">
          Add restaurant reservations to tasks
        </label>
        <label style="display:flex;align-items:center;gap:10px;font-size:12px;cursor:pointer;">
          <input type="checkbox" checked style="width:14px;height:14px;accent-color:#2c4a7c;">
          Save itinerary to Trips
        </label>
      </div>
    </div>

    <!-- Footer -->
    <div class="trip-modal-footer">
      <button class="btn btn-ghost" id="trip-back-btn" onclick="tripStep(-1)" style="display:none;">â† Back</button>
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--ink3);" id="trip-step-counter">Step 1 of 5</div>
      <button class="btn btn-primary" id="trip-next-btn" onclick="tripStep(1)">Next â†’</button>
    </div>

  </div>
</div>

<!-- Receipt Modal -->
<div class="modal-overlay" id="receipt-modal" onclick="closeReceipt(event)">
  <div class="receipt-modal" onclick="event.stopPropagation()">
    <div class="receipt-modal-header">
      <div class="tx-logo tesco-logo" style="width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;">T</div>
      <div>
        <div style="font-size:13px;font-weight:700;color:var(--ink);">Tesco Superstore</div>
        <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">Receipt Â· 27 Feb 2026 Â· Â£47.83</div>
      </div>
      <button class="receipt-modal-close" onclick="closeReceiptBtn()"><i class="bi bi-x-lg"></i></button>
    </div>
    <div class="receipt-body">
      <div class="receipt-paper">
        <div class="receipt-paper-header">
          <div class="receipt-store-name">TESCO</div>
          <div class="receipt-store-sub">Tritton Road, Lincoln, LN6 7QY</div>
          <div class="receipt-store-sub" style="margin-top:6px;">27/02/2026 &nbsp;14:23 &nbsp;Till: 04 &nbsp;Op: 182</div>
        </div>

        <div class="receipt-line"><span class="receipt-line-name">Whole Milk 2L</span><span class="receipt-line-qty">x1</span><span class="receipt-line-price">Â£1.35</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Medium Sliced Bread</span><span class="receipt-line-qty">x1</span><span class="receipt-line-price">Â£1.20</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Free Range Eggs 12pk</span><span class="receipt-line-qty">x1</span><span class="receipt-line-price">Â£2.85</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Tesco Coffee Beans 500g</span><span class="receipt-line-qty">x1</span><span class="receipt-line-price">Â£5.50</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Basmati Rice 1kg</span><span class="receipt-line-qty">x1</span><span class="receipt-line-price">Â£2.10</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Extra Virgin Olive Oil 500ml</span><span class="receipt-line-qty">x1</span><span class="receipt-line-price">Â£4.20</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Garlic Bulb</span><span class="receipt-line-qty">x2</span><span class="receipt-line-price">Â£0.80</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Chicken Breast 500g</span><span class="receipt-line-qty">x2</span><span class="receipt-line-price">Â£7.00</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Broccoli</span><span class="receipt-line-qty">x1</span><span class="receipt-line-price">Â£0.79</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Cheddar Cheese 400g</span><span class="receipt-line-qty">x1</span><span class="receipt-line-price">Â£3.50</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Pasta Penne 500g</span><span class="receipt-line-qty">x2</span><span class="receipt-line-price">Â£1.80</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Tinned Tomatoes 400g</span><span class="receipt-line-qty">x3</span><span class="receipt-line-price">Â£1.50</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Orange Juice 1.5L</span><span class="receipt-line-qty">x1</span><span class="receipt-line-price">Â£2.00</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Washing Up Liquid 500ml</span><span class="receipt-line-qty">x1</span><span class="receipt-line-price">Â£1.50</span></div>
        <div class="receipt-line"><span class="receipt-line-name">Tesco Bag for Life</span><span class="receipt-line-qty">x2</span><span class="receipt-line-price">Â£0.30</span></div>

        <hr class="receipt-divider"/>

        <div class="receipt-total-row"><span>Subtotal</span><span>Â£36.39</span></div>
        <div class="receipt-total-row"><span>Clubcard Savings</span><span style="color:#00539f;">âˆ’Â£2.56</span></div>
        <div class="receipt-total-row"><span>VAT (5%)</span><span>Â£0.68</span></div>
        <div class="receipt-total-row"><span>VAT (20%)</span><span>Â£2.32</span></div>
        <div class="receipt-total-row grand"><span>TOTAL</span><span>Â£47.83</span></div>

        <hr class="receipt-divider"/>

        <div class="receipt-total-row"><span>Contactless Payment</span><span>Â£47.83</span></div>
        <div class="receipt-total-row"><span>Change</span><span>Â£0.00</span></div>

        <div class="receipt-footer">
          Thank you for shopping at Tesco<br>
          Clubcard Points Earned: 47<br>
          Total Clubcard Points: 1,284<br><br>
          Receipt No: 0427-2802-1423-8291
          <div class="receipt-barcode-img"></div>
        </div>
      </div>

      <div style="margin-top:12px; padding:10px 12px; background:var(--green-light); border:1px solid rgba(21,128,61,0.15); border-radius:8px; font-size:10px; font-family:'DM Mono',monospace; color:var(--green);">
        âœ“ Receipt matched to Barclays transaction Â· Inventory updated with 15 items Â· Linked 27 Feb 14:23
      </div>
    </div>
  </div>
</div>

<script>
function updateClock() {
  const now = new Date();
  document.getElementById('clock').textContent =
    now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
}
updateClock();
setInterval(updateClock, 1000);

const views = {
  dashboard: { title: 'Dashboard', sub: 'Saturday, 28 February 2026', btn: '+ Add Task' },
  tasks: { title: 'Tasks', sub: 'All tasks from emails, calls & manual', btn: '+ Add Task' },
  emails: { title: 'Emails', sub: 'AI summarised Â· All providers via Nylas', btn: 'Refresh' },
  calls: { title: 'Call Log', sub: 'Whisper transcription Â· Claude summary', btn: 'Record Call' },
  wallet: { title: 'Wallet', sub: 'Tickets & passes from emails', btn: 'Add Pass' },
  budget: { title: 'Budget', sub: 'February 2026 Â· TrueLayer connected', btn: 'Sync Bank' },
  bills: { title: 'Bills & Subscriptions', sub: 'Auto-detected recurring transactions', btn: 'Add Manual' },
  categorisation: { title: 'Categorisation', sub: 'Auto-categorised from bank transactions Â· TrueLayer', btn: 'Re-categorise' },
  vat: { title: 'VAT Return', sub: 'Quarter 4 Â· Octâ€“Dec 2025 Â· Due 7 Feb 2026', btn: 'Submit to HMRC' },
  tax: { title: 'Self Assessment Tax Return', sub: 'Tax Year 2024/25 Â· Due 31 Jan 2026', btn: 'Submit to HMRC' },
  inventory: { title: 'Inventory', sub: 'Food & drink Â· Updated from receipts', btn: 'Scan Receipt' },
  meals: { title: 'Meal Planner', sub: 'AI generated Â· Based on inventory & taste profile', btn: 'Regenerate' },
  trips: { title: 'Trip Planning', sub: 'Suggestions based on your interests', btn: 'Plan New Trip' },
  parcels: { title: 'Parcels', sub: 'Auto-tracked from emails Â· AfterShip', btn: 'Add Tracking' },
  calendar: { title: 'Calendar', sub: 'Events from emails & calls', btn: '+ Add Event' },
  meetings: { title: 'Meetings', sub: 'Synced from Calendar Â· Mon 2 Mar 2026', btn: '+ Schedule' },
  profile: { title: 'Taste Profile', sub: 'Interests, hobbies & food preferences', btn: 'Edit Profile' },
  chat: { title: 'Chat', sub: 'Messages from Teams, WhatsApp & Slack', btn: 'New Message' },
  habits: { title: 'Habit Tracker', sub: 'Sleep, gym & screen time', btn: 'Log Today' },
  stocks: { title: 'Stocks', sub: 'Watchlist Â· Last market close', btn: '+ Add Stock' },
  invoice: { title: 'Invoice Generator', sub: 'Create & send professional invoices', btn: 'New Invoice' },
  cashflow: { title: 'Cash Flow', sub: 'Income vs expenses Â· 6-month forecast', btn: 'Export' },
  payslips: { title: 'Payslips', sub: 'Synced from email Â· Manual uploads', btn: 'Upload Payslip' },
};

function navigate(view, el) {
  document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('view-' + view).classList.add('active');
  el.classList.add('active');
  const v = views[view];
  document.getElementById('topbar-title').textContent = v.title;
  document.getElementById('topbar-sub').textContent = v.sub;
  document.getElementById('action-btn').textContent = v.btn;
  document.getElementById('notif-panel').classList.remove('open');
  if (view === 'meals') renderPlannerGrid();
}

function switchProfileTab(tab, btn) {
  document.querySelectorAll('.profile-tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.profile-subtabs .meal-tab').forEach(b => b.classList.remove('active'));
  document.getElementById('ptab-' + tab).classList.add('active');
  btn.classList.add('active');
}

function handleAction() {
  const btn = document.getElementById('action-btn').textContent;
  const msgs = {
    '+ Add Task': 'âœ“ Task input focused',
    'Refresh': 'âœ‰ Fetching latest emails via Nylas...',
    'Record Call': 'â˜Ž Starting VOIP call recording...',
    'Add Pass': 'â—ˆ Scan or upload a pass',
    'Sync Bank': 'ðŸ¦ Syncing transactions via TrueLayer...',
    'Add Manual': 'âš‘ Add a manual bill',
    'Scan Receipt': 'ðŸ“„ Upload receipt image to scan',
    'Regenerate': 'ðŸ¤– Claude regenerating meal plan...',
    'Plan New Trip': 'âœˆ Starting trip planner...',
    'Add Tracking': 'ðŸ“¦ Enter tracking number',
    '+ Add Event': 'Create a new calendar event',
  };
  if (btn === '+ Add Task') {
    navigate('tasks', document.querySelectorAll('.nav-item')[2]);
    setTimeout(() => document.getElementById('new-task-input').focus(), 100);
    return;
  }
  showToast(msgs[btn] || 'âœ“ Done');
}

function toggleTask(el) {
  const check = el.querySelector('.task-check');
  const text = el.querySelector('.task-text');
  if (check.classList.contains('done')) {
    check.classList.remove('done'); check.innerHTML = ''; text.classList.remove('done');
  } else {
    check.classList.add('done'); check.innerHTML = '<i class="bi bi-check-lg"></i>'; text.classList.add('done');
    showToast('Task completed');
  }
}

function addNewTask() {
  const input = document.getElementById('new-task-input');
  const val = input.value.trim();
  if (!val) return;
  const list = document.getElementById('all-tasks-list');
  const item = document.createElement('div');
  item.className = 'task-item';
  item.onclick = function() { toggleTask(this); };
  item.innerHTML = `<div class="task-check"></div><div class="task-text">${val}</div><div class="task-source">manual</div>`;
  list.appendChild(item);
  input.value = '';
  showToast('Task added');
}

function toggleTag(el) {
  if (el.classList.contains('tag-active')) {
    el.classList.remove('tag-active'); el.classList.add('tag-inactive');
  } else if (el.classList.contains('tag-inactive')) {
    el.classList.remove('tag-inactive'); el.classList.add('tag-active');
  }
  showToast('Profile updated');
}

function addTag() {
  const name = prompt('Add an interest or hobby:');
  if (!name) return;
  const tags = document.getElementById('profile-tags');
  const addBtn = tags.querySelector('.tag-add');
  const tag = document.createElement('span');
  tag.className = 'profile-tag tag-active';
  tag.textContent = name;
  tag.onclick = function() { toggleTag(this); };
  tags.insertBefore(tag, addBtn);
  showToast('Interest added to profile');
}

function toggleNotif() {
  document.getElementById('notif-panel').classList.toggle('open');
}

function clearNotifs() {
  document.getElementById('notif-panel').querySelector('.notif-list').innerHTML =
    '<div style="padding:24px;text-align:center;font-family:\'DM Mono\',monospace;font-size:11px;color:var(--ink3);">No new notifications</div>';
  document.querySelector('.notif-dot').style.display = 'none';
  showToast('ðŸ”” All notifications cleared');
}

let toastTimer;
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toast.classList.remove('show'), 2800);
}

document.addEventListener('click', e => {
  const panel = document.getElementById('notif-panel');
  const bell = document.querySelector('.notif-bell');
  if (!panel.contains(e.target) && !bell.contains(e.target)) {
    panel.classList.remove('open');
  }
});

// Receipt modal
function openReceipt() {
  document.getElementById('receipt-modal').classList.add('open');
}

function closeReceipt(e) {
  if (e.target === document.getElementById('receipt-modal')) {
    document.getElementById('receipt-modal').classList.remove('open');
  }
}

function closeReceiptBtn() {
  document.getElementById('receipt-modal').classList.remove('open');
}

// â”€â”€ TRIP PLANNER â”€â”€
let currentTripStep = 1;
const totalTripSteps = 5;
const stepLabels = ['Dates', 'Flights', 'Hotel', 'Itinerary', 'Confirm'];

function openTripPlanner() {
  currentTripStep = 1;
  renderTripStep(1);
  document.getElementById('trip-modal-overlay').classList.add('open');
}

function closeTripPlanner() {
  document.getElementById('trip-modal-overlay').classList.remove('open');
}

function closeTripPlannerOverlay(e) {
  if (e.target === document.getElementById('trip-modal-overlay')) closeTripPlanner();
}

function tripStep(dir) {
  const next = currentTripStep + dir;
  if (next < 1 || next > totalTripSteps) return;

  // On step 3â†’4 show AI loading animation
  if (currentTripStep === 3 && dir === 1) {
    currentTripStep = 4;
    renderTripStep(4, true); // true = show loading
    return;
  }

  currentTripStep = next;
  renderTripStep(currentTripStep);
}

function renderTripStep(step, showLoading) {
  // Hide all panels
  for (let i = 1; i <= totalTripSteps; i++) {
    document.getElementById('trip-panel-' + i).classList.remove('active');
    const dot = document.getElementById('step-dot-' + i);
    const lbl = document.getElementById('step-label-' + i);
    if (i < step) {
      dot.className = 'trip-step-dot done'; dot.textContent = 'âœ“';
      lbl.className = 'trip-step-label done';
    } else if (i === step) {
      dot.className = 'trip-step-dot active'; dot.textContent = i;
      lbl.className = 'trip-step-label active';
    } else {
      dot.className = 'trip-step-dot'; dot.textContent = i;
      lbl.className = 'trip-step-label';
    }
    if (i < totalTripSteps) {
      const line = document.getElementById('step-line-' + i);
      line.className = 'trip-step-line' + (i < step ? ' done' : '');
    }
  }

  // Show current panel
  document.getElementById('trip-panel-' + step).classList.add('active');

  // Back/Next buttons
  const backBtn = document.getElementById('trip-back-btn');
  const nextBtn = document.getElementById('trip-next-btn');
  backBtn.style.display = step > 1 ? 'inline-flex' : 'none';

  if (step === totalTripSteps) {
    nextBtn.textContent = 'âœ“ Confirm & Save Trip';
    nextBtn.onclick = confirmTrip;
  } else {
    nextBtn.textContent = 'Next â†’';
    nextBtn.onclick = () => tripStep(1);
  }

  document.getElementById('trip-step-counter').textContent = 'Step ' + step + ' of ' + totalTripSteps;

  // Itinerary loading animation
  if (step === 4) {
    if (showLoading) {
      document.getElementById('itin-loading').style.display = 'flex';
      document.getElementById('itin-content').style.display = 'none';
      document.getElementById('trip-next-btn').disabled = true;
      setTimeout(() => {
        document.getElementById('itin-loading').style.display = 'none';
        document.getElementById('itin-content').style.display = 'block';
        document.getElementById('trip-next-btn').disabled = false;
        showToast('âœ¦ Itinerary generated â€” 5 days, 20 activities');
      }, 2200);
    } else {
      document.getElementById('itin-loading').style.display = 'none';
      document.getElementById('itin-content').style.display = 'block';
    }
  }
}

function selectFlight(id) {
  // Only deselect flights in same direction
  const isReturn = id.startsWith('flight-r');
  document.querySelectorAll('.flight-option').forEach(f => {
    const fIsReturn = f.id.startsWith('flight-r');
    if (fIsReturn === isReturn) f.classList.remove('selected');
  });
  document.getElementById(id).classList.add('selected');
}

function selectHotel(id) {
  document.querySelectorAll('.hotel-option').forEach(h => h.classList.remove('selected'));
  document.getElementById(id).classList.add('selected');
}

function toggleChip(el) {
  el.classList.toggle('selected');
}

function confirmTrip() {
  closeTripPlanner();
  showToast('âœˆ New York trip saved Â· Calendar & tasks updated');
}

const mobileBottomMap = {
  dashboard: 'mnav-dashboard',
  emails: 'mnav-emails',
  budget: 'mnav-budget',
  tasks: 'mnav-tasks',
  chat: 'mnav-chat',
};

function navigateMobile(view, el) {
  // Navigate using desktop nav logic
  const fakeDesktopEl = document.querySelector(`[onclick="navigate('${view}', this)"]`);
  if (fakeDesktopEl) {
    navigate(view, fakeDesktopEl);
  } else {
    // Manually update view for drawer items
    document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
    document.getElementById('view-' + view).classList.add('active');
    const v = views[view];
    if (v) {
      document.getElementById('topbar-title').textContent = v.title;
      document.getElementById('action-btn').textContent = v.btn;
    }
  }
  // Highlight drawer item
  document.querySelectorAll('.mobile-drawer .nav-item').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
  // Sync bottom nav if applicable
  Object.keys(mobileBottomMap).forEach(k => {
    document.getElementById(mobileBottomMap[k])?.classList.remove('active');
  });
  if (mobileBottomMap[view]) {
    document.getElementById(mobileBottomMap[view])?.classList.add('active');
  }
  closeDrawer();
}

function navigateMobileBottom(view, el) {
  // Navigate
  const desktopEl = document.querySelector(`[onclick="navigate('${view}', this)"]`);
  if (desktopEl) navigate(view, desktopEl);
  // Highlight bottom nav
  document.querySelectorAll('.mobile-nav-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

function toggleDrawer() {
  const drawer = document.getElementById('mobile-drawer');
  const overlay = document.getElementById('drawer-overlay');
  drawer.classList.toggle('open');
  overlay.classList.toggle('open');
}

function closeDrawer() {
  document.getElementById('mobile-drawer').classList.remove('open');
  document.getElementById('drawer-overlay').classList.remove('open');
}

// Show/hide mobile menu btn based on viewport
function checkViewport() {
  const btn = document.getElementById('mobile-menu-btn');
  if (window.innerWidth <= 768) {
    btn.style.display = 'flex';
  } else {
    btn.style.display = 'none';
    closeDrawer();
  }
}
checkViewport();
window.addEventListener('resize', checkViewport);

// â”€â”€ MEAL PLANNER â”€â”€
const DAYS = [
  { key: 'mon', label: 'MON', date: '2 Mar' },
  { key: 'tue', label: 'TUE', date: '3 Mar' },
  { key: 'wed', label: 'WED', date: '4 Mar' },
  { key: 'thu', label: 'THU', date: '5 Mar' },
  { key: 'fri', label: 'FRI', date: '6 Mar' },
  { key: 'sat', label: 'SAT', date: '7 Mar' },
  { key: 'sun', label: 'SUN', date: '8 Mar' },
];
const SLOT_TYPES = ['breakfast', 'lunch', 'dinner', 'snack'];
const SLOT_ICONS  = { breakfast: 'â˜€ï¸', lunch: 'ðŸŒ¤', dinner: 'ðŸŒ™', snack: 'ðŸŽ' };

// Meal plan state: { 'mon-breakfast': {name, emoji, kcal}, ... }
let mealPlan = {
  'mon-breakfast': { name: 'Garlic Egg Fried Rice', emoji: 'ðŸœ', kcal: 520 },
  'mon-lunch':     { name: 'Avocado Toast', emoji: 'ðŸ¥‘', kcal: 380 },
  'mon-dinner':    { name: 'Spaghetti Aglio e Olio', emoji: 'ðŸ', kcal: 610 },
  'wed-breakfast': { name: 'Scrambled Eggs', emoji: 'ðŸ¥š', kcal: 290 },
  'wed-lunch':     { name: 'Simple Rice Bowl', emoji: 'ðŸ›', kcal: 480 },
  'thu-dinner':    { name: 'Chicken Stir Fry', emoji: 'ðŸ—', kcal: 540 },
  'sat-breakfast': { name: 'Porridge & Banana', emoji: 'ðŸ¥£', kcal: 350 },
  'sat-snack':     { name: 'Greek Yoghurt', emoji: 'ðŸ«™', kcal: 140 },
};

// Recipe library
let recipes = [
  { id: 'r1', name: 'Garlic Egg Fried Rice', emoji: 'ðŸœ', kcal: 520, prep: '15 mins', category: 'Dinner',
    ingredients: '150g cooked rice\n2 eggs\n2 cloves garlic\n1 tbsp soy sauce\n1 tbsp sesame oil\nSpring onions',
    method: '1. Heat sesame oil in a wok over high heat.\n2. Fry garlic until golden, ~1 min.\n3. Add rice and stir-fry 2 mins.\n4. Push rice to side, scramble eggs.\n5. Combine, add soy sauce, top with spring onions.' },
  { id: 'r2', name: 'Avocado Toast with Eggs', emoji: 'ðŸ¥‘', kcal: 380, prep: '10 mins', category: 'Breakfast',
    ingredients: '2 slices sourdough bread\n1 ripe avocado\n2 eggs\nChilli flakes\nLemon juice\nSalt & pepper',
    method: '1. Toast bread until golden.\n2. Mash avocado with lemon juice, salt and pepper.\n3. Poach or fry eggs to your liking.\n4. Spread avocado on toast, top with egg.\n5. Finish with chilli flakes.' },
  { id: 'r3', name: 'Spaghetti Aglio e Olio', emoji: 'ðŸ', kcal: 610, prep: '20 mins', category: 'Dinner',
    ingredients: '200g spaghetti\n4 cloves garlic\n60ml olive oil\nChilli flakes\nParsley\nParmesan (optional)',
    method: '1. Cook spaghetti al dente, reserve 1 cup pasta water.\n2. Gently fry garlic in olive oil until pale gold.\n3. Add chilli flakes.\n4. Toss pasta with garlic oil, adding pasta water to loosen.\n5. Finish with parsley and parmesan.' },
  { id: 'r4', name: 'Simple Rice Bowl', emoji: 'ðŸ›', kcal: 480, prep: '20 mins', category: 'Lunch',
    ingredients: '150g rice\n2 eggs\nSoy sauce\nSesame seeds\nSpring onions\nPickled ginger (optional)',
    method: '1. Cook rice per packet instructions.\n2. Soft boil eggs 6.5 mins, peel and halve.\n3. Place rice in bowl, add eggs.\n4. Drizzle soy sauce, top with sesame seeds and spring onions.' },
  { id: 'r5', name: 'Chicken Stir Fry', emoji: 'ðŸ—', kcal: 540, prep: '20 mins', category: 'Dinner',
    ingredients: '2 chicken breasts, sliced\n1 pepper\n1 courgette\n2 tbsp oyster sauce\n1 tbsp soy sauce\n1 tsp ginger\n2 cloves garlic\nVegetable oil',
    method: '1. Marinate chicken in soy sauce and ginger 10 mins.\n2. Heat oil in wok, cook chicken until golden.\n3. Remove chicken, stir-fry veg 3 mins.\n4. Return chicken, add oyster sauce.\n5. Serve over rice or noodles.' },
  { id: 'r6', name: 'Porridge & Banana', emoji: 'ðŸ¥£', kcal: 350, prep: '5 mins', category: 'Breakfast',
    ingredients: '80g rolled oats\n350ml milk or water\n1 banana\nHoney\nCinnamon\nNuts (optional)',
    method: '1. Combine oats and milk in a saucepan.\n2. Cook on medium heat, stirring, until thick ~5 mins.\n3. Slice banana and lay on top.\n4. Drizzle honey, dust cinnamon, add nuts if using.' },
];

let currentRecipeId = null;
let currentSlot = null; // { day, type }
let editingRecipeId = null;

function switchMealTab(tab) {
  document.getElementById('meal-tab-plan').classList.toggle('active', tab === 'plan');
  document.getElementById('meal-tab-recipes').classList.toggle('active', tab === 'recipes');
  document.getElementById('meal-tab-content-plan').style.display = tab === 'plan' ? '' : 'none';
  document.getElementById('meal-tab-content-recipes').style.display = tab === 'recipes' ? '' : 'none';
  if (tab === 'recipes') renderRecipeList();
}

// â”€â”€ PLANNER GRID â”€â”€
function renderPlannerGrid() {
  const grid = document.getElementById('meal-planner-grid');
  if (!grid) return;
  grid.innerHTML = DAYS.map(day => {
    const dayKcal = SLOT_TYPES.reduce((sum, type) => {
      const meal = mealPlan[day.key + '-' + type];
      return sum + (meal ? meal.kcal : 0);
    }, 0);
    return `<div class="day-block">
      <div class="day-header">
        <span class="day-label">${day.label}</span>
        <span class="day-date">${day.date}</span>
        ${dayKcal > 0 ? `<span class="day-kcal-total">${dayKcal} kcal</span>` : ''}
      </div>
      <div class="day-meals-grid">
        ${SLOT_TYPES.map(type => renderSlot(day.key, type)).join('')}
      </div>
    </div>`;
  }).join('');
}

function renderSlot(day, type) {
  const key = day + '-' + type;
  const meal = mealPlan[key];
  const isSnack = type === 'snack';
  if (meal) {
    return `<div class="meal-slot filled ${isSnack ? 'snack-slot' : ''}" onclick="openMealSlot('${day}','${type}')">
      <button class="slot-clear-btn" onclick="event.stopPropagation();clearSlotDirect('${day}','${type}')"><i class="bi bi-x-lg"></i></button>
      <div class="slot-label">${SLOT_ICONS[type]} ${type}</div>
      <div class="slot-emoji">${meal.emoji}</div>
      <div class="slot-name">${meal.name}</div>
      <div class="slot-kcal">${meal.kcal} kcal</div>
    </div>`;
  }
  return `<div class="meal-slot ${isSnack ? 'snack-slot' : ''}" onclick="openMealSlot('${day}','${type}')">
    <div class="slot-label">${SLOT_ICONS[type]} ${type}</div>
    <div class="slot-empty-hint">+ Add</div>
  </div>`;
}

function clearSlotDirect(day, type) {
  delete mealPlan[day + '-' + type];
  renderPlannerGrid();
}

// â”€â”€ SLOT PICKER MODAL â”€â”€
function openMealSlot(day, type) {
  currentSlot = { day, type };
  const dayObj = DAYS.find(d => d.key === day);
  document.getElementById('slot-modal-title').textContent = `${dayObj.label} ${dayObj.date} Â· ${type.charAt(0).toUpperCase() + type.slice(1)}`;
  document.getElementById('slot-modal-sub').textContent = `Assign a meal to this slot`;
  document.getElementById('meal-slot-search').value = '';
  document.getElementById('quick-meal-name').value = '';
  document.getElementById('quick-meal-kcal').value = '';
  filterSlotRecipes('');
  document.getElementById('meal-slot-modal').classList.add('open');
}

function closeMealSlotModal(e) {
  if (e.target === document.getElementById('meal-slot-modal')) closeMealSlotModalBtn();
}
function closeMealSlotModalBtn() {
  document.getElementById('meal-slot-modal').classList.remove('open');
  currentSlot = null;
}

function filterSlotRecipes(query) {
  const q = query.toLowerCase();
  const filtered = recipes.filter(r => r.name.toLowerCase().includes(q) || r.category.toLowerCase().includes(q));
  const container = document.getElementById('slot-recipe-list');
  if (filtered.length === 0) {
    container.innerHTML = `<div style="font-size:11px;font-family:'DM Mono',monospace;color:var(--ink3);padding:8px;">No recipes match â€” use quick-add below</div>`;
    return;
  }
  container.innerHTML = filtered.map(r => `
    <div class="slot-recipe-item" onclick="assignRecipeToSlot('${r.id}')">
      <span style="font-size:20px;">${r.emoji}</span>
      <div style="flex:1;">
        <div style="font-size:12px;font-weight:700;color:var(--ink);">${r.name}</div>
        <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);">${r.kcal} kcal Â· ${r.prep} Â· ${r.category}</div>
      </div>
      <span style="font-size:10px;font-family:'DM Mono',monospace;color:#2c4a7c;">Assign â†’</span>
    </div>`).join('');
}

function assignRecipeToSlot(recipeId) {
  if (!currentSlot) return;
  const r = recipes.find(x => x.id === recipeId);
  if (!r) return;
  mealPlan[currentSlot.day + '-' + currentSlot.type] = { name: r.name, emoji: r.emoji, kcal: r.kcal };
  renderPlannerGrid();
  closeMealSlotModalBtn();
  showToast(`âœ“ ${r.name} added to ${currentSlot.day} ${currentSlot.type}`);
}

function assignQuickMeal() {
  if (!currentSlot) return;
  const name = document.getElementById('quick-meal-name').value.trim();
  if (!name) { showToast('Enter a meal name'); return; }
  const kcal = parseInt(document.getElementById('quick-meal-kcal').value) || 0;
  const emojis = { breakfast: 'â˜€ï¸', lunch: 'ðŸ¥—', dinner: 'ðŸ½', snack: 'ðŸŽ' };
  mealPlan[currentSlot.day + '-' + currentSlot.type] = { name, emoji: emojis[currentSlot.type], kcal };
  renderPlannerGrid();
  closeMealSlotModalBtn();
  showToast(`âœ“ ${name} added`);
}

function clearMealSlot() {
  if (!currentSlot) return;
  delete mealPlan[currentSlot.day + '-' + currentSlot.type];
  renderPlannerGrid();
  closeMealSlotModalBtn();
}

function aiGeneratePlan() {
  showToast('ðŸ¤– Generating meal plan from your inventory...');
  const aiPlan = {
    'mon-breakfast': { name: 'Porridge & Banana', emoji: 'ðŸ¥£', kcal: 350 },
    'mon-lunch':     { name: 'Avocado Toast with Eggs', emoji: 'ðŸ¥‘', kcal: 380 },
    'mon-dinner':    { name: 'Garlic Egg Fried Rice', emoji: 'ðŸœ', kcal: 520 },
    'tue-breakfast': { name: 'Scrambled Eggs on Toast', emoji: 'ðŸ¥š', kcal: 320 },
    'tue-lunch':     { name: 'Simple Rice Bowl', emoji: 'ðŸ›', kcal: 480 },
    'tue-dinner':    { name: 'Spaghetti Aglio e Olio', emoji: 'ðŸ', kcal: 610 },
    'tue-snack':     { name: 'Greek Yoghurt', emoji: 'ðŸ«™', kcal: 140 },
    'wed-breakfast': { name: 'Porridge & Banana', emoji: 'ðŸ¥£', kcal: 350 },
    'wed-lunch':     { name: 'Avocado Toast with Eggs', emoji: 'ðŸ¥‘', kcal: 380 },
    'wed-dinner':    { name: 'Chicken Stir Fry', emoji: 'ðŸ—', kcal: 540 },
    'thu-breakfast': { name: 'Scrambled Eggs on Toast', emoji: 'ðŸ¥š', kcal: 320 },
    'thu-lunch':     { name: 'Simple Rice Bowl', emoji: 'ðŸ›', kcal: 480 },
    'thu-dinner':    { name: 'Garlic Egg Fried Rice', emoji: 'ðŸœ', kcal: 520 },
    'thu-snack':     { name: 'Greek Yoghurt', emoji: 'ðŸ«™', kcal: 140 },
    'fri-breakfast': { name: 'Porridge & Banana', emoji: 'ðŸ¥£', kcal: 350 },
    'fri-lunch':     { name: 'Chicken Stir Fry', emoji: 'ðŸ—', kcal: 540 },
    'fri-dinner':    { name: 'Spaghetti Aglio e Olio', emoji: 'ðŸ', kcal: 610 },
    'sat-breakfast': { name: 'Avocado Toast with Eggs', emoji: 'ðŸ¥‘', kcal: 380 },
    'sat-lunch':     { name: 'Simple Rice Bowl', emoji: 'ðŸ›', kcal: 480 },
    'sat-dinner':    { name: 'Chicken Stir Fry', emoji: 'ðŸ—', kcal: 540 },
    'sat-snack':     { name: 'Greek Yoghurt', emoji: 'ðŸ«™', kcal: 140 },
    'sun-breakfast': { name: 'Porridge & Banana', emoji: 'ðŸ¥£', kcal: 350 },
    'sun-lunch':     { name: 'Garlic Egg Fried Rice', emoji: 'ðŸœ', kcal: 520 },
    'sun-dinner':    { name: 'Spaghetti Aglio e Olio', emoji: 'ðŸ', kcal: 610 },
  };
  setTimeout(() => {
    mealPlan = aiPlan;
    renderPlannerGrid();
    showToast('âœ“ Full week generated from inventory');
  }, 1200);
}

// â”€â”€ RECIPE LIBRARY â”€â”€
function renderRecipeList() {
  const container = document.getElementById('recipe-list-container');
  document.getElementById('recipe-count-sub').textContent = recipes.length + ' saved recipes';
  container.innerHTML = recipes.map(r => `
    <div class="recipe-list-item ${r.id === currentRecipeId ? 'active' : ''}" onclick="viewRecipe('${r.id}')">
      <span class="recipe-item-emoji">${r.emoji}</span>
      <div>
        <div class="recipe-item-name">${r.name}</div>
        <div class="recipe-item-meta">${r.kcal} kcal Â· ${r.prep} Â· ${r.category}</div>
      </div>
    </div>`).join('');
}

function viewRecipe(id) {
  currentRecipeId = id;
  const r = recipes.find(x => x.id === id);
  if (!r) return;
  document.getElementById('recipe-detail-title').textContent = r.emoji + ' ' + r.name;
  document.getElementById('recipe-detail-sub').textContent = r.kcal + ' kcal Â· ' + r.prep + ' Â· ' + r.category;
  document.getElementById('recipe-edit-btn').style.display = 'inline-flex';
  document.getElementById('recipe-detail-body').innerHTML = `
    <div style="margin-bottom:14px;">
      <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:8px;">INGREDIENTS</div>
      ${r.ingredients.split('\n').map(i => `<div style="display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid var(--border);font-size:12px;color:var(--ink2);">
        <span style="color:#2c4a7c;font-size:10px;">â–¸</span>${i}
      </div>`).join('')}
    </div>
    <div>
      <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:8px;">METHOD</div>
      ${r.method.split('\n').map(s => `<div style="padding:5px 0;border-bottom:1px solid var(--border);font-size:12px;color:var(--ink2);line-height:1.5;">${s}</div>`).join('')}
    </div>
    <button class="btn btn-primary" style="margin-top:14px;width:100%;" onclick="addRecipeToNextSlot('${r.id}')">+ Add to Meal Plan</button>`;
  renderRecipeList();
}

function addRecipeToNextSlot(id) {
  // Switch to planner tab and open first empty slot
  switchMealTab('plan');
  showToast('Select a slot in the planner to assign this recipe');
  // Pre-open the picker
  for (const day of DAYS) {
    for (const type of SLOT_TYPES) {
      if (!mealPlan[day.key + '-' + type]) {
        openMealSlot(day.key, type);
        // Pre-select the recipe in the picker
        setTimeout(() => {
          const r = recipes.find(x => x.id === id);
          if (r) document.getElementById('meal-slot-search').value = r.name, filterSlotRecipes(r.name);
        }, 50);
        return;
      }
    }
  }
}

// â”€â”€ RECIPE EDITOR â”€â”€
function openRecipeEditor(id) {
  editingRecipeId = id;
  const modal = document.getElementById('recipe-editor-modal');
  const deleteBtn = document.getElementById('recipe-delete-btn');
  if (id) {
    const r = recipes.find(x => x.id === id);
    document.getElementById('recipe-editor-title').textContent = 'Edit Recipe';
    document.getElementById('re-name').value = r.name;
    document.getElementById('re-emoji').value = r.emoji;
    document.getElementById('re-kcal').value = r.kcal;
    document.getElementById('re-prep').value = r.prep;
    document.getElementById('re-category').value = r.category;
    document.getElementById('re-ingredients').value = r.ingredients;
    document.getElementById('re-method').value = r.method;
    deleteBtn.style.display = 'inline-flex';
  } else {
    document.getElementById('recipe-editor-title').textContent = 'New Recipe';
    ['re-name','re-kcal','re-prep','re-ingredients','re-method'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('re-emoji').value = 'ðŸ½';
    document.getElementById('re-category').value = 'Any';
    deleteBtn.style.display = 'none';
  }
  modal.classList.add('open');
}

function closeRecipeEditor() {
  document.getElementById('recipe-editor-modal').classList.remove('open');
}
function closeRecipeEditorOverlay(e) {
  if (e.target === document.getElementById('recipe-editor-modal')) closeRecipeEditor();
}

function saveRecipe() {
  const name = document.getElementById('re-name').value.trim();
  if (!name) { showToast('Recipe needs a name'); return; }
  const data = {
    name,
    emoji: document.getElementById('re-emoji').value.trim() || 'ðŸ½',
    kcal: parseInt(document.getElementById('re-kcal').value) || 0,
    prep: document.getElementById('re-prep').value.trim() || '?',
    category: document.getElementById('re-category').value,
    ingredients: document.getElementById('re-ingredients').value.trim(),
    method: document.getElementById('re-method').value.trim(),
  };
  if (editingRecipeId) {
    const idx = recipes.findIndex(r => r.id === editingRecipeId);
    recipes[idx] = { ...recipes[idx], ...data };
    showToast('âœ“ Recipe updated');
  } else {
    data.id = 'r' + Date.now();
    recipes.push(data);
    showToast('âœ“ Recipe saved');
  }
  closeRecipeEditor();
  renderRecipeList();
  if (editingRecipeId) viewRecipe(editingRecipeId);
}

function deleteRecipe() {
  if (!editingRecipeId) return;
  recipes = recipes.filter(r => r.id !== editingRecipeId);
  if (currentRecipeId === editingRecipeId) {
    currentRecipeId = null;
    document.getElementById('recipe-detail-title').textContent = 'Select a recipe';
    document.getElementById('recipe-detail-sub').textContent = 'or add a new one';
    document.getElementById('recipe-edit-btn').style.display = 'none';
    document.getElementById('recipe-detail-body').innerHTML = `<div style="text-align:center;padding:32px 16px;color:var(--ink3);font-family:'DM Mono',monospace;font-size:11px;">Select a recipe from the list to view details.</div>`;
  }
  closeRecipeEditor();
  renderRecipeList();
  showToast('Recipe deleted');
}

// Init planner on load
document.addEventListener('DOMContentLoaded', () => { renderPlannerGrid(); selectMeeting('standup'); });

// â”€â”€ ASK ANN â”€â”€
const annResponses = {
  'how much have i spent this month': 'ðŸ’° You\'ve spent <strong>Â£1,842</strong> this month against a Â£2,500 budget â€” <strong>74% used</strong> with 1 day remaining in February. Biggest categories: Housing Â£780, Food Â£340, Shopping Â£312. You\'re Â£120 under on food vs last month.',
  'what\'s my next meeting': 'Your next meeting is the <strong>Q1 Management Review</strong> at 11:00 today (1h) â€” starting in 2 hours. 8 attendees. ANN has prepared a briefing with your Q4 spend data and outstanding tasks.',
  'what meals can i make tonight': 'ðŸœ Based on your inventory, you can make: <strong>Garlic Egg Fried Rice</strong> (rice, eggs, garlic, olive oil â€” all in stock), <strong>Spaghetti Aglio e Olio</strong> (pasta low stock â€” check), or <strong>Scrambled Eggs on Toast</strong> (bread running low). Recommend egg fried rice.',
  'summarise my emails today': 'âœ‰ <strong>3 emails today:</strong> HMRC chasing self-assessment (overdue â€” task already added), Netflix confirming price rise to Â£13.99 from 15 Mar (bill alert created), ASOS order dispatched (parcel tracking active, arriving today).',
};

function annAsk(el) {
  const q = el.textContent;
  document.getElementById('ann-ask-input').value = q;
  annAskInput();
}

function annAskInput() {
  const input = document.getElementById('ann-ask-input');
  const q = input.value.trim();
  if (!q) return;
  const resp = document.getElementById('ann-response');
  resp.style.display = 'block';
  resp.innerHTML = '<div class="ann-thinking"><span></span><span></span><span></span></div>';
  const key = q.toLowerCase().replace(/[?!.]/g, '');
  const answer = annResponses[key] || `âœ¦ Based on your data: I found information related to "<em>${q}</em>". Cross-referencing your emails, transactions, calendar and inventory now. For a full answer, this would query your connected accounts in real-time.`;
  setTimeout(() => {
    resp.innerHTML = answer;
    input.value = '';
  }, 900);
}

// â”€â”€ MEETINGS â”€â”€
const meetingData = {
  standup: {
    title: 'Daily Standup',
    sub: '09:00 â€“ 09:30 Â· Mon 2 Mar Â· 4 attendees',
    icon: 'ðŸ“‹',
    badge: 'Live Now',
    badgeStyle: 'status-transit',
    attendees: ['Sarah Mitchell Â· Senior Accountant', 'James K. Â· Management Accountant', 'Rachel T. Â· Finance Analyst'],
    agenda: ['Quick wins from last week', 'Blockers & priorities for today', 'Q1 review prep â€” James to lead', 'Any other business'],
    notes: 'Q1 Management Review prep is top priority today. James has the deck â€” confirm by 10:30.',
    joinSub: 'Live now Â· 4 participants Â· Started 09:00',
  },
  quarterly: {
    title: 'Q1 Management Review',
    sub: '11:00 â€“ 12:00 Â· Mon 2 Mar Â· 8 attendees',
    icon: 'ðŸ“Š',
    badge: 'In 2h',
    badgeStyle: 'status-processing',
    attendees: ['David Chen Â· Finance Director', 'Sarah Mitchell', 'James K.', 'Rachel T.', '+ 4 others'],
    agenda: ['Q4 2025 P&L review', 'Budget vs actuals â€” February', 'VAT return status (overdue)', 'Q1 2026 forecast', 'Headcount & contractor review'],
    notes: 'ANN summary: Your Feb spend was Â£1,842 vs Â£2,500 budget (74%). VAT return is overdue â€” flag this. Outstanding tasks include tax self-assessment.',
    joinSub: 'Starting in 2 hours Â· Link ready Â· 8 participants',
  },
  aat: {
    title: 'AAT Revision Session',
    sub: '14:00 â€“ 14:45 Â· Mon 2 Mar Â· 3 attendees',
    icon: 'ðŸ“š',
    badge: 'In 5h',
    badgeStyle: 'status-processing',
    attendees: ['Tom Brady Â· AAT Tutor', 'Priya S. Â· Fellow Apprentice'],
    agenda: ['Double-entry bookkeeping recap', 'Trial balance exercise', 'Practice exam walkthrough â€” Unit 2', 'Q&A on payroll concepts'],
    notes: 'Focus area this week: Control accounts and reconciliation. Tom mentioned a mock exam next Monday â€” review chapters 4â€“6 beforehand.',
    joinSub: 'Starting in 5 hours Â· Link ready',
  },
};

let activeMeeting = 'standup';

function selectMeeting(id) {
  activeMeeting = id;
  const m = meetingData[id];
  // Update list highlight
  document.querySelectorAll('.meeting-item').forEach(el => el.classList.remove('active-meeting'));
  const mitem = document.getElementById('mitem-' + id);
  if (mitem) { mitem.classList.add('active-meeting'); }
  // Update detail panel
  document.getElementById('meet-icon').textContent = m.icon;
  document.getElementById('meet-title').textContent = m.title;
  document.getElementById('meet-sub').textContent = m.sub;
  const badge = document.getElementById('meet-badge');
  badge.textContent = m.badge;
  badge.className = 'status-pill ' + m.badgeStyle;
  badge.style.marginLeft = 'auto';
  document.getElementById('meet-join-sub').textContent = m.joinSub;
  // Update call title
  document.getElementById('call-title-bar').textContent = m.title + ' Â· 00:00';
  // Render briefing
  document.getElementById('meet-briefing-body').innerHTML = `
    <div style="margin-bottom:14px;">
      <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:8px;">ATTENDEES</div>
      ${m.attendees.map(a => `<div class="briefing-item"><div class="briefing-dot" style="background:#2c4a7c;"></div><div><div style="font-size:12px;font-weight:600;color:var(--ink);">${a}</div></div></div>`).join('')}
    </div>
    <div style="margin-bottom:14px;">
      <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--ink3);letter-spacing:1px;margin-bottom:8px;">AGENDA</div>
      ${m.agenda.map((a,i) => `<div class="briefing-item"><div class="briefing-dot" style="background:#10b981;"></div><div><span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--ink3);margin-right:8px;">${i+1}.</span><span style="font-size:12px;color:var(--ink2);">${a}</span></div></div>`).join('')}
    </div>
    <div style="padding:10px 12px;background:var(--blue-light);border-radius:8px;border-left:3px solid #2c4a7c;">
      <div style="font-size:9px;font-family:'DM Mono',monospace;color:#1a3260;letter-spacing:1px;margin-bottom:4px;"><i class="bi bi-stars"></i> ANN BRIEFING NOTE</div>
      <div style="font-size:12px;color:#1a3260;line-height:1.5;">${m.notes}</div>
    </div>`;
}

function joinMeeting() {
  document.getElementById('call-modal').classList.add('open');
  startCallTimer();
}

function leaveCall() {
  document.getElementById('call-modal').classList.remove('open');
  clearInterval(callTimer);
  callSeconds = 0;
  showToast('ðŸ‘‹ Left ' + meetingData[activeMeeting].title);
}

let callTimer, callSeconds = 0;
function startCallTimer() {
  callSeconds = 0;
  clearInterval(callTimer);
  callTimer = setInterval(() => {
    callSeconds++;
    const m = String(Math.floor(callSeconds/60)).padStart(2,'0');
    const s = String(callSeconds%60).padStart(2,'0');
    const bar = document.getElementById('call-title-bar');
    if (bar) bar.textContent = meetingData[activeMeeting].title + ' Â· ' + m + ':' + s;
  }, 1000);
}

function toggleCallCtrl(btn, type) {
  btn.classList.toggle('muted');
  if (type === 'cam') {
    const icon = document.getElementById('your-cam-icon');
    if (icon) icon.style.display = btn.classList.contains('muted') ? 'block' : 'none';
    btn.innerHTML = '<i class="bi bi-camera-video' + (btn.classList.contains('muted') ? '-off' : '') + '-fill"></i>';
    showToast(btn.classList.contains('muted') ? 'Camera off' : 'Camera on');
  }
  if (type === 'mic') showToast(btn.classList.contains('muted') ? 'Muted' : 'Unmuted');
}

function toggleMeetCtrl(btn, type) {
  btn.classList.toggle('active');
  const labels = {
    cam: ['<i class="bi bi-camera-video-off-fill"></i> Cam Off', '<i class="bi bi-camera-video-fill"></i> Cam On'],
    mic: ['<i class="bi bi-mic-mute-fill"></i> Mic Off', '<i class="bi bi-mic-fill"></i> Mic On'],
    blur: ['<i class="bi bi-eye-slash"></i> Blur On', '<i class="bi bi-eye"></i> Blur Off']
  };
  btn.innerHTML = btn.classList.contains('active') ? labels[type][1] : labels[type][0];
}

let chatOpen = false;
function toggleChat() {
  chatOpen = !chatOpen;
  const panel = document.getElementById('call-chat');
  panel.style.display = chatOpen ? 'flex' : 'none';
  panel.style.flexDirection = 'column';
}

function sendChatMsg() {
  const inp = document.getElementById('chat-input');
  const text = inp.value.trim();
  if (!text) return;
  const container = document.getElementById('chat-messages');
  const el = document.createElement('div');
  el.className = 'chat-msg';
  el.innerHTML = `<span class="chat-who">You</span><span class="chat-text">${text}</span>`;
  container.appendChild(el);
  container.scrollTop = container.scrollHeight;
  inp.value = '';
}

function sendReaction() {
  showToast('âœ‹ Reaction sent');
}

// â”€â”€ Chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let activeChatId = 'work-team';

function selectChat(chatId, convEl) {
  // Update sidebar highlight
  document.querySelectorAll('.conv-item').forEach(el => el.classList.remove('active'));
  if (convEl) convEl.classList.add('active');
  // Remove badge from selected conv
  const badge = convEl ? convEl.querySelector('.conv-badge') : null;
  if (badge) badge.remove();
  // Hide all chat mains, show selected
  document.querySelectorAll('.chat-main').forEach(m => m.style.display = 'none');
  const main = document.getElementById('chat-main-' + chatId);
  if (main) main.style.display = 'flex';
  activeChatId = chatId;
  // Scroll to bottom of messages
  const msgs = main ? main.querySelector('.chat-messages') : null;
  if (msgs) msgs.scrollTop = msgs.scrollHeight;
}

function filterChats(query) {
  const q = query.toLowerCase();
  document.querySelectorAll('.conv-item').forEach(item => {
    const name = item.querySelector('.conv-name')?.textContent.toLowerCase() || '';
    const preview = item.querySelector('.conv-preview')?.textContent.toLowerCase() || '';
    item.style.display = (name.includes(q) || preview.includes(q)) ? '' : 'none';
  });
}

function filterChatTab(type, btn) {
  document.querySelectorAll('.chat-tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.conv-item').forEach(item => {
    if (type === 'all') {
      item.style.display = '';
    } else {
      item.style.display = item.dataset.type === type ? '' : 'none';
    }
  });
}

function sendMainChat(chatId) {
  const inp = document.getElementById('chat-input-' + chatId);
  if (!inp || !inp.value.trim()) return;
  const text = inp.value.trim();
  const msgs = document.querySelector('#chat-main-' + chatId + ' .chat-messages');
  if (!msgs) return;
  const row = document.createElement('div');
  row.className = 'chat-bubble-row own';
  row.innerHTML = `<div><div class="chat-bubble own">${text.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div><div class="bubble-time">Just now</div></div>`;
  msgs.appendChild(row);
  msgs.scrollTop = msgs.scrollHeight;
  inp.value = '';
  // Update sidebar preview
  const conv = document.querySelector(`.conv-item[data-chat="${chatId}"] .conv-preview`);
  if (conv) conv.textContent = 'You: ' + text.substring(0, 40);
}

function addChatEventToCalendar() {
  const btn = document.getElementById('ann-add-cal-btn');
  if (!btn) return;
  btn.innerHTML = '<i class="bi bi-check-lg"></i> Added to Calendar';
  btn.classList.add('added');
  btn.disabled = true;
  showToast('Team Lunch Â· Fri 6 Mar 12:30 added to Calendar');
}

// â”€â”€ Habit Tracker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchHabitTab(tab, btn) {
  document.querySelectorAll('#view-habits .profile-tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('#view-habits .meal-tab').forEach(b => b.classList.remove('active'));
  document.getElementById('htab-' + tab).classList.add('active');
  if (btn) btn.classList.add('active');
}
function logSleep() {
  const v = document.getElementById('sleep-input').value;
  if (!v) { showToast('Enter hours first'); return; }
  document.getElementById('sleep-input').value = '';
  showToast('Sleep logged: ' + v + 'h tonight');
}
function logGym() {
  showToast('Gym session logged for today');
}
function toggleGymDay(dot) {
  dot.classList.toggle('done');
  dot.classList.toggle('rest');
  dot.innerHTML = dot.classList.contains('done') ? '<i class="bi bi-check-lg"></i>' : '<i class="bi bi-dash"></i>';
}

// â”€â”€ Stocks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectStock(id, row) {
  document.querySelectorAll('.stock-row').forEach(r => r.classList.remove('active'));
  document.querySelectorAll('.stock-detail').forEach(d => d.style.display = 'none');
  if (row) row.classList.add('active');
  const detail = document.getElementById('sdetail-' + id);
  if (detail) detail.style.display = 'flex';
}

// â”€â”€ Shopping List â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleShopItem(check) {
  check.classList.toggle('checked');
  check.innerHTML = check.classList.contains('checked') ? '<i class="bi bi-check-lg"></i>' : '';
  const name = check.nextElementSibling;
  if (name) name.classList.toggle('done');
}
function addShopItem() {
  const inp = document.getElementById('shop-add-input');
  if (!inp || !inp.value.trim()) return;
  const text = inp.value.trim();
  const row = document.createElement('div');
  row.className = 'shop-item';
  row.innerHTML = `<div class="shop-check" onclick="toggleShopItem(this)"></div><div class="shop-name">${text.replace(/</g,'&lt;')}</div><div class="shop-qty">1</div><span class="shop-source added">Added</span>`;
  document.getElementById('shop-list').appendChild(row);
  inp.value = '';
}
function copyShopList() {
  const items = [...document.querySelectorAll('#shop-list .shop-name')].map(n => n.textContent).join('\n');
  navigator.clipboard?.writeText(items).catch(()=>{});
  showToast('Shopping list copied to clipboard');
}
function regenShopList() {
  showToast('Shopping list regenerated from inventory');
}

// â”€â”€ Invoice â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateInvoicePreview() {
  const get = id => { const el = document.getElementById(id); return el ? el.value : ''; };
  document.getElementById('prv-from').textContent = get('inv-from');
  document.getElementById('prv-num').textContent = get('inv-num');
  document.getElementById('prv-to').textContent = get('inv-to');
  document.getElementById('prv-date').textContent = 'Issued: ' + get('inv-date');
  document.getElementById('prv-due').textContent = 'Due: ' + get('inv-due');
  document.getElementById('prv-notes').textContent = get('inv-notes');
  // Recalculate totals
  let sub = 0;
  const rows = document.querySelectorAll('#inv-lines tr');
  const prvLines = document.getElementById('prv-lines');
  prvLines.innerHTML = '';
  rows.forEach(row => {
    const desc = row.querySelector('.inv-desc')?.value || '';
    const qty = parseFloat(row.querySelector('.inv-qty')?.value) || 0;
    const price = parseFloat(row.querySelector('.inv-price')?.value) || 0;
    const amt = qty * price;
    sub += amt;
    // update amount cell
    const cells = row.querySelectorAll('td');
    if (cells[3]) cells[3].textContent = 'Â£' + amt.toFixed(2);
    prvLines.innerHTML += `<tr><td>${desc}</td><td>${qty}</td><td>Â£${price.toFixed(2)}</td><td>Â£${amt.toFixed(2)}</td></tr>`;
  });
  const vatOn = document.getElementById('inv-vat')?.checked;
  const vat = vatOn ? sub * 0.2 : 0;
  const total = sub + vat;
  document.getElementById('prv-sub').textContent = 'Â£' + sub.toFixed(2);
  document.getElementById('prv-vat').textContent = 'Â£' + vat.toFixed(2);
  document.getElementById('prv-total').textContent = 'Â£' + total.toFixed(2);
  document.getElementById('prv-vat-row').style.display = vatOn ? 'flex' : 'none';
}
function addInvoiceLine() {
  const tbody = document.getElementById('inv-lines');
  const tr = document.createElement('tr');
  tr.innerHTML = `<td><input class="inv-desc" value="New Item" oninput="updateInvoicePreview()"></td><td><input style="width:50px;" class="inv-qty" value="1" oninput="updateInvoicePreview()"></td><td><input style="width:80px;" class="inv-price" value="0" oninput="updateInvoicePreview()"></td><td>Â£0.00</td><td><span style="cursor:pointer;color:var(--red);font-size:12px;" onclick="removeInvoiceLine(this)">âœ•</span></td>`;
  tbody.appendChild(tr);
  updateInvoicePreview();
}
function removeInvoiceLine(btn) {
  btn.closest('tr').remove();
  updateInvoicePreview();
}
function downloadInvoice() {
  const num = document.getElementById('inv-num')?.value || 'invoice';
  showToast('Invoice ' + num + ' downloaded as PDF');
}

// â”€â”€ Payslips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const payslipData = {
  mar26: { employer:'Acme Ltd', period:'March 2026', gross:2800, tax:420, ni:196, pension:140, net:2044, ytdGross:28000, ytdTax:4200, ytdNI:1960 },
  feb26: { employer:'Acme Ltd', period:'February 2026', gross:2800, tax:420, ni:196, pension:140, net:2044, ytdGross:25200, ytdTax:3780, ytdNI:1764 },
  jan26: { employer:'Acme Ltd', period:'January 2026', gross:2800, tax:420, ni:196, pension:140, net:2044, ytdGross:22400, ytdTax:3360, ytdNI:1568 },
  dec25: { employer:'Freelance Invoice', period:'December 2025', gross:400, tax:0, ni:0, pension:0, net:400, ytdGross:400, ytdTax:0, ytdNI:0 },
};
function selectPayslip(id, row) {
  document.querySelectorAll('.payslip-item').forEach(r => r.classList.remove('active'));
  if (row) row.classList.add('active');
  const d = payslipData[id]; if (!d) return;
  const det = document.getElementById('payslip-detail');
  det.querySelector('.card-title').textContent = d.employer + ' â€” ' + d.period;
  const rows = det.querySelectorAll('.payslip-detail-row');
  if (rows[0]) { rows[0].querySelector('.payslip-detail-val').textContent = 'Â£' + d.gross.toFixed(2); rows[0].querySelector('.payslip-detail-lbl').textContent = 'Gross Pay'; }
  if (rows[1]) rows[1].querySelector('.payslip-detail-val').textContent = d.tax ? 'âˆ’Â£' + d.tax.toFixed(2) : 'â€”';
  if (rows[2]) rows[2].querySelector('.payslip-detail-val').textContent = d.ni ? 'âˆ’Â£' + d.ni.toFixed(2) : 'â€”';
  if (rows[3]) rows[3].querySelector('.payslip-detail-val').textContent = d.pension ? 'âˆ’Â£' + d.pension.toFixed(2) : 'â€”';
  if (rows[4]) rows[4].querySelector('.payslip-detail-val').textContent = 'Â£' + d.net.toFixed(2);
}
function uploadPayslip() {
  document.getElementById('payslip-file-input').click();
}
</script>

</body>
</html>
